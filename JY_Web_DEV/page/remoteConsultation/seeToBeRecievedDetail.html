<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <title>中康九悦远程医疗管理系统 - 远程会诊申请单</title>

    <meta name="keywords" content="中康九悦远程医疗管理系统">
    <meta name="description" content="中康九悦远程医疗管理系统">

    <!--[if lt IE 8]>
    <meta http-equiv="refresh" content="0;ie.html"/>
    <![endif]-->

    <link rel="shortcut icon" href="favicon.ico">
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="../../css/plugins/steps/jquery.steps.css" rel="stylesheet">
    <link href="../../css/animate.min.css" rel="stylesheet">
    <link href="../../css/style.min.css" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../css/plugins/webuploader/webuploader.css">
    <link rel="stylesheet" type="text/css" href="../../css/demo/webuploader-demo.min.css">
    <link rel="stylesheet" href="../../css/public.css" />
    <link rel="stylesheet" href="../../css/seeToBeRecievedDetail.css" />
</head>
<body>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
			<div class="clients-list">
	            <div class="tab-content">
	                <div>
	                    <div class="full-height-scroll">
	                        <div class="table-responsive">
	                        	<h3 class="requestOrder">远程会诊申请单</h3>
	                        	<form id="form"  class="wizard-big">
		                            <!--<h1>确认检查申请单</h1>-->
		                            <div class="finishedPrint">
			                            <fieldset class="f2"id="f2">
			                                <div class="row">
			                                    <div class="ibox-content">
													<h4><span>申请单号:</span><span class="applyNum">413257854255</span></h4>
							                       
													<table class="table table-bordered tableInput">
							                            <tbody>
							                                <tr>
							                                    <td class="tableInputTitle"><label>患者姓名</label></td>
							                                    <td class="printUserName tableInputContent">
							                                    	
							                                    </td>
							                                    <td class="tableInputTitle"><label>性别</label></td>
							                                    <td class="printSex tableInputContent">
							                                    	
							                                    </td>
							                                    <td class="tableInputTitle"><label>年龄</label></td>
							                                    <td class="printAge">
							                                    	
							                                    </td>
							                                </tr>
							                                <tr>
							                                    <td class="tableInputTitle"><label>患者手机号<span class="warns"></span></label></td>
							                                    <td class="printTel tableInputContent">
							                                    	
							                                    </td>
							                                    <td class="tableInputTitle"><label>身份证号</label></td>
							                                    <td class="printIdentityCode tableInputContent"colspan="3">
							                                </tr>
							                            </tbody>
							                        </table>
							                        <table class="table table-bordered tableInput">
						                            <tbody>
						                                <tr>
						                                	<!--<td class="tableInputTitle"><label>会诊模式</label></td>
						                                	<td class="tablesecondContent printModel">
						                                    	
						                                    </td>-->
						                                    <td class="tableInputTitle"><label>会诊时间</label></td>
						                                    <td  class="tablesecondContent printCheckTime">
						                                    	
						                                    </td>
						                                    <td class="tableInputTitle"><label>会诊单位</label></td>
						                                	<td class="tablesecondContent printHos">
						                                    	
						                                    </td>
						                                </tr>
						                                <tr>
						                                   	
						                                    <!--<td class="tableInputTitle"><label>会诊科室</label></td>
						                                	<td class="printDepartment">
						                                    	
						                                    </td>-->
						                                    <td class="tableInputTitle"><label>会诊医生</label></td>
						                                	<td class="tablesecondContent printDoctor">
						                                    	
						                                    </td>
						                                    <td class="tableInputTitle"><label>申请医院</label></td>
						                                	<td class="printApplyHos">
						                                    	
						                                    </td>
						                                </tr>
						                                 <!--<tr>
						                                 	
						                                    
						                                    <td class="tableInputTitle"><label>申请科室</label></td>
							                                <td class="tablesecondContent printApplyDepartment">
							                                	
							                                </td>
						                                </tr>-->
						                                <tr>
						                                	<td class="tableInputTitle"><label>申请医生</label></td>
							                                <td class="tablesecondContent printApplyDoctor">
							                                	
							                                </td>
							                                <td class="tableInputTitle"><label>联系电话</label></td>
							                                <td class="printContactTel">
							                                </td>
						                                </tr>
						                            </tbody>
						                        </table>
						                        <table class="table table-bordered tableInput">
						                            <tbody>
						                                <tr>
						                                	<td class="tableInputTitle"><label>主诉</label></td>
							                                <td class="printMainSuit">
							                                    
							                                </td>
						                                </tr>
						                                <tr>
						                                	<td class="tableInputTitle"><label>个人史</label></td>
							                                <td class="printPersonalHistory">
							                                    
							                                </td>
						                                </tr>
						                                <tr>
						                                	<td class="tableInputTitle"><label>体格检查</label></td>
							                                <td class="printPhysicalExamination">
							                                    
							                                </td>
						                                </tr>
						                                 <tr>
						                                	<td class="tableInputTitle"><label>备注</label></td>
							                                <td class="memo">
							                                    
							                                </td>
						                                </tr>
						                                 <tr>
						                                	<td class="tableInputTitle"><label>辅助检查</label></td>
							                                <td class="printUploadImg">
							                                    
							                                </td>
						                                </tr>
						                                <tr>
						                                	<td class="tableInputTitle"><label>会诊备注</label></td>
							                                <td class="printMemo">
							                                    
							                                </td>
						                                </tr>
						                            </tbody>
						                        </table>
						                        <span>申请时间:</span><span class="printApplyTime">2019/5/17 17:13:45</span>
							                    </div>
			                                </div>
			                            </fieldset>
										<div class="row printBtns">
							                <button type="button" class="btn btn-w-m refuseBtn"data-toggle="modal" data-target="#myModal">拒绝</button>
							                <button type="button" class="btn btn-w-m receiveBtn"data-toggle="modal" data-target="#recieveModal">接受申请</button>
							            </div>
							            
							            <div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
				                            <div class="modal-dialog">
				                                <div class="modal-content animated bounceInRight">
				                                    <div class="modal-header">
				                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
				                                        </button>
				                                        <i class="fa fa-laptop modal-icon"></i>
				                                        <h4 class="modal-title">拒绝理由</h4>
				                                        <small class="font-bold">请简单填写您的拒绝理由
				                                        </div>
				                                        <div class="modal-body">
				                                            <div class="form-group">
				                                            	<label>理由</label> 
				                                            	<input type="text" placeholder="请输入20字以内的拒绝理由" maxlength="20"class="form-control"id="inputRefused">
				                                            </div>
				                                        </div>
				                                        <div class="modal-footer">
				                                            <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
				                                            <button type="button" class="btn btn-success"id="saveRefused">保存</button>
				                                        </div>
				                                    </div>
				                                </div>
				                            </div>
				                            <div class="modal inmodal" id="recieveModal" tabindex="-1" role="dialog" aria-hidden="true">
				                            <div class="modal-dialog">
				                                <div class="modal-content animated bounceInRight">
				                                    <div class="modal-header">
				                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
				                                        </button>
				                                        <i class="fa fa-laptop modal-icon"></i>
				                                        <h4 class="modal-title">备注信息</h4>
				                                        <small class="font-bold">请简单填写需要备注的信息，如果没有内容需要填写，请直接保存！
				                                        </div>
				                                        <div class="modal-body">
				                                            <div class="form-group">
				                                            	<label>备注</label> 
				                                            	<input type="text" placeholder="请输入250字以内备注内容" maxlength="255"class="form-control"id="inputRecieve">
				                                            </div>
				                                        </div>
				                                        <div class="modal-footer">
				                                            <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
				                                            <button type="button" class="btn btn-success"id="saveRecieve">接受申请</button>
				                                        </div>
				                                    </div>
				                                </div>
				                            </div>
				                            
		                            </div>
		                            
		                            <!--<h1>发送成功</h1>-->
		                            <fieldset class="f3">
		                                <div class="text-center" style="margin-top: 120px">
		                                    <h2></h2>
		                                </div>
		                            </fieldset>
		                        </form>
	                        </div>
	                    </div>
	                </div>
	                
	                <div id="tab-3" class="tab-pane">
	                    <div class="full-height-scroll">
	                        <div class="table-responsive">
	                        </div>
	                    </div>
	                </div>
	            </div>
            </div>
        </div>
    </div>
    <script src="../../js/jquery.min.js?v=2.1.4"></script>
    <script src="../../js/bootstrap.min.js?v=3.3.5"></script>
    <script src="../../js/plugins/staps/jquery.steps.min.js"></script>
    <script src="../../js/plugins/validate/jquery.validate.min.js"></script>
    <script src="../../js/plugins/validate/messages_zh.min.js"></script>
    <script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../js/content.min.js?v=1.0.0"></script>
    <script type="text/javascript">
        var BASE_URL = '../../js/plugins/webuploader';
    </script>
    <!--<script src="../../js/plugins/webuploader/webuploader.min.js"></script>-->
    <!--<script src="../../js/demo/webuploader-demo.min.js"></script>-->
    <script src="../../js/plugins/jquery.jqprint-0.3.js"></script>
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
    <script>
        $(document).ready(function(){
        	$(".contact-box").each(function(){
        		animationHover(this,"pulse")
			})
        	//  获取用户id       
			var userId=sessionStorage.getItem('userId');
			var sessionId=sessionStorage.getItem('sessionId');
        	var currentIds=localStorage.getItem("seeToBeRecievedId");
//      	读取详情数据
ajaxGet('/cons/applyInfo/getApply',{
					id:currentIds
			},function(data){
					console.log(data);	
					$(".printUserName").text(data.resultMap.applyInfo.patientName);//患者姓名
					if(data.resultMap.applyInfo.sex=="0"){
						$(".printSex").text("男");//患者性别
					}else{
						$(".printSex").text("女");//患者性别
					}
					$(".applyNum").text(data.resultMap.applyInfo.applyNo);//申请单号
					$(".printAge").text(data.resultMap.applyInfo.age);//患者年龄
					$(".printTel").text(data.resultMap.applyInfo.patientTelephone);//患者手机号
					$(".printIdentityCode").text(data.resultMap.applyInfo.patientIdNumber);//患者身份证号
//					$(".printModel").text(data.resultMap.applyInfo.);//会诊模式
					$(".printCheckTime").text(data.resultMap.applyInfo.expectType);//会诊时间
					$(".printHos").text(data.resultMap.applyInfo.assignDeptName);//会诊单位
					$(".printDepartment").text(data.resultMap.applyInfo.assignSectionName);//会诊科室
					$(".printDoctor").text(data.resultMap.applyInfo.assignDoctorName);//会诊医生
					if(data.resultMap.applyInfo.applyDeptName!=null&&data.resultMap.applyInfo.applyDeptName!=""){
						$(".printApplyHos").text(data.resultMap.applyInfo.applyDeptName);//申请医院
					}else{
						$(".printApplyHos").text('');//申请医院
					}
					if(data.resultMap.applyInfo.applySectionName!=null&&data.resultMap.applyInfo.applySectionName!=""){
						$(".printApplyDepartment").text(data.resultMap.applyInfo.applySectionName);//申请科室
					}else{
						$(".printApplyDepartment").text('');//申请科室
					}
					if(data.resultMap.applyInfo.applyDoctorName!=null&&data.resultMap.applyInfo.applyDoctorName!=""){
						$(".printApplyDoctor").text(data.resultMap.applyInfo.applyDoctorName);//申请医生
					}else{
						$(".printApplyDoctor").text('');//申请医生
					}
//					$(".printApplyHos").text(data.resultMap.applyInfo.applyHospitalName);//申请医院
//					$(".printApplyDepartment").text(data.resultMap.applyInfo.applySectionName);//申请科室
//					$(".printApplyDoctor").text(data.resultMap.applyInfo.applyDoctorName);//申请医生
					$(".printContactTel").text(data.resultMap.applyInfo.applyTelephone);//联系电话
					$(".printMainSuit").text(data.resultMap.applyInfo.chiefComplaint);//主诉
					$(".printPersonalHistory").text(data.resultMap.applyInfo.personalHistory);//个人史
					$(".printPhysicalExamination").text(data.resultMap.applyInfo.physicalExamination);//体格检查
					$(".memo").text(data.resultMap.applyInfo.memo);//申请端备注信息
					for(var i=0;i<data.resultMap.fileList.length;i++){
						$(".printUploadImg").append('<img src="'+data.resultMap.fileList[i].image+'"style="width:110px;height:110px;">');//辅助检查
					}
					$(".applyConStatus").text(data.resultMap.applyInfo.conStatusName);//驳回状态
					if(data.resultMap.applyInfo.conStatus==2){//已申请
						$(".refusedText").text("（驳回理由："+data.resultMap.applyInfo.reason+"）");//驳回理由
					}else if(data.resultMap.applyInfo.conStatus==3){
						$(".printMemo").text(data.resultMap.applyInfo.reason);//申请通过后的备注信息
					}else{
						$(".printMemo").text(data.resultMap.applyInfo.reason);//申请完成后的备注信息
					}
					
					$(".applyConStatus").text(data.resultMap.applyInfo.conStatusName);
					var applyTime=new Date(data.resultMap.applyInfo.inputTime);
					var applyYear=applyTime.getFullYear();
					var applyMonth=applyTime.getMonth()+1;
					var applyDate=applyTime.getDate();
					var applyHours=applyTime.getHours()<10?"0"+applyTime.getHours():applyTime.getHours();       //获取当前小时数(0-23)
					var applyMinutes=applyTime.getMinutes()<10?"0"+applyTime.getMinutes():applyTime.getMinutes();     //获取当前分钟数(0-59)
					var applySeconds=applyTime.getSeconds()<10?"0"+applyTime.getSeconds():applyTime.getSeconds(); 
//					$(".printApplyTime").text(applyYear+'/'+applyMonth+'/'+applyDate+' '+applyHours+":"+applyMinutes+":"+applySeconds);//申请时间
					$(".printApplyTime").text(data.resultMap.applyInfo.createTime);//申请时间	
			});
//			拒绝申请
			$("#saveRefused").click(function(){
				var inputRefused=$("#inputRefused").val().trim();
				if(inputRefused==""||inputRefused==null){
					swal({
                           title:"拒绝理由",
                           text:"请输入拒绝理由再进行提交。"
                        })
				}else{
					ajaxGet('/cons/applyInfo/updateRejectState',{
							reason:inputRefused,
							operatorUser:userId,
							id:currentIds
						},function(data){
							console.log(data);
							if(data.status==0){
								alert("操作成功！");
								closeNavTabAndRefreshIframe("page/remoteConsultation/seeToBeRecievedDetail.html","page/remoteConsultation/tobeReceived.html");
//								closeIframe("page/remoteConsultation/seeToBeRecievedDetail.html");
							}
						});
//					$.ajax({
//						type:"get",
//						url:config+"/cons/applyInfo/updateRejectState",
//						async:false,
//						dataType:"JSON",
//						data:{
//							reason:inputRefused,
//							operatorUser:userId,
//							id:currentIds
//						},
//						success:function(data){
//							console.log(data);
//							if(data.status==1){
//								alert("操作成功！");
//								closeNavTabAndRefreshIframe("page/remoteConsultation/seeToBeRecievedDetail.html","page/remoteConsultation/tobeReceived.html");
////								closeIframe("page/remoteConsultation/seeToBeRecievedDetail.html");
//							}
//						},
//					});
				}

			});
//			接收申请
			$("#saveRecieve").click(function(){
				var inputRecieve=$("#inputRecieve").val().trim();
				ajaxGet('/cons/applyInfo/updateAdoptState',{
						reason:inputRecieve,
						operatorUser:userId,
						id:currentIds
					},function(data){
						console.log(data);
						alert("操作成功！");
						closeNavTabAndRefreshIframe("page/remoteConsultation/seeToBeRecievedDetail.html","page/remoteConsultation/tobeReceived.html");
					});
//				$.ajax({
//					type:"get",
//					url:config+"/cons/applyInfo/updateAdoptState",
//					async:false,
//					dataType:"JSON",
//					data:{
//						reason:inputRecieve,
//						operatorUser:userId,
//						id:currentIds
//					},
//					success:function(data){
//						console.log(data);
//						alert("操作成功！");
//						closeNavTabAndRefreshIframe("page/remoteConsultation/seeToBeRecievedDetail.html","page/remoteConsultation/tobeReceived.html");
//					},
//				});
			});
		});
    </script>
    <script type="text/javascript" src="../../js/stats.js"charset="utf-8"></script>
</body>

</html>