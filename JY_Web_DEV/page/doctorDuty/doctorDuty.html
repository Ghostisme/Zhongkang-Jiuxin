<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <title>中康九悦远程医疗管理系统 - 远程会诊申请单</title>

    <meta name="keywords" content="中康九悦远程医疗管理系统">
    <meta name="description" content="中康九悦远程医疗管理系统">

    <!--[if lt IE 8]>
    <meta http-equiv="refresh" content="0;ie.html"/>
    <![endif]-->

    <link rel="shortcut icon" href="favicon.ico">
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="../../css/plugins/steps/jquery.steps.css" rel="stylesheet">
    <link href="../../css/animate.min.css" rel="stylesheet">
    <link href="../../css/style.min.css" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../css/plugins/webuploader/webuploader.css">
    <link rel="stylesheet" type="text/css" href="../../css/demo/webuploader-demo.min.css">
    <link href="../../css/plugins/clockpicker/clockpicker.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/public.css" />
    <link rel="stylesheet" href="../../css/doctorDuty.css" />
</head>
<body>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
			<div class="clients-list">
	            <div class="tab-content">
	                <div>
	                    <div class="full-height-scroll">
	                        <div class="table-responsive">
	                        	<h3 class="requestOrder">医生排班表</h3>
	                        	<form id="form"  class="wizard-big">
		                            
		                            <fieldset class="f1">
		                                <div class="row">
		                                	<div class="ibox-content">
		                                		<h5 class="editBtn">编辑</h5>
												<table class="table table-bordered tableInput">
													<thead>
														<!--<th></th>-->
														<th>周一</th>
														<th>周二</th>
														<th>周三</th>
														<th>周四</th>
														<th>周五</th>
														<th>周六</th>
														<th>周日</th>
													</thead>
													<tbody>
														<tr>
						                            		<!--<td >
						                            			上午
						                            		</td>-->
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
														    		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
														                <input type="text" class="required startTime form-control" placeholder="开始时间">
														            </div>
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>
								                            		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
														                <input type="text" class="required endTime form-control" placeholder="结束时间">
														            </div>
						                            				<input class="required col-sm-2 col-lg-2 lf limitNum" name="Day" type="number"placeholder="人数">
						                            				<span class="rt DelTxt">-</span>	
						                            			</div>-->
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="monday required col-sm-4 col-lg-4" name="monday" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="monday1 required col-sm-4 col-lg-4" name="monday1" type="text" placeholder="结束时间">
						                            				<input class="monday2 required col-sm-2 col-lg-2 lf limitNum" name="monday2" type="number"placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="tuesDay required col-sm-4 col-lg-4" name="tuesDay" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="tuesDay1 required col-sm-4 col-lg-4" name="tuesDay1" type="text"placeholder="结束时间">
						                            				<input class="tuesDay2 required col-sm-2 col-lg-2 lf limitNum" name="tuesDay2" type="number" placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="wensDay required col-sm-4 col-lg-4" name="wensDay" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="wensDay1 required col-sm-4 col-lg-4" name="wensDay1" type="text" placeholder="结束时间">
						                            				<input class="wensDay2 required col-sm-2 col-lg-2 lf limitNum" name="wensDay2" type="number" placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="thursDay required col-sm-4 col-lg-4" name="thursDay" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="thursDay1 required col-sm-4 col-lg-4" name="thursDay1" type="text" placeholder="结束时间">
						                            				<input class="thursDay2 required col-sm-2 col-lg-2 lf limitNum" name="thursDay2" type="number"placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="friDay required col-sm-4 col-lg-4" name="friDay" type="text"placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="friDay1 required col-sm-4 col-lg-4" name="friDay1" type="text"placeholder="结束时间">
						                            				<input class="friDay2 required col-sm-2 col-lg-2 lf limitNum" name="friDay2" type="number" placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="satuDay required col-sm-4 col-lg-4" name="satuDay" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="satuDay1 required col-sm-4 col-lg-4" name="satuDay1" type="text" placeholder="结束时间">
						                            				<input class="satuDay2 required col-sm-2 col-lg-2 lf limitNum" name="satuDay2" type="number" placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<!--<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="sunDay required col-sm-4 col-lg-4" name="sunDay" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="sunDay1 required col-sm-4 col-lg-4" name="sunDay1" type="text"placeholder="结束时间">
						                            				<input class="sunDay2 required col-sm-2 col-lg-2 lf limitNum" name="sunDay2" type="number"placeholder="人数">
						                            			</div>-->
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            	</tr>
						                            	<!--<tr>
						                            		<td >
						                            			下午
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="mondayPm required col-sm-4 col-lg-4" name="mondayPm" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="mondayPm1 required col-sm-4 col-lg-4" name="mondayPm1" type="text" placeholder="结束时间">
						                            				<input class="mondayPm2 required col-sm-2 col-lg-2 lf limitNum" name="mondayPm2" type="number"placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="tuesDayPm required col-sm-4 col-lg-4" name="tuesDayPm" type="text"placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="tuesDayPm1 required col-sm-4 col-lg-4" name="tuesDayPm1" type="text" placeholder="结束时间">
						                            				<input class="tuesDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="tuesDayPm2" type="number"placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="wensDayPm required col-sm-4 col-lg-4" name="wensDayPm" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="wensDayPm1 required col-sm-4 col-lg-4" name="wensDayPm1" type="text" placeholder="结束时间">
						                            				<input class="wensDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="wensDayPm2" type="number" placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="thursDayPm required col-sm-4 col-lg-4" name="thursDayPm" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="thursDayPm1 required col-sm-4 col-lg-4" name="thursDayPm1" type="text" placeholder="结束时间">
						                            				<input class="thursDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="thursDayPm2" type="number" placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="friDayPm required col-sm-4 col-lg-4" name="friDayPm" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="friDayPm1 required col-sm-4 col-lg-4" name="friDayPm1" type="text" placeholder="结束时间">
						                            				<input class="friDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="friDayPm2" type="number" placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="satuDayPm required col-sm-4 col-lg-4" name="satuDayPm" type="text"placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="satuDayPm1 required col-sm-4 col-lg-4" name="satuDayPm1" type="text" placeholder="结束时间">
						                            				<input class="satuDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="satuDayPm2" type="number" placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            		<td>
						                            			<div class="input-group col-lg-12 col-sm-12 ">
						                            				<input class="sunDayPm required col-sm-4 col-lg-4" name="sunDayPm" type="text" placeholder="开始时间">
								                            		<span class="col-sm-1 col-lg-1 toTxt">至</span>	
								                            		<input class="sunDayPm1 required col-sm-4 col-lg-4" name="sunDayPm1" type="text"placeholder="结束时间">
						                            				<input class="sunDayPm2 required col-sm-2 col-lg-2 lf limitNum" name="sunDayPm2" type="number" placeholder="人数">
						                            			</div>
						                            			<div class="addInputBtn">
						                            				+
						                            			</div>
						                            		</td>
						                            	</tr>-->
													</tbody>
						                        </table>
						                    </div>
		                                </div>
										<div class="row makeSureBtn">
											<button type="submit" class="btn btn-w-m btn-success SaveBtn">确认</button>
										</div>
		                            </fieldset>
		                        </form>
	                        </div>
	                    </div>
	                </div>	                
	            </div>
            </div>
        </div>
    </div>
    <script src="../../js/jquery.min.js?v=2.1.4"></script>
    <script src="../../js/bootstrap.min.js?v=3.3.5"></script>
    <script src="../../js/plugins/staps/jquery.steps.min.js"></script>
    <script src="../../js/plugins/validate/jquery.validate.min.js"></script>
    <script src="../../js/plugins/validate/messages_zh.min.js"></script>
    <script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../js/content.min.js?v=1.0.0"></script>
    <script src="../../js/plugins/suggest/bootstrap-suggest.min.js"></script>
    <script src="../../js/plugins/jquery.jqprint-0.3.js"></script>
    <script src="../../js/plugins/datapicker/bootstrap-datepicker.js"></script>
    <script src="../../js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
    <script src="../../js/plugins/clockpicker/clockpicker.js"></script>
    <script src="../../js/plugins/cropper/cropper.min.js"></script>
    <!--<script src="../../js/demo/form-advanced-demo.min.js"></script>-->
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="../../js/stats.js"charset="utf-8"></script>
    <script>
    	//  获取用户id       
		var userId=sessionStorage.getItem('userId');
		var sessionId=sessionStorage.getItem('sessionId');
		var userInfo=JSON.parse(sessionStorage.getItem('user'));
		console.log(userInfo);
		var hospitalId=userInfo.fkHospitalId;//医院id
		var sectionId=userInfo.fkSectionId;//科室id
		var doctorId=userInfo.id;//医生id
//  	加载数据
	getTimeList();
	function getTimeList(){
		$('.addInputBtn').prevAll().remove();
		$.ajax({
			type: 'get',
			url: config + "/cons/scheduling/list",
			contentType: "application/json; charset=utf-8", //传到后台的数据格式
			async: true,
			data: {
				doctorId:doctorId,
			    sectionId:sectionId,
				hospitalId:hospitalId
			},
			dataType: 'JSON', //接收值的格式
			traditional: true,
			success: function (data) {
			    console.log('ajaxGetDortorList:',data);
			   	var tds=$(".table td");
			   	if(data.resultMap.schedulingList.length>0){
				   	for(var i=1;i<tds.length+1;i++){
				   		for(var p=0;p<data.resultMap.schedulingList.length;p++){
				   			if(data.resultMap.schedulingList[p].week==i){
				   				$(tds[i-1]).find(".addInputBtn").before(`<div class="input-group col-lg-12 col-sm-12 ">
															    		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
															                <input type="text" class="required startTime form-control" placeholder="开始时间"value="`+data.resultMap.schedulingList[p].startTime+`"readonly="readonly"disabled="disabled">
															            </div>
									                            		<span class="col-sm-1 col-lg-1 toTxt">-</span>
									                            		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
															                <input type="text" class="required endTime form-control" placeholder="结束时间"value="`+data.resultMap.schedulingList[p].endTime+`"readonly="readonly"disabled="disabled">
															            </div>
							                            				<input class="required col-sm-2 col-lg-2 lf limitNum" name="Day" type="number"onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"value="`+data.resultMap.schedulingList[p].num+`"placeholder="人数"disabled="disabled">
							                            				<span class="rt DelTxt"style="display:none;">-</span>	
							                            			</div>`);
							                            			$('.clockpicker').clockpicker();
				   			}
				 		}
				   	}
				   	$(".makeSureBtn").css("display","none");
					$(".addInputBtn").css("display","none");
			   	}else{
			   		$(".makeSureBtn").css("display","none");
					$(".addInputBtn").css("display","none");
					$(".DelTxt").css("display","none");
			   	}
			   	
			   	
			},
			error: function (result) {
			            //233
			    console.log('ajaxGet-errorDortorList:',result);
			}
		});
	}
		
//  	新增input
    	$(document).on("click",".addInputBtn",function(){
    		
    		$(this).before(`<div class="input-group col-lg-12 col-sm-12">
														    		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
														                <input type="text" class="required startTime form-control" placeholder="开始时间"readonly="readonly">
														            </div>
								                            		<span class="col-sm-1 col-lg-1 toTxt">-</span>
								                            		<div class="clockpicker col-sm-4 col-lg-4 " data-autoclose="true">
														                <input type="text" class="required endTime form-control" placeholder="结束时间"readonly="readonly">
														            </div>
						                            				<input class="required col-sm-2 col-lg-2 lf limitNum" name="Day" type="number"onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"placeholder="人数">
						                            				<span class="rt DelTxt">-</span>	
						                            			</div>`);
						                            			$('.clockpicker').clockpicker();
    	});
//  	删除已填input
		$(document).on("click",".DelTxt",function(){
			$(this).parent().remove();
		});
		//		点击确定按钮
		$("#form").validate();
		$(".SaveBtn").click(function(event){
			var arrangeArr=[];
			var idcard_patter = /^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/;//身份证号校验
			event.preventDefault();
				if($("#form").valid()){
			     	event.preventDefault();
			     	var tds=$(".table td");
			 		for(var i=0;i<tds.length;i++){
			 			var DaysArr=[];
			 			var timesInput=$(tds[i]).find(".input-group");
			 			for(var k=0;k<timesInput.length;k++){
			 				var startTime=$(timesInput[k]).find(".startTime").val().trim();
			 				var endTime=$(timesInput[k]).find(".endTime").val().trim();
			 				var limitNum=$(timesInput[k]).find(".limitNum").val().trim();
			 				var TimeListArr=[startTime,endTime,limitNum];
			 				DaysArr.push(TimeListArr);
			 			}
			 			arrangeArr.push(DaysArr);
			 		}
				}
//				console.log(arrangeArr);
//				var arr=[{"1":[['1','1','1'],['2','2','2']]},{"2":[['1','1','1'],['2','2','2']]}];
				arr=JSON.stringify(arrangeArr);
				console.log(arr);
				$.ajax({
			        type: 'get',
			        url: config + "/cons/scheduling/save",
			        contentType: "application/json; charset=utf-8", //传到后台的数据格式
			        async: true,
			        data: {
			        	userList:arr,
			        	doctorId:doctorId,
			        	sectionId:sectionId,
						hospitalId:hospitalId
			        },
			        dataType: 'JSON', //接收值的格式
			        traditional: true,
			        success: function (data) {
			            console.log('ajaxGetDortorList:',data);
			            if(data.status==1){
			    			getTimeList();
			   			}
			        },
			        error: function (result) {
			            //233
			            console.log('ajaxGet-errorDortorList:',result);
			        }
			    });
		
			
	})
		
//		点击编辑按钮
		$(".editBtn").click(function(){
			$("input").removeAttr("disabled");
			$(".makeSureBtn").css("display","block");
			$(".addInputBtn").css("display","block");
			$(".DelTxt").css("display","block");
		})
    </script>
</body>

</html>