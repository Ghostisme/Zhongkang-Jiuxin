<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<title>中康九悦远程医疗管理系统 - 远程会诊申请单</title>

		<meta name="keywords" content="中康九悦远程医疗管理系统">
		<meta name="description" content="中康九悦远程医疗管理系统">
		<!--[if lt IE 8]>
    <meta http-equiv="refresh" content="0;ie.html"/>
    <![endif]-->
		<link rel="shortcut icon" href="favicon.ico">
		<link href="../../css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome.min.css" rel="stylesheet">
		<link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
		<link href="../../css/plugins/steps/jquery.steps.css" rel="stylesheet">
		<link href="../../css/animate.min.css" rel="stylesheet">
		<link href="../../css/plugins/summernote/summernote.css" rel="stylesheet">
		<link href="../../css/plugins/summernote/summernote-bs3.css" rel="stylesheet">
		<link rel="stylesheet" href="../../js/baiduMapAPI/DrawingManager_min.css" />
		<link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../css/plugins/webuploader/webuploader.css">
		<link rel="stylesheet" type="text/css" href="../../css/demo/webuploader-demo.min.css">
		<link href="../../css/style.min.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/common.css" />
		<link rel="stylesheet" href="../../css/layerCommonStyle.css" />
		<link rel="stylesheet" href="../../css/editHosAdmin.css" />
	</head>

	<body>
		<div class="wrapper wrapper-content animated fadeInRight">
			<div class="row">
				<div class="ibox-content">
					<form id="form" class="wizard-big">
						<!--医院信息-->
						<div class="hosInfos" id="hosBox">
							<!--标题-->
							<div class="infosNav">
								医院信息
								<span class="addInfoBtns rt hosEdit" id="hosEdit">编辑</span>
							</div>
							<div class="hosId" style="display:none;"></div>
							<div class="form-group addRows">
								<div class="col-sm-4">
									<label class="col-sm-4 control-label labelsPosition"><span class="redStar">*</span>医院名称：</label>
									<div class="col-sm-6">
										<input id="hosName" name="hosName" maxlength="50" type="text" placeholder="医院名称" class="form-control required" required="" aria-required="true" disabled="disabled">
									</div>
								</div>
								<div class="col-sm-4">
									<label class="col-sm-4 control-label labelsPosition">医院简称：</label>
									<div class="col-sm-6">
										<input id="hosEasyName" name="hosEasyName" maxlength="50" type="text" placeholder="医院简称" class="form-control" disabled="disabled">
									</div>
								</div>
								<div class="col-sm-4">
									<label class="col-sm-4 control-label labelsPosition"><span class="redStar">*</span>医院等级：</label>
									<div class="col-sm-6">
										<input id="hosLevel" name="hosLevel" maxlength="50" type="text" placeholder="医院等级" class="form-control required" required="" aria-required="true" disabled="disabled">
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-4">
									<label class="col-sm-4 control-label labelsPosition">特色科室：</label>
									<div class="col-sm-6">
										<input id="specialDept" name="specialDept" maxlength="50" type="text" placeholder="特色科室" class="form-control" disabled="disabled">
									</div>
								</div>
								<div class="col-sm-4">
									<label class="col-sm-4 control-label labelsPosition">床位数量：</label>
									<div class="col-sm-6">
										<input id="bedNum" name="bedNum" maxlength="50" placeholder="床位数量" type="text" class="form-control" disabled="disabled">
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-12">
									<label class="col-sm-112 control-label labelsDetailPosition">医院简介：</label>
									<div class="col-sm-10 allLineInputPadding">
										<textarea id="hosInfo" name="hosInfo" maxlength="250" placeholder="医院简介不超过250字" type="text" class="form-control allTextAreaHeight" disabled="disabled"></textarea>
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-12">
									<label class="col-sm-112 control-label labelsDetailPosition"><span class="redStar">*</span>医院地址：</label>
									<div class="col-sm-10 allLineInputPadding">
										<textarea id="hosAddr" name="hosAddr" placeholder="医院地址不超过250字" maxlength="250" type="text" class="form-control allTextAreaHeight required" disabled="disabled"></textarea>
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-11">
									<label class="col-sm-112 control-label labelsDetailPosition"><span class="redStar">*</span>地图：</label>
									<div class="col-sm-9 allLineInputPadding">
										<input id="longitude" name="longitude" type="hidden">
										<input id="latitude" name="latitude" type="hidden">
										<div id="allmap" style="overflow:hidden;zoom:1;">
											<div class="mapSearchBox">
												<input class="BMapLib_box " onclick="closeDraw()" value="拖动地图" type="button">
												<input class="BMapLib_box " onclick="openDraw(1)" value="画点" type="button">
												<!--             <button class="BMapLib_box " onclick="openDraw(2)">画折线</button>
										            <button class="BMapLib_box " onclick="openDraw(4)">画圆</button>
										            <button class="BMapLib_box " onclick="openDraw(5)">画多边形</button>
										            <button class="BMapLib_box " onclick="openDraw(3)">画矩形</button> 
										            <button type="button" onclick="clearAll()">清除所有绘制的覆盖物</button>
										            <button type="button" onclick="openDis()">开启鼠标测距</button>
										            <button type="button" onclick="openRectangleZoom()">开启拉框放大</button>
										            <button type="button" onclick="closeRectangleZoom()">关闭拉框</button> -->
												<span>城市名：</span>
												<input id="cityName" type="text" name="cityName" value="天津" style="width:10%;">
												<button type="button" onclick="theCityLocation()">切换城市</button>
												<span>搜索地物：</span>
												<input id="searchName" type="text" value="" style="width:10%;">
												<button type="button" onclick="search(1)">搜索</button>
												<button type="button" onclick="cityLocation('天津')">地图复位</button>
											</div>
											<div id="map" style="height:80%;-webkit-transition: all 0.5s ease-in-out;transition: all 0.5s ease-in-out; margin:0px;padding:0px;"></div>
										</div>
									</div>
								</div>
								<div>
									<ul id="drawlist">
									</ul>
								</div>
							</div>

						</div>
					</form>
					<!--科室信息-->
					<form id="form1" class="wizard-big">
						<div class="hosInfos" id="deptBox">
							<!--标题-->
							<div class="infosNav">
								科室信息
								<span class="addInfoBtns rt deptEdit" id="deptEdit">编辑</span>
								<span class="addInfoBtns rt" id="addDept">新增</span>
							</div>
							<div class="deptList col-sm-11">
								<!--<span class="redStar"style="float:left;">*</span>-->
								<div class="col-sm-2 addDeptBoxWidth">
									<div class="col-sm-12 deptBoxs">
										<input class="deptInput" name="name" maxlength="50" type="text" class="form-control" placeholder="科室名称" disabled="disabled">
										<span class="delIcon deptDel">×</span>
										<div class="deptlineIds" style="display: none;"></div>
									</div>
								</div>
							</div>

						</div>
					</form>

					<!--负责人信息-->
					<form id="form2" class="wizard-big">
						<div class="hosInfos" id="presidentBox">
							<!--标题-->

							<div class="form-group">
								<div class="infosNav">
									负责人信息
									<span class="addInfoBtns rt" id="presidentEdit">编辑</span>
								</div>
								<!--院长-->
								<div class="form-group personInChargeRows">
									<div class="col-sm-12">
										<label class="col-sm-112 control-label labelsPosition">医院院长：</label>
										<div class="col-sm-10 presidentInputList">
											<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
												<input class="president" name="name" maxlength="50" type="text" class="form-control" placeholder="院长姓名" disabled="disabled">
												<span class="delIcon deptDel">×</span>
												<div class="presidentlineIds" style="display: none;"></div>
											</div>
											<div class="addPresident col-sm-1 addPresidentInput">新增</div>
										</div>

									</div>
								</div>
								<!--院长结束-->
								<!--科室负责人开始-->
								<div class="form-group personInChargeRows">
									<div class="col-sm-12">
										<label class="col-sm-112 control-label labelsPosition">科室负责人：</label>
										<div class="col-sm-10 addDepartmentHeadList">
											<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
												<input class="departmentHead" name="name" maxlength="50" type="text" class="form-control" placeholder="负责人姓名及电话" disabled="disabled">
												<span class="delIcon deptDel">×</span>
												<div class="departmentHeadlineIds" style="display: none;"></div>
											</div>
											<div class="addPresident col-sm-1 addDepartmentHeadInput">新增</div>
										</div>
									</div>
								</div>
								<!--科室负责人结束-->
								<div class="form-group personInChargeRows">
									<div class="col-sm-12">
										<label class="col-sm-112 control-label labelsPosition">运营人员：</label>
										<div class="col-sm-10 addOperatorList">
											<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
												<input class="operator" name="name" maxlength="50" type="text" class="form-control" placeholder="运营人姓名及电话" disabled="disabled">
												<span class="delIcon deptDel">×</span>
												<div class="operatorlineIds" style="display: none;"></div>
											</div>
											<div class="addPresident col-sm-1 addOperatorInput">新增</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>

					<!--发票信息-->
					<form id="form3" class="wizard-big">
						<div class="hosInfos" id="billBox">
							<div class="infosNav">
								发票信息
								<span class="addInfoBtns rt billEdit" id="billEdit">编辑</span>
							</div>
							<div class="billId" style="display:none;"></div>
							<div class="form-group addRows">
								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">发票抬头：</label>
									<div class="col-sm-7">
										<input id="billTitle" name="billTitle" maxlength="50" type="text" class="form-control" placeholder="填写单位全称" disabled="disabled">
									</div>
								</div>
								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">开票内容：</label>
									<div class="col-sm-7">
										<input id="billContent" name="billContent" maxlength="50" type="text" class="form-control" placeholder="租赁款/技术服务费" disabled="disabled">
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-12">
									<label class="col-sm-3 control-label labelsPosition taxNumberLabel">纳税人识别号：</label>
									<div class="col-sm-7 taxNumberInput">
										<input id="taxNumber" name="taxNumber" maxlength="50" type="text" class="form-control" placeholder="统一社会信用代码" disabled="disabled">
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">公司地址：</label>
									<div class="col-sm-7">
										<input id="companyAddress" name="companyAddress" maxlength="50" type="text" class="form-control" placeholder="公司注册地址" disabled="disabled">
									</div>
								</div>

								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">公司电话：</label>
									<div class="col-sm-7">
										<input id="billTelephone" name="billTelephone" maxlength="50" type="text" class="form-control" placeholder="注册公司预留电话" disabled="disabled">
									</div>
								</div>
							</div>
							<div class="form-group addRows">
								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">开&nbsp;&nbsp;&nbsp;户&nbsp;&nbsp;&nbsp;行：</label>
									<div class="col-sm-7">
										<input id="openingBank" name="openingBank" maxlength="50" type="text" class="form-control" placeholder="公司账户开户银行地址" disabled="disabled">
									</div>
								</div>
								<div class="col-sm-6">
									<label class="col-sm-3 control-label labelsPosition">银行账号：</label>
									<div class="col-sm-7 openBankTel">
										<input id="bankAccount" name="bankAccount" maxlength="50" type="text" class="form-control" placeholder="银行账号" disabled="disabled">
									</div>
								</div>
							</div>
						</div>
					</form>

					<!--<div class="form-group">
                            <div class="col-sm-12 btnGroup">
                                <button type="submit" class="SureBtn comTempateSaveBtn">确认</button>
                            </div>
                        </div>-->
					</form>
				</div>
			</div>
		</div>

		<div id="myModal" class="modal fade" name="tip-modal" data-backdrop="static" data-keyboard="false" style="text-align: center;">
			<img src="../../img/loading-upload.gif" alt="" style="width:40px;height:40px;margin:0 auto; margin-top:200px;" /> 提交中......
		</div>
		<script src="../../js/jquery.min.js?v=2.1.4"></script>
		<script src="../../js/bootstrap.min.js?v=3.3.5"></script>
		<script src="../../js/plugins/staps/jquery.steps.min.js"></script>
		<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
		<script src="../../js/plugins/validate/messages_zh.min.js"></script>
		<!--<script src="../../js/demo/form-validate-demo.min.js"></script>-->
		<script src="../../js/plugins/summernote/summernote.min.js"></script>
		<script src="../../js/plugins/summernote/summernote-zh-CN.js"></script>
		<script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
		<script src="../../js/content.min.js?v=1.0.0"></script>
		<script type="text/javascript">
			var BASE_URL = '../../js/plugins/webuploader';
		</script>
		<!--<script src="../../js/plugins/webuploader/webuploader.min.js"></script>-->
		<!--<script src="../../js/demo/webuploader-demo.min.js"></script>-->
		<script src="../../js/plugins/jquery.jqprint-0.3.js"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
		<!--<script type="text/javascript" src="../../js/BMaps.js"></script>-->
		<script type="text/javascript" src="//api.map.baidu.com/api?v=3.0&ak=EImTER6Ip7xIAuDEUvuhHul61k0dElRY"></script>
		<!--图形计算工具-->
		<script type="text/javascript" src="../../js/baiduMapAPI/GeoUtils_min.js"></script>
		<!--加载鼠标绘制工具-->
		<script type="text/javascript" src="../../js/baiduMapAPI/DrawingManager_min.js"></script>
		<!--加载鼠标测距-->
		<script type="text/javascript" src="../../js/baiduMapAPI/DistanceTool_min.js"></script>
		<!--加载鼠标拖拽-->
		<script type="text/javascript" src="../../js/baiduMapAPI/RectangleZoom_min.js"></script>
		<!--初始化地图-->
		<script type="text/javascript" src="../../js/projectInfo/initMap.js"></script>
		<!--鼠标绘制操作实例-->
		<script type="text/javascript" src="../../js/projectInfo/drawAction.js"></script>
		<script>
			if(localStorage.getItem("jumpFromHosClick")){
				$(".infosNav .addInfoBtns").css('display','none');
			}else{
				$(".infosNav .addInfoBtns").css('display','block');
			}
			$("#form").validate();
			$(function() {
				$('#myModal').modal('hide');
			});
			$(document).ready(function() {
				$(".summernote").summernote({
					lang: "zh-CN"
				})
			});
			var edit = function() {
				$("#eg").addClass("no-padding");
				$(".click2edit").summernote({
					lang: "zh-CN",
					focus: true
				})
			};
			var save = function() {
				$("#eg").removeClass("no-padding");
				var aHTML = $(".click2edit").code();
				$(".click2edit").destroy()
			};
			var switchBtn = 0; //定义开关默认值
			//			点击开关
			$(".onoffswitch-label").click(function() {
				if(switchBtn == 0) {
					switchBtn = 1;
				} else {
					switchBtn = 0;
				}
			})
			$("#files").change(function(e) {
				console.info(e.target.files[0]); //图片文件
				var dom = $(this)[0];
				//			    console.info(dom.value);//这个是文件的路径 C:\fakepath\icon (5).png
				//			    console.log(e.target.value);//这个也是文件的路径和上面的dom.value是一样的
				var reader = new FileReader();
				reader.onload = (function(file) {
					return function(e) {
						//			           console.info(this.result); //这个就是base64的数据了
						var sss = $("#showImage");
						$("#showImage").html('<img src="' + this.result + '"style="width:200px;height:120px;">');
					};
				})(e.target.files[0]);
				reader.readAsDataURL(e.target.files[0]);
			});
			//			必填项失焦校验
			$("#hosBox").on("blur", ".required", function() {
				$("#form").valid();
			});
			//			点击医院编辑
			$(".hosEdit").click(function() {
				if($(this).text() == '编辑') {
					$(this).text('完成');
					$("#hosBox").find("input").removeAttr("disabled");
					$("#hosBox").find("textarea").removeAttr("disabled");
				} else {
					event.preventDefault();
					if($("#form").valid()) {
						if(!$("#longitude").val().trim()) {
							alert("请标注医院位置！");
							return false;
						}
						if(!$("#latitude").val().trim()) {
							alert("请标注医院位置！");
							return false;
						}
						var formData = new FormData();
						formData.append("id", $('.hosId').text().trim()); //医院名称
						formData.append("hospitalName", $('#hosName').val().trim()); //医院名称
						formData.append("shorthand", $("#hosEasyName").val().trim()); //医院简称
						formData.append("level", $("#hosLevel").val().trim()); //医院等级
						formData.append("characteristicSection", $("#specialDept").val().trim()); //特色科室
						if($("#bedNum").val().trim()) {
							formData.append("bedNumber", parseInt($("#bedNum").val().trim())); //床位数
						} else {
							formData.append("bedNumber", 0); //床位数
						}
						formData.append("introduction", $("#hosInfo").val().trim()); //医院简介
						formData.append("hospitalAddress", $("#hosAddr").val().trim()); //医院地址
						formData.append("longitude", $("#longitude").val().trim()); //医院经度
						formData.append("latitude", $("#latitude").val().trim()); //医院纬度
						$('#myModal').modal('show');
						ajaxPost('/hospital/info/update', formData, function(data) {
							console.log(data);
							$('#myModal').modal('hide');
							if(data.status == 0) {
								swal({
									title: "",
									text: "修改医院成功！"
								});
								$('.hosEdit').text('编辑');
								$("#hosBox").find("input").attr("disabled", "disabled");
								$("#hosBox").find("textarea").attr("disabled", "disabled");
								//								setTimeout(function() {
								//									parent.$(window.parent.document).find(".layui-layer-close").click();
								//								}, 2000);
								//								RefreshIframe("page/hosAdmin/hosAdmin.html", "10");
							} else {
								swal({
									title: "",
									text: "提交失败！"
								});
								$('#myModal').modal('hide');
							}

						});
					}
				}
			});
			//			点击部门编辑
			$(".deptEdit").click(function() {
				if($(this).text() == '编辑') {
					$(this).text('完成');
					$("#deptBox").find("input").removeAttr("disabled");
					$("#addDept").css("display", "block");
					$(".deptBoxs").css("pointer-events", "initial");
				} else {
					var deptArr = []; //部门数组
					if($("#form1").valid()) {

						event.preventDefault();
						var formData = new FormData();
						//					科室
						$(".deptBoxs .deptInput").each(function() {
							if($(this).val() != "" && $(this).val() != null) {
								var objDept = {
									id: $(this).parent().find(".deptlineIds").text(),
									sectionName: $(this).val()
								}
								deptArr.push(objDept);
							}

						});
						formData.append("sectionList", window.JSON.stringify(deptArr)); //科室数组
						formData.append("hospitalId", $("#hosBox .hosId").text().trim());
						$('#myModal').modal('show');
						ajaxPost('/hospital/section/updateSectionByHospitalId', formData, function(data) {
							console.log(data);
							$('#myModal').modal('hide');
							if(data.status == 0) {
								swal({
									title: "",
									text: "科室信息修改成功！"
								});
								$('.deptEdit').text('编辑');
								$("#deptBox").find("input").attr("disabled", "disabled");
								$("#addDept").css("display", "none");
								$(".deptBoxs").css("pointer-events", "none");
								getdetailInfo();
								//								setTimeout(function() {
								//									parent.$(window.parent.document).find(".layui-layer-close").click();
								//								}, 2000);
								//								RefreshIframe("page/hosAdmin/hosAdmin.html", "10");
							} else {
								swal({
									title: "",
									text: "科室信息修改失败！"
								});
								$('#myModal').modal('hide');
							}

						});
					}

				}
			});

			//			负责人信息编辑
			$("#presidentEdit").click(function() {
				if($(this).text() == '编辑') {
					$(this).text('完成');
					$("#presidentBox").find("input").removeAttr("disabled");
					$(".addPresident").css("display", "block");
					$(".presidentInputBox").css("pointer-events", "initial");
				} else {
					var presidentArr = []; //负责人数组
					var HosPresidentArr = []; //院长数组
					var departmentHeadArr = []; //科室负责人数组
					var operatorArr = []; //运营人员数组
					if($("#form2").valid()) {

						event.preventDefault();
						var formData = new FormData();
						//						负责人信息
						//						医院院长
						$(".personInChargeRows input.president").each(function() {
							if($(this).val()) {
								HosPresidentArr.push($(this).val());
							}
						});
						//						科室负责人
						$(".personInChargeRows input.departmentHead").each(function() {
							if($(this).val()) {
								departmentHeadArr.push($(this).val());
							}
						});
						//						运营人员
						$(".personInChargeRows input.operator").each(function() {
							if($(this).val()) {
								operatorArr.push($(this).val());
							}

						});
						var objPresident = {
							responsibleName: window.JSON.stringify(HosPresidentArr),
							type: 1
						}
						var objDepartmentHead = {
							responsibleName: window.JSON.stringify(departmentHeadArr),
							type: 2
						}
						var objOperator = {
							responsibleName: window.JSON.stringify(operatorArr),
							type: 3
						}
						presidentArr = [objPresident, objDepartmentHead, objOperator];
						formData.append("responsibleList", window.JSON.stringify(presidentArr)); //负责人数组
						formData.append("hospitalId", $("#hosBox .hosId").text().trim());
						$('#myModal').modal('show');
						ajaxPost('/hospital/responsible/updateResponsibleByHospitalId', formData, function(data) {
							console.log(data);
							$('#myModal').modal('hide');
							if(data.status == 0) {
								swal({
									title: "",
									text: "修改负责人信息成功！"
								});
								$("#presidentEdit").text('编辑');
								$("#presidentBox").find("input").attr("disabled", "disabled");
								$(".addPresident").css("display", "none");
								$(".presidentInputBox").css("pointer-events", "none");
								getdetailInfo();
								//								setTimeout(function() {
								//									parent.$(window.parent.document).find(".layui-layer-close").click();
								//								}, 2000);
								//								RefreshIframe("page/hosAdmin/hosAdmin.html", "10");
							} else {
								swal({
									title: "",
									text: "修改负责人信息失败！"
								});
								$('#myModal').modal('hide');
							}

						});
					}

				}
			});
			//			发票信息编辑
			$(".billEdit").click(function() {
				if($(this).text() == '编辑') {
					$(this).text('完成');
					$("#billBox").find("input").removeAttr("disabled");
				} else {
					if($("#form3").valid()) {
						if($("#taxNumber").val()) {
							if(!checkTaxpayerId($("#taxNumber").val())) { //纳税人识别号准确性
								$("#taxNumber").parent().append('<label id="billTelephone-error" class="error" for="billTelephone"><i class="fa fa-times-circle"></i>  请输入正确的纳税人识别号</label>');
								return false;
							}
						}
						//							if($("#billTelephone").val()){
						//								if(!(/^1[3456789]\d{9}$/.test($("#billTelephone").val()))){//校验手机号准确性
						//									$("#billTelephone").parent().append('<label id="billTelephone-error" class="error" for="billTelephone"><i class="fa fa-times-circle"></i>  请输入正确的手机号</label>');
						//									return false;
						//								}	
						//							}
						if($("#bankAccount").val()) {
							if(!luhmCheck($("#bankAccount").val())) { //银行账号准确性
								$("#bankAccount").parent().append('<label id="billTelephone-error" class="error" for="billTelephone"><i class="fa fa-times-circle"></i>  请输入正确的银行账号</label>');
								return false;
							}
						}
						event.preventDefault();
						var formData = new FormData();
						formData.append("id", $("#billBox .billId").text().trim());
						formData.append("hospitalId", $("#hosBox .hosId").text().trim());
						formData.append("title", $("#billTitle").val().trim()); //发票抬头
						formData.append("content", $("#billContent").val().trim()); //发票内容
						formData.append("telephone", $("#billTelephone").val().trim()); //发票电话
						formData.append("taxNumber", $("#taxNumber").val().trim()); //纳税人识别号
						formData.append("companyAddress", $("#companyAddress").val().trim()); //公司地址
						formData.append("openingBank", $("#openingBank").val().trim()); //开户行
						formData.append("bankAccount", $("#bankAccount").val().trim()); //银行账号
						$('#myModal').modal('show');
						ajaxPost('/hospital/invoice/update', formData, function(data) {
							console.log(data);
							$('#myModal').modal('hide');
							if(data.status == 0) {
								swal({
									title: "",
									text: "发票信息修改成功！"
								});
								$("#billEdit").text('编辑');
								$("#billBox").find("input").attr("disabled", "disabled");
								//										setTimeout(function() {
								//											parent.$(window.parent.document).find(".layui-layer-close").click();
								//										}, 2000);
								//										RefreshIframe("page/hosAdmin/hosAdmin.html", "10");
							} else {
								swal({
									title: "",
									text: "发票信息修改失败！"
								});
								$('#myModal').modal('hide');
							}

						});
					}

				}
			});
			//			新增科室
			$("#addDept").click(function() {
				$(".deptList").append(`<div class="col-sm-2 addDeptBoxWidth">
									<div class="col-sm-12 deptBoxs">
										<input class="deptInput" name="name"  maxlength="50" type="text" class="form-control" placeholder="科室名称">
										<span class="delIcon deptDel">×</span>
									</div>
								</div>`);
				//			鼠标移上去
				$(".deptBoxs").hover(function() {
					console.log($(".deptBoxs").length);
					if($(".deptBoxs").length > 1) {
						$(this).find(".delIcon").css('display', "inline-block");
					}
				}, function() {
					$(this).find(".delIcon").css('display', "none");
				});
				//			删除新增的科室
				$(".deptList").on("click", ".deptDel", function() {
					$(this).parent().parent().remove();
				});
			});

			getdetailInfo();

			function getdetailInfo() {
				var doctorInfoEditId = localStorage.getItem("doctorInfoEditId");
				ajaxGet('/hospital/info/getHospital', {
					id: doctorInfoEditId
				}, function(data) {
					console.log(data);
					if(data.status == 0) {
						$("#hosBox .hosId").text(data.resultMap.hospital.id); //医院id
						$("#hosName").val(data.resultMap.hospital.hospitalName); //医院名称
						$("#hosEasyName").val(data.resultMap.hospital.shorthand); //医院简称
						$("#hosLevel").val(data.resultMap.hospital.level); //医院等级
						$("#specialDept").val(data.resultMap.hospital.characteristicSection); //特色科室
						$("#bedNum").val(data.resultMap.hospital.bedNumber); //床位
						$("#hosInfo").val(data.resultMap.hospital.introduction); //医院简介
						$("#hosAddr").val(data.resultMap.hospital.hospitalAddress); //医院地址
						$("#longitude").val(data.resultMap.hospital.longitude); //经度
						$("#latitude").val(data.resultMap.hospital.latitude); //纬度
						var longitude = $("#longitude").val();
						var latitude = $("#latitude").val();
						if(longitude != "" && latitude != "") {
							var point = new BMap.Point(longitude, latitude);
							var marker = new BMap.Marker(point); // 创建标注
							map.addOverlay(marker);
						}
						if(data.resultMap.hospital.province == data.resultMap.hospital.city) {
							$("#cityName").val(data.resultMap.hospital.province);
						} else {
							$("#cityName").val(data.resultMap.hospital.province + data.resultMap.hospital.city);
						}
						theCityLocation();
						//		 			科室信息
						$(".deptList").html(`
										<div class="col-sm-2 addDeptBoxWidth">
										<div class="col-sm-12 deptBoxs">
											<input class="deptInput" name="name" disabled="disabled"  maxlength="50" type="text" class="form-control" placeholder="科室名称">
											<span class="delIcon deptDel">×</span>
											<div class="deptlineIds" style="display: none;"></div>
										</div>
									</div>`);
						if(data.resultMap.sectionList.length > 0) {
							$(".deptList .deptInput").val(data.resultMap.sectionList[0].sectionName);
							$(".deptList .deptlineIds").text(data.resultMap.sectionList[0].id);
							for(var k = 1; k < data.resultMap.sectionList.length; k++) {
								$(".deptList").append(`<div class="col-sm-2 addDeptBoxWidth">
										<div class="col-sm-12 deptBoxs">
											<input class="deptInput" name="name" disabled="disabled"  maxlength="50" type="text" class="form-control" placeholder="科室名称"value=` + data.resultMap.sectionList[k].sectionName + `>
											<span class="delIcon deptDel">×</span>
											<div class="deptlineIds" style="display: none;">` + data.resultMap.sectionList[k].id + `</div>
										</div>
									</div>`);
							}
							//			鼠标移上去
							$(".deptBoxs").hover(function() {
								console.log($(".deptBoxs").length);
								if($(".deptBoxs").length > 1) {
									$(this).find(".delIcon").css('display', "inline-block");
								}
							}, function() {
								$(this).find(".delIcon").css('display', "none");
							});
							//			删除新增的科室
							$(".deptList").on("click", ".deptDel", function() {
								$(this).parent().parent().remove();
								if($(this).next().text().trim()) {
									delDept($(this).next().text().trim());
								}
							});
							$(".deptBoxs").css("pointer-events", "none");
						}
						//					医院院长信息   
						$(".presidentInputList").html(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="president" name="name"  maxlength="50" type="text" class="form-control" placeholder="院长姓名"disabled="disabled">
													<span class="delIcon deptDel">×</span>
													<div class="presidentlineIds" style="display: none;"></div>
												</div>
												<div class="addPresident col-sm-1 addPresidentInput">新增</div>`);
						if(data.resultMap.directorList.length > 0) {
							$(".personInChargeRows .president").val(data.resultMap.directorList[0].responsibleName);
							$(".presidentlineIds").text(data.resultMap.directorList[0].id);
							for(var k = 1; k < data.resultMap.directorList.length; k++) {
								$(".presidentInputList .addPresidentInput").before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="president" name="name"  maxlength="50" type="text" class="form-control" disabled="disabled" placeholder="院长姓名"value=` + data.resultMap.directorList[k].responsibleName + `>
													<span class="delIcon deptDel">×</span>
													<div class="presidentlineIds" style="display: none;">` + data.resultMap.directorList[k].id + `</div>
												</div>`);
							}
						}
						//					科室负责人
						$(".addDepartmentHeadList").html(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="departmentHead" disabled="disabled" name="name"  maxlength="50" type="text" class="form-control" placeholder="负责人姓名及电话">
													<span class="delIcon deptDel">×</span>
													<div class="departmentHeadlineIds" style="display: none;"></div>
												</div>
												<div class="addPresident col-sm-1 addDepartmentHeadInput">新增</div>`);
						if(data.resultMap.secitionResponsibleList.length > 0) {
							$(".personInChargeRows .departmentHead").val(data.resultMap.secitionResponsibleList[0].responsibleName);
							$(".departmentHeadlineIds").text(data.resultMap.secitionResponsibleList[0].id);
							for(var k = 1; k < data.resultMap.secitionResponsibleList.length; k++) {
								$(".addDepartmentHeadList .addDepartmentHeadInput").before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="departmentHead" disabled="disabled" name="name"  maxlength="50" type="text" class="form-control" placeholder="负责人姓名及电话"value=` + data.resultMap.secitionResponsibleList[k].responsibleName + `>
													<span class="delIcon deptDel">×</span>
													<div class="departmentHeadlineIds" style="display: none;">` + data.resultMap.secitionResponsibleList[k].id + `</div>
												</div>`);
							}
						}
						//					运营人员
						$(".addOperatorList").html(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="operator" name="name"  disabled="disabled" maxlength="50" type="text" class="form-control" placeholder="运营人姓名及电话">
													<span class="delIcon deptDel">×</span>
													<div class="operatorlineIds" style="display: none;"></div>
												</div>
												<div class="addPresident col-sm-1 addOperatorInput">新增</div>`);
						if(data.resultMap.operatorList.length > 0) {
							$(".personInChargeRows .operator").val(data.resultMap.operatorList[0].responsibleName);
							$(".operatorlineIds").text(data.resultMap.operatorList[0].id);
							for(var k = 1; k < data.resultMap.operatorList.length; k++) {
								$(".addOperatorList .addOperatorInput").before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
													<input class="operator" name="name"  disabled="disabled" maxlength="50" type="text" class="form-control"placeholder="运营人姓名及电话"value=` + data.resultMap.operatorList[k].responsibleName + `>
													<span class="delIcon deptDel">×</span>
													<div class="operatorlineIds" style="display: none;">` + data.resultMap.operatorList[k].id + `</div>
												</div>`);
							}
						}
						//			鼠标移上去
						$(".presidentInputBox").hover(function() {
							if($(this).parent().find(".presidentInputBox").length > 1) {
								$(this).find(".delIcon").css('display', "inline-block");
							}
						}, function() {
							$(this).find(".delIcon").css('display', "none");
						});
						//			删除新增的院长、负责人、运营人员
						$(".presidentInputBox").on("click", ".deptDel", function() {
							$(this).parent().remove();
						});
						$(".presidentInputBox").css("pointer-events", "none");
						//					发票信息
						$("#billBox .billId").text(data.resultMap.invoice.id); //发票id
						$("#billTitle").val(data.resultMap.invoice.title);
						$("#billContent").val(data.resultMap.invoice.content);
						$("#taxNumber").val(data.resultMap.invoice.taxNumber);
						$("#companyAddress").val(data.resultMap.invoice.companyAddress);
						$("#billTelephone").val(data.resultMap.invoice.telephone);
						$("#openingBank").val(data.resultMap.invoice.openingBank);
						$("#bankAccount").val(data.resultMap.invoice.bankAccount);

						//			新增院长
						$(".addPresident").click(function() {
							if($(this).hasClass('addPresidentInput')) {
								$(this).before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
															<input class="president" name="name"  maxlength="50" type="text" class="form-control"placeholder="院长姓名">
															<span class="delIcon deptDel">×</span>
														</div>`);
							} else if($(this).hasClass('addDepartmentHeadInput')) {
								$(this).before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
															<input class="departmentHead" name="name"  maxlength="50" type="text" class="form-control" placeholder="负责人姓名及电话">
															<span class="delIcon deptDel">×</span>
														</div>`);
							} else {
								$(this).before(`<div class="col-sm-111 addDeptBoxWidth presidentInputBox">
															<input class="operator" name="name"  maxlength="50" type="text" class="form-control" placeholder="运营人姓名及电话">
															<span class="delIcon deptDel">×</span>
														</div>`);
							}
							//			鼠标移上去
							$(".presidentInputBox").hover(function() {
								if($(this).parent().find(".presidentInputBox").length > 1) {
									$(this).find(".delIcon").css('display', "inline-block");
								}
							}, function() {
								$(this).find(".delIcon").css('display', "none");
							});
							//			删除新增的院长、负责人、运营人员
							$(".presidentInputBox").on("click", ".deptDel", function() {
								$(this).parent().remove();
							});
						});
					}
				});
			}

			//			删除科室
			function delDept(id) {
				ajaxGet('/hospital/section/remove', {
					id: id
				}, function(data) {
					console.log(data);
					$('#myModal').modal('hide');
					if(data.status == 0) {
						swal({
							title: "",
							text: "删除成功！"
						});
						//								setTimeout(function() {
						//									parent.$(window.parent.document).find(".layui-layer-close").click();
						//								}, 2000);
						//								RefreshIframe("page/hosAdmin/hosAdmin.html", "10");
					} else {
						swal({
							title: "",
							text: "删除失败！"
						});
						$('#myModal').modal('hide');
					}

				});
			}

			function checkTaxpayerId(taxpayerId) {
				var regArr = [/^[\da-z]{10,15}$/i, /^\d{6}[\da-z]{10,12}$/i, /^[a-z]\d{6}[\da-z]{9,11}$/i, /^[a-z]{2}\d{6}[\da-z]{8,10}$/i, /^\d{14}[\dx][\da-z]{4,5}$/i, /^\d{17}[\dx][\da-z]{1,2}$/i, /^[a-z]\d{14}[\dx][\da-z]{3,4}$/i, /^[a-z]\d{17}[\dx][\da-z]{0,1}$/i, /^[\d]{6}[\da-z]{13,14}$/i],
					i, j = regArr.length;
				for(var i = 0; i < j; i++) {
					if(regArr[i].test(taxpayerId)) {
						return true;
					}
				}
				//纳税人识别号格式错误
				return false;
			}

			function luhmCheck(cardNum) {
				cardNum = (cardNum + '').replace(/\s+/g, '');
				if(!(/^\d{16,19}$/).test(cardNum)) {
					console.log('is not a bank card number');
					return false;　　
				}

				　　
				var numbers = cardNum.split('').reverse();　　
				var sum = 0;　　
				for(var i = 0; i < numbers.length; i++) {　　　　
					if(i % 2 == 0) {　　　　　　
						sum += numbers[i] * 1;　　　　
					} else {　　　　
						sum += numbers[i] * 2 > 9 ? numbers[i] * 2 - 9 : numbers[i] * 2;　　　　
					}　　
				}

				　　
				return sum % 10 == 0;
			}
		</script>
	</body>

</html>