<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>远程医疗管理系统-角色管理</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
	</head>
	<!--<link rel="stylesheet" type="text/css" href="../../css/foundation.min.css"/>-->
	<link href="../../css/foundation-datepicker.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css"/>
	<link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../../css/patientInfo.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/calendar.css"/>
	<style>
		.patientInfoList-all,.patientInfoList-code,.patientInfoList-sex,.patientInfoList-circ,.patientInfoList-check{
			width: 10%;
			font-family: "microsoft yahei";
			font-size: 12px;
			
		}
		.patientInfoList-name,.patientInfoList-change,.patientInfoList-del{
			width: 10%;
			font-family: "microsoft yahei";
			font-size: 12px;
		}
		
		.patientInfoList-id,.patientInfoList-tel,.patientInfoList-history,.patientInfoList-allergic,.patientInfoList-Addr{
			width: 30%;
			font-family: "microsoft yahei";
			font-size: 12px;
			
		}
		
		.patientInfoDetail-radio,.patientInfoDetail-code,.patientInfoDetail-sex,.patientInfoDetail-circ,.patientInfoDetail-check{
			width: 10%;
			font-family: "microsoft yahei";
			font-size: 12px;
			text-align: center;
		}
		.patientInfoDetail-name,.patientInfoDetail-change,.patientInfoDetail-del{
			width: 10%;
			font-family: "microsoft yahei";
			font-size: 12px;
			text-align: center;
		}
		.patientInfoDetail-id,.patientInfoDetail-tel,.patientInfoDetail-history,.patientInfoDetail-allergic,.patientInfoDetail-Addr{
			width: 30%;
			font-family: "microsoft yahei";
			font-size: 12px;
			text-align: center;
		}
		.white_content{
			width: 400px;
			min-width:350px;
			left: 40%;
		}
		.liBig textarea {
		    height: 70px !important;
		    width: 300px !important;
		    line-height: 20px;
		}
		#add-ok{
			margin-left: 26%;
		}
	</style>
	<body>
		<div class="patientInfoBox">
		<!--第一行信息-->
			<div class="patientInfoHead topBox">
				<div class="patientNanme">
					<!--角色名称：-->
					<input class="patientNanmeRight queryContent" type="text" id="ListpatientName" value="" placeholder="角色名称"style="width:300px;"/>
				</div>
				
				<button class="patientBtnCheck topBtn queryBtn" id="patientSearchBtns">查询</button>
				<button class="patientBtnClear topBtn resetbtn"id="patientSearchClearBtn">清空</button>
				<button class="patientBtnAdd topBtn RightBtn"id="addPermission"style="text-align: center;letter-spacing:0px;">新增角色</button>
			</div>
		<!--信息列表-->	
		<div class="patientInfoList outBoxBorder">
			<div class="tableNav">岗位角色</div>
			<ul class="patientInfoList-ul titleList">
				<!--<li class="patientInfoList-all">全选</li>-->
				<li class="patientInfoList-code LiTextAlign boxRightBorder">序号</li>
				<li class="patientInfoList-name LiTextAlign boxRightBorder">角色名称</li>
				<li class="patientInfoList-id LiTextAlign boxRightBorder">描述</li>
				<!--<li class="patientInfoList-check">查询</li>-->
				<li class="patientInfoList-change LiTextAlign">操作</li>
				<!--<li class="patientInfoList-change LiTextAlign">修改(APP角色权限)</li>
				<li class="patientInfoList-del LiTextAlign">删除</li>-->
			</ul>
			<!--列表内容-->
			<div id="patientInfoContents">
				<!--<ul class="patientInfoDetail-ul">
					<li class="patientInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>
					<li class="patientInfoDetail-code"><span>1</span></li>
					<li class="patientInfoDetail-name"><span>某某某</span></li>
					<li class="patientInfoDetail-sex"><span>男</span></li>
					<li class="patientInfoDetail-id"><span>120105198506891157</span></li>
					<li class="patientInfoDetail-tel"><span>13612345678</span></li>
					<li class="patientInfoDetail-history"><span>糖尿病</span></li>
					<li class="patientInfoDetail-allergic"><span>无过敏史</span></li>
					<li class="patientInfoDetail-circ"><a href = "javascript:void(0)" class="btn-circ"><img src="../../img/common/1.jpg"/></a></li>
					<li class="patientInfoDetail-check"><a href = "javascript:void(0)" class="patientBtn-check"><img src="../../img/common/untitledSearBtn.png"/></a></li>
					<li class="patientInfoDetail-change"><a href = "javascript:void(0)" class="patientBtn-change"><img src="../../img/common/untitledChangeBtn.png"/></a></li>
					<li class="patientInfoDetail-del"><a href = "javascript:void(0)" class="patientBtn-del"><img src="../../img/common/untitledDelBtn.png"/></a></li>
				</ul>-->
			</div>
		</div>
			  <div class="clearfix"></div>
			  <!--分页-->
			  <div class="patientpageN"></div>
			  <!--流转信息弹框弹框1-->
			  <div id="patientLight" class="white_content">
			  	<div class="white_contentHead">
			  		<span class="infoTitle">流转信息</span>
			  		 <a id="close" class="close"href = "javascript:void(0)" onclick = "document.getElementById('patientLight').style.display='none';document.getElementById('patientFade').style.display='none'">&times;</a>
			  	</div>
               <div class="line">
               	   <div id="round1"></div>
                   <div id="round2"></div>
                   <div id="round3"></div>
                   <div id="round4"></div>
                   <span id="date">预约</span>
                   <span id="ask">问诊</span>
                   <span id="report">诊断报告</span>
                   <span id="adv">建议治疗</span>
                   <span id="other">转诊</span>
                   <span id="scenter">XX服务中心</span>
                   <span id="doctor1">XX医生</span>
                   <span id="doctor2">XX医生</span>
                   <span id="time1">2018年11月22日</span>
                   <span id="time2">2018年11月22日</span>
                   <span id="time3">2018年11月22日</span>
                   <div id="lineLeft"></div>	
                   <div id="lineRight"></div>
                   <div id="lineBottom"></div>
                   <div id="littleRound1"></div>
                   <div id="littleRound2"></div>
                   <div id="sanJiao"></div>
               </div>
			  </div>
			  
			  <!--删除-->
			  
			  <div id="patientLight2" class="white_content1">
				<div class="content_header">
					<div class="header_title">删除</div>
						<div class="close">
						<span onclick="document.getElementById('patientLight2').style.display='none';document.getElementById('patientFade').style.display='none'">×</span>
					</div>
				</div>
				<div class="content_middle">
					<div class="chooseDel">
						<div>
							<img src="../../img/warn.png" width="55" height="48">
							删除信息
						</div>
						<div>删除后不可恢复，确定要删除该信息吗？</div>
					</div>
					<!--<a id="close3" href="javascript:void(0)" onclick="document.getElementById('doctorlight2').style.display='none';document.getElementById('fade').style.display='none'">取消</a>-->
					<div class="DelhiddenIds"style="display: none;"></div>
					<div class="btnGroup">
						<button id="del-yes" class="comTempateSaveBtn">确定删除</button>
					</div>
				</div>
				
                
			  </div>
			  
			  <!--患者新增-->
			  <div id="patientLight4" class="white_content">
			  	<div class="white_contentHead">
			  		<span class="infoTitle">新增角色信息</span>
			  		 <a id="close"class="close" href = "javascript:void(0)" onclick = "document.getElementById('patientLight4').style.display='none';document.getElementById('patientFade').style.display='none'">&times;</a>
			  	</div>
                <div class="infoDetails"style="overflow-y: hidden;">
                	<div class="infoDetailsHead">新增角色信息</div>
                	<ul class="infoDetails-ul">
                		
                		<li class="liBig"><span class="infoDetails-title">名称：</span><textarea name="" id="permissionName" value="" /></textarea></li>
                		<li class="liBig"><span class="infoDetails-title">描述：</span><textarea name="" id="permissionDetail" value="" /></textarea></li>
                	</ul>
                	
                	
                </div>
                <a id="close4" href = "javascript:void(0)" onclick = "document.getElementById('patientLight4').style.display='none';document.getElementById('patientFade').style.display='none'">取消</a>
			  	<button id="add-ok">确定新增</button>
			  </div>
			  
			  <!--点击按钮修改-->
			  
			  <div id="patientLight5" class="white_content">
			  	<div class="white_contentHead">
			  		<span class="infoTitle">角色信息修改</span>
			  		 <a id="close" class="close"href = "javascript:void(0)" onclick = "document.getElementById('patientLight5').style.display='none';document.getElementById('patientFade').style.display='none'">&times;</a>
			  	</div>
                <div class="infoDetails"style="overflow-y: hidden;">
                	<div class="infoDetailsHead">角色信息修改</div>
                		<ul class="infoDetails-ul">
	                		<li class="liBig"><span class="infoDetails-title">名称：</span><textarea name="" id="changePermissionName" value="" /></textarea></li>
	                		<li class="liBig"><span class="infoDetails-title">描述：</span><textarea name="" id="changePermissionDetail" value="" /></textarea></li>
	                		<li class="hiddenLineIds"style="display: none;"></li>
                		</ul>
                </div>
                               
                <a id="change-cancle" style="width: 100px;margin-left: 10px;"href = "javascript:void(0)" onclick = "document.getElementById('patientLight5').style.display='none';document.getElementById('patientFade').style.display='none'">取消修改</a>
			 	<button id="change-ok"style="width: 100px;margin-left: 26%;">确定修改</button>  
			  </div>
			  <!--灰背景-->
              <div id="patientFade" class="black_overlay"></div>
  
		</div>
		
	</body>
	<script src="../../js/jquery-3.0.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/foundation-datepicker.js"></script>	
	<script type="text/javascript" src="../../js/contabs.min.js"></script>
	<script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
	<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$('#addPatientBornTime').fdatepicker({format: 'yyyy-mm-dd'});
		$('#changeInfoPatientBornTime').fdatepicker({format: 'yyyy-mm-dd'});
//		点击流转信息按钮		
		$(document).on("click",".btn-circ",function(){
			$("#patientLight").fadeIn();
			$("#patientFade").fadeIn();
		});
//		点击删除按钮
		$("#patientInfoContents").on("click",".patientBtn-del",function(){
			var currentLineIds=$(this).parent().parent().find(".patientInfoDetail-lineId").text();
			$("#patientLight2").fadeIn();
			$("#patientFade").fadeIn();
			$("#patientLight2 .DelhiddenIds").text(currentLineIds);
		});
//		点击新增按钮
		$(".patientBtnAdd").click(function(){
//			console.log($(window.parent.document).find("#postGoto"));
//			parent.$(window.parent.document).find("#postGoto").click();
//			RefreshIframe("page/post/postPage.html","postGoto");
			  parent.layer.open({
			    type: 2,
			    title: '角色新增',
			    shadeClose: true,
			    shade: [0.5],
			    maxmin: true, //开启最大化最小化按钮
			    area: ['1000px', '550px'],
			    content: './page/post/postPage.html'
			});
		});
//		点击修改按钮		
     $("#patientInfoContents").on("click",".patientBtn-change",function(){
//      	获取当前行的信息
        	var currentLineIds=$(this).parent().parent().find(".patientInfoDetail-lineId").text();
			var currentLineName=$(this).parent().parent().find(".patientInfoDetail-name span").text();//名称
			var currentLineidCode=$(this).parent().parent().find(".patientInfoDetail-id span").text();//描述
//  		parent.$(window.parent.document).find("#postChangeGoto").click();
//			RefreshIframe("page/post/postChange.html","postChangeGoto");
    		localStorage.setItem("patientInfoDetail-lineId",currentLineIds);
    		parent.layer.open({
			    type: 2,
			    title: '角色修改',
			    shadeClose: true,
			    shade: [0.5],
			    maxmin: true, //开启最大化最小化按钮
			    area: ['1000px', '550px'],
			    content: './page/post/postChange.html'
			});
     });
//     点击修改app权限 按钮
$("#patientInfoContents").on("click",".patientBtn-change-app",function(){
//      	获取当前行的信息
        	var currentLineIds=$(this).parent().parent().find(".patientInfoDetail-lineId").text();
			var currentLineName=$(this).parent().parent().find(".patientInfoDetail-name span").text();//名称
			var currentLineidCode=$(this).parent().parent().find(".patientInfoDetail-id span").text();//描述
//  		parent.$(window.parent.document).find("#postChangeGoto").click();
//			RefreshIframe("page/post/postChangeApp.html","postChangeGotoApp");
    		localStorage.setItem("patientInfoDetail-lineId-app",currentLineIds);
    		parent.layer.open({
			    type: 2,
			    title: '角色修改',
			    shadeClose: true,
			    shade: [0.5],
			    maxmin: true, //开启最大化最小化按钮
			    area: ['1000px', '550px'],
			    content: './page/post/postChangeApp.html'
			});
     });
//时间戳转时间方法
function formatDateTime(timeStamp) {   
	var date = new Date(parseInt(timeStamp));
	Y = date.getFullYear();
	M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1);
	D = date.getDate();
	h = date.getHours() + ':';
	m = date.getMinutes() + ':';
	s = date.getSeconds();      
	return Y + '-' + M + '-' + D;    
};

//  获取用户id       
		var userId=sessionStorage.getItem('userId');
		var sessionId=sessionStorage.getItem('sessionId');
//      以下为调取接口的部分
		var currentPage = 1;
				var offsetPage=0;//传输的页起始条数
				var showNum=10;//页面需要显示的条数
				var num_pages;
			//点击分页页数
				$(document).delegate(".flipOver",'click',function(){
					$(this).addClass('active').siblings().removeClass('active');
					currentPage = parseInt($(this).attr("pageId"));
					offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
					getPatientList();
					window.scrollTo(0,0);
				});
			//点击上一页
				$(document).delegate("#prev",'click',function(){	
					if($(".flipOver.active").prev().attr("id") == "prev"){
						return true
					}else{
						var page = parseInt($(".flipOver.active").attr("pageid"))-1;
						$(".flipOver.active").prev().addClass("active").siblings().removeClass("active")
					}
					currentPage = page;
					offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
					getPatientList();
					window.scrollTo(0,0);
				});
				
				
			//点击下一页
				$(document).delegate("#Next",'click',function(){
					if($(".flipOver.active").next().attr("id") == "Next"){
						return true
					}else{
						var page = parseInt($(".flipOver.active").attr("pageid"))+1;
						$(".flipOver.active").next().addClass("active").siblings().removeClass("active")
					}
					currentPage = page;
					offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
					getPatientList();
					window.scrollTo(0,0);
				});	
				//点击分页跳转页按钮
			    $(document).delegate(".srueToJumpPageBtn",'click',function(){
			        currentPage = parseInt($(".toPageNum").val().trim());
			        offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
			        getPatientList();
			        window.scrollTo(0,0);
			    });
				getPatientList();
				//	获取订单列表
				function getPatientList(){
//					console.log("coming......");
					$("#patientInfoContents").html('');
					ajaxGet('/sys/role/getRoleList', {
						//员工姓名
						nameLike:getPatientName,
						offset:offsetPage,//（页码-1）*每页显示条数
						limit:showNum//每页赢显示的条数	
					},function(data){
							console.log("aaaaaaaaaaaaaaaaaaa");
							console.log(data);
							var patinfoList=data.resultMap.roleList;
							var listTotal=data.resultMap.total;//总条数
//							var index = data.viewIndex;
							num_pages = Math.ceil(parseInt(listTotal)/10);//总条数除以每页十条数据为总页码
							for(var i=0,k=0;i<patinfoList.length;i++){
//								console.log(patinfoList[i].name);
								var pathtml='';
								k++;
								pathtml+='<ul class="patientInfoDetail-ul dataList">';
								pathtml+='<li class="patientInfoDetail-lineId boxRightBorder" style="display:none">'+patinfoList[i].id+'</li>';
//								pathtml+='<li class="patientInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>';	
								pathtml+='<li class="patientInfoDetail-code LiTextAlign boxRightBorder"><span>'+k+'</span></li>';
								pathtml+='<li class="patientInfoDetail-name LiTextAlign boxRightBorder"><span>'+patinfoList[i].name+'</span></li>';
								if(patinfoList[i].remark==""||patinfoList[i].remark==null){
									pathtml+='<li class="patientInfoDetail-id LiTextAlign boxRightBorder"><span></span></li>';
								}else{
									pathtml+='<li class="patientInfoDetail-id LiTextAlign boxRightBorder"><span>'+patinfoList[i].remark+'</span></li>';
								}
//								pathtml+='<li class="patientInfoDetail-check"><a href = "javascript:void(0)" class="patientBtn-check"><img src="../../img/common/untitledSearBtn.png"/></a></li>';	
								pathtml+='<li class="patientInfoDetail-change LiTextAlign btnWidth"><a href = "javascript:void(0)" class="patientBtn-change btnTextColor"><span class="changeImg">修改web</span></a></li>';
								pathtml+='<li class="patientInfoDetail-change LiTextAlign btnWidth"><a href = "javascript:void(0)" class="patientBtn-change-app btnTextColor"><span class="changeImg">修改App</span></a></li>';
								pathtml+='<li class="patientInfoDetail-del LiTextAlign btnWidth"><a href = "javascript:void(0)" class="patientBtn-del btnTextColor"><span class="changeImg">删除</span></a></li>';	
								pathtml+='</ul>';
					      		$("#patientInfoContents").append(pathtml);
								var pageHtml = page(parseInt(currentPage),num_pages);
								$(".patientpageN").html(pageHtml);
							}
							if(data.status==1){
							}
						});
					
			}
//			模态框
//				$("#patientFade").css("height",window.screen.height);
//				$("#patientFade").css("width",window.screen.width);

//		点击新增患者信息的确认新增
		$("#patientLight4 #add-ok").click(function(){
			var permissionName=$("#permissionName").val().trim();//患者名
			var permissionDetail=$("#permissionDetail").val().trim();//患者名
			if(permissionName==""||permissionName==null){
				alert("请输入姓名！");
			}else if(permissionDetail==""||permissionDetail==null){
				alert("请输入描述！");
			}else{
				$.ajax({
					method: 'get',
					url: config+'/oa/patinfo/save',
					contentType: "application/json; charset=utf-8",//传到后台的数据格式
					async: true, 
					data: {
						'name':patientName,
						'sex':addPatientSex,
						'birthday':addPatientBornDate,
						'idCode':addPatientIdentityCode,
						'address':addPatientHomeAddr,
						'phone':addPatientTel,
						'weight':addPatientWeight,
						'stature':addPatientTall,
						'marriage':addPatientMarriage,
						'inputUserId':userId,//用户id
						'medicalHistory':addPatientMedicalHistory,//现病史
						'pastHistory':addPatientPastHistory,//既往史
						'allergyHistory':addPatientAllergyHistory,//过敏史
						'familyHistory':addPatientfamilyHistory//家族史
					},
					dataType:'jsonp',//接收值的格式
					jsonp: 'jsoncallback', 
					success: function(data) {  
						console.log(data);
						if(data.status==1){
							document.getElementById('patientLight4').style.display='none';
							document.getElementById('patientFade').style.display='none';
							alert(data.message)
							getPatientList();
						}else{
							alert(data.message);
					//		window.location.reload();
						}
					},
					error: function(result) {
						console.log(result);
					}
				});
			}
			
		});

//		点击确认删除按钮
		$("#patientLight2 #del-yes").click(function(){
			var DelhiddenIds=$("#patientLight2 .DelhiddenIds").text();//当行id
			ajaxGet('/sys/role/remove',{id:DelhiddenIds},function(data) {
					console.log(data);
					if(data.status == 0) {
						document.getElementById('patientLight2').style.display = 'none';
						document.getElementById('patientFade').style.display = 'none';
						swal({
								title: "",
								text: data.message
							});
						getPatientList();
					} else {
						swal({
								title: "",
								text: data.message
							});
						document.getElementById('patientLight2').style.display = 'none';
						document.getElementById('patientFade').style.display = 'none';
					}
				});
		});
	var getPatientName='';
	var getPatientSex='';
	var getPatientIdCode='';
	var getPatientPhone='';
	$("#patientSearchBtns").click(function(){
		currentPage = 1;
		offsetPage = 0;
		getPatientName=$("#ListpatientName").val();
		getPatientSex=$(".patientSexRight").val();
		getPatientIdCode=$(".patientIDright").val();
		getPatientPhone=$(".patienTelRight").val();
		getPatientList();
	});
//	点击清空
	$("#patientSearchClearBtn").click(function(){
		$("#ListpatientName").val("");
		$(".patientSexRight").val("");
		$(".patientIDright").val("");
		$(".patienTelRight").val("");
		getPatientName="";
		getPatientSex="";
		getPatientIdCode="";
		getPatientPhone="";
		getPatientList();
	});
	</script>

</html>
