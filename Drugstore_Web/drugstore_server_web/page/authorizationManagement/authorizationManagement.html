<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>权限信息管理</title>

		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
	</head>
	<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../css/common.css" />
	<link rel="stylesheet" type="text/css" href="../../css/authorizationManagement.css" />
	<!--<link rel="stylesheet" type="text/css" href="../../css/commonStyle.css" />-->
	<!--<link rel="stylesheet" type="text/css" href="../../css/jcDate.css"/>-->

	<body>
		<div class="authorizationManageInfoBox">
			<!--第一行信息-->
			<div class="authorizationManageInfoHead">
				<div class="authorizationManageNanme">
					<span class="authorizationManageNanmeLeft">姓名</span>
					<input class="authorizationManageNanmeRight" type="text" id="authorizationManageInfoSearchName" value="" />
				</div>
				<!--<div class="authorizationManageSex">
					<span class="authorizationManageSexLeft">医院</span>
					<select name="" class="authorizationManageSexRight"id="authorizationManageInfoSearchHos">
					</select>
				</div>

				<div class="authorizationManageSex">
					<span class="authorizationManageSexLeft">科室</span>
					<select name="" class="authorizationManageSexRight"id="authorizationManageInfoSearchTechOffice">
					</select>
				</div>-->
				

				<button class="authorizationManageBtnCheck"id="authorizationManageSearchBtns">查询</button>
				<button class="authorizationManageBtnClear"id="authorizationManageSearchClearData">清空</button>
				<!--<button class="authorizationManageBtnAdd">新增</button>-->
			</div>
			<!--信息列表-->
			<div class="authorizationManageInfoList">
				<ul class="authorizationManageInfoList-ul">
					<!--<li class="authorizationManageInfoList-all">全选</li>-->
					<li class="authorizationManageInfoList-code LiTextAlign">序号</li>
					<li class="authorizationManageInfoList-name LiTextAlign">姓名</li>
					
					<li class="authorizationManageInfoList-id LiTextAlign">账号</li>
					<li class="authorizationManageInfoList-tel LiTextAlign">组织机构</li>
					<li class="authorizationManageInfoList-des LiTextAlign">岗位</li>
					<!--<li class="authorizationManageInfoList-sex">状态</li>-->
					<!--<li class="authorizationManageInfoList-check">查询</li>-->
					<li class="authorizationManageInfoList-change LiTextAlign">操作</li>
					<!--<li class="authorizationManageInfoList-del">删除</li>-->
				</ul>
				<!--医生信息列表内容区-->
				<div id="authorizationManageContentList">
					<!--<ul class="authorizationManageInfoDetail-ul">
					<li class="authorizationManageInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>
					<li class="authorizationManageInfoDetail-code"><span>1</span></li>
					<li class="authorizationManageInfoDetail-name"><span>天津医科大学总医院</span></li>
					<li class="authorizationManageInfoDetail-sex"><span>心内科</span></li>
					<li class="authorizationManageInfoDetail-id"><span>王医生</span></li>
					<li class="authorizationManageInfoDetail-tel"><span>13612345678</span></li>
					<li class="authorizationManageDescript"><span>副主任医师，擅长治疗心内疾病，30年临床经验</span></li>
					<li class="authorizationManageInfoDetail-check"><a href = "javascript:void(0)" class="btn-check"><img src="../../img/common/untitledSearBtn.png"/></a></li>
					<li class="authorizationManageInfoDetail-change"><a href = "javascript:void(0)" class="btn-change"><img src="../../img/common/untitledChangeBtn.png"/></a></li>
					<li class="authorizationManageInfoDetail-del"><a href = "javascript:void(0)" class="btn-del"><img src="../../img/common/untitledDelBtn.png"/></a></li>
				</ul>-->
				</div>

			</div>
			<div class="clearfix"></div>
			<!--分页-->
			<div class="authorizationManagepageN"></div>

			<!--患者信息查询-->

			<div id="authorizationManagelight1" class="white_content">
				<div class="white_contentHead">
					<span class="infoTitle">用户信息查询</span>
					<a id="close"class="close" href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight1').style.display='none';document.getElementById('fade').style.display='none'">&times;</a>
				</div>
				<div class="infoDetails"style="overflow: hidden;">
					<div class="infoDetailsHead">用户信息查询</div>
					<ul class="infoDetails-ul">
						<li><span class="infoDetails-title">用户类型：</span><input type="text" name="" id="lookauthorizationManageInfoUserType" value="" /></li>
						<li class="lookHosInfos"><span class="infoDetails-title">医院姓名：</span><input type="text" name="" id="lookauthorizationManageInfoHospName" value="医科大学总医院" /><input type="texts"class="hiddenLookauthorizationManageInfoHospId" style="display: none;"/></li>
						<li class="lookOfficeInfos"><span class="infoDetails-title">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室：</span><input type="text" name="" id="lookauthorizationManageInfoTechOffice" value="心内科" /><input type="texts"class="hiddenLookauthorizationManageInfoTechOId" style="display: none;"/></li>
						<li class="lookDeptInfos"><span class="infoDetails-title">部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门：</span><input type="text" name="" id="lookauthorizationManageInfoDept" value="" /><input type="texts"class="hiddenLookauthorizationManageInfoDeptId" style="display: none;"/></li>
						<li><span class="infoDetails-title">用户姓名：</span><input type="text" name="" id="lookauthorizationManageInfoUserName" value="王医生" /></li>
						<li><span class="infoDetails-title">联系电话：</span><input type="text" name="" id="lookauthorizationManageInfoTel" value="00000000000000" /></li>
						<li class="liBig"><span class="infoDetails-title lf">医生描述：</span><textarea type="text" name="" id="lookauthorizationManageInfoDetail"class="lf" value="副主任医师等等" /></textarea></li>
						<!--<li class="liBig"><span class="infoDetails-title">过敏史：</span><input type="text" name="" id="" value="冠心病，高血压，心脏病，三高，前列腺炎，胸闷气短，憋气压抑等" /></li>-->
					</ul>

				</div>
				<!--<button id="infoDetails-close">关闭</button>-->
				<a id="close2" href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight1').style.display='none';document.getElementById('fade').style.display='none'">关闭</a>
			</div>

			<!--删除-->

			<div id="authorizationManagelight2" class="white_content1">
				<div class="white_contentHead1">
					<img src="../../img/common/untitledquestionImg.png" />
				</div>
				<p>删除医生信息后不可恢复，您确定要删除该信息吗？</p>
				<a id="close3" href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight2').style.display='none';document.getElementById('fade').style.display='none'">取消</a>
				<div class="delHiddenListId"style="display: none;"></div>
				<button id="del-yes">确定删除</button>
			</div>

			<!--医生新增-->
			<div id="authorizationManagelight4" class="white_content">
				<div class="white_contentHead">
					<span class="infoTitle">用户新增</span>
					<a id="close" class="close"href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight4').style.display='none';document.getElementById('addauthorizationManageInfoDeptLay').style.display='none';document.getElementById('fade').style.display='none'">&times;</a>
				</div>
				<div class="infoDetails">
					<div class="infoDetailsHead">用户新增信息</div>
					<ul class="infoDetails-ul">
						<li class="authorizationManageSelectUserIdentity">
							<span class="infoDetails-title">用户身份：
                			<select name="" style="width: 200px;height: 30px;"id="addauthorizationManageInfoUserInfo">
                				<option value="1"selected="selected">医生</option>
                				<option value="2">非医生</option>
                			</select>
                		</li>
                		<li class="AddauthorizationManageInfohospitalName"><span class="infoDetails-title">医院姓名：
                			<select name="" style="width: 200px;height: 30px;"id="addauthorizationManageInfoHspName">
                				<!--<option value=""></option>
                				<option value="医院1">医院1</option>
                				<option value="医院2">医院2</option>
                				<option value="医院3">医院3</option>-->
                			</select>
                		</li>
                		<li class="AddauthorizationManageInfoTechOffice"><span class="infoDetails-title">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室：
                			<select name="" style="width: 200px;height: 30px;"id="addauthorizationManageInfoTechOffice">
                				<!--<option value=""></option>
                				<option value="科室1">科室1</option>
                				<option value="科室2">科室2</option>
                				<option value="科室3">科室3</option>-->
                			</select>
                		</li>
                		<li class="AddauthorizationManageInfoChoseDept">
                			<span class="infoDetails-title">部门：</span><input type="text" name="" id="addauthorizationManageInfoDept" value="" placeholder="点击选择部门" disabled="disabled" /><input type="text" id="addauthorizationManageInfoDeptHiddenId" style="display: none;" />
						</li>
						<li><span class="infoDetails-title">用户姓名：</span><input type="text" name="" id="addauthorizationManageInfoDocName" value="" /></li>
						<li><span class="infoDetails-title">联系电话：</span><input type="text" name="" id="addauthorizationManageInfoDocTel" value="" /></li>
						<li class="liBig">
							<span class="infoDetails-title lf"style="display: inline-block;height:100px;">医生描述：</span>
							<textarea id="addauthorizationManageInfoDetail lf"style="height:100px;width:90%;"></textarea>
						</li>
					</ul>
					<!--部门弹出层-->
					<div id="addauthorizationManageInfoDeptLay">
						<ul class="addauthorizationManageInfoDept1 lf">
							<!--<li class="activeChoseDept">
                				部门1
                			</li>-->
						</ul>
						<!--<ul class="addauthorizationManageInfoDept2 lf">
                			<li>
                				部门11
                			</li>
                		</ul>-->
					</div>

				</div>
				<button id="add-ok">确定新增</button>

				<a id="close4" href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight4').style.display='none';document.getElementById('fade').style.display='none'">取消</a>
			</div>

			<!--点击按钮修改-->

			<div id="authorizationManagelight5" class="white_content">
				<div class="white_contentHead">
					<span class="infoTitle">用户信息修改</span>
					<a id="close"class="close" href="javascript:void(0)" onclick="document.getElementById('changeauthorizationManageInfoDeptLay').style.display='none';document.getElementById('authorizationManagelight5').style.display='none';document.getElementById('fade').style.display='none'">&times;</a>
				</div>
				<div class="infoDetails">
					<div class="infoDetailsHead">用户信息修改</div>
					<ul class="infoDetails-ul">
						<li class="changeauthorizationManageSelectUserIdentity">
							<span class="infoDetails-title">用户身份：
                			<select name="" style="width: 200px;height: 30px;"id="changeauthorizationManageInfoUserInfo">
                				<option value="1"selected="selected">医生</option>
                				<option value="2">非医生</option>
                			</select>
                		</li>
                		<li class="changeauthorizationManageInfohospitalName"><span class="infoDetails-title">医院姓名：
                			<select name="" style="width: 200px;height: 30px;"id="changeauthorizationManageInfoHspName">
                				<!--<option value=""></option>
                				<option value="医院1">医院1</option>
                				<option value="医院2">医院2</option>
                				<option value="医院3">医院3</option>-->
                			</select>
                		</li>
                		<li class="changeauthorizationManageInfoTechOffice"><span class="infoDetails-title">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室：
                			<select name="" style="width: 200px;height: 30px;"id="changeauthorizationManageInfoTechOffice">
                				<!--<option value=""></option>
                				<option value="科室1">科室1</option>
                				<option value="科室2">科室2</option>
                				<option value="科室3">科室3</option>-->
                			</select>
                		</li>
                		<li class="changeauthorizationManageInfoChoseDept">
                			<span class="infoDetails-title">部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门：</span><input type="text" name="" id="changeauthorizationManageInfoDept" value="" placeholder="点击选择部门" disabled="disabled" /><input type="text" id="changeauthorizationManageInfoDeptHiddenId" style="display: none;" />
						</li>
						<li><span class="infoDetails-title">用户姓名：</span><input type="text" name="" id="changeauthorizationManageInfoDocName" value="" /></li>
						<li><span class="infoDetails-title">联系电话：</span><input type="text" name="" id="changeauthorizationManageInfoDocTel" value="" /></li>
						<li class="liBig"><span class="infoDetails-title lf">医生描述：</span><textarea type="text" name="" id="changeauthorizationManageInfoDetail" value="" /></textarea></li>
					</ul>
					<!--部门弹出层-->
					<div id="changeauthorizationManageInfoDeptLay">
						<ul class="addauthorizationManageInfoDept1 lf">
							<!--<li class="activeChoseDept">
                				部门1
                			</li>-->
						</ul>
						<!--<ul class="addauthorizationManageInfoDept2 lf">
                			<li>
                				部门11
                			</li>
                		</ul>-->
					</div>
					<div class="changeHiddenListId"style="display: none;"></div>
				</div>
				<button id="change-ok">确定修改</button>

				<!--<button id="change-cancle">确定修改</button>-->

				<a id="change-cancle" href="javascript:void(0)" onclick="document.getElementById('authorizationManagelight5').style.display='none';document.getElementById('fade').style.display='none'">取消修改</a>
			</div>

			<!--灰背景-->
			<div id="fade" class="black_overlay"></div>

		</div>

	</body>
	<!--<script src="../../js/jQuery-jcDate.js" type="text/javascript" charset="utf-8"></script>-->

	<script src="../../js/jquery-3.0.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>

	<script type="text/javascript">
		//			点击搜索按钮
		$(document).on("click", ".searching", function() {
			var search = $("#searchBox").val().trim();
		});

		//		点击查询按钮
		$(document).on("click", ".btn-check", function() {
			var lookauthorizationManageInfoUserTypeId=$(this).parent().parent().find('.authorizationManageInfoType').text();
			var lookauthorizationManageInfoUserType;
			var lookauthorizationManageInfofkHospitalName=$(this).parent().parent().find(".authorizationManageInfofkHospitalName").text();//医院姓名
			var lookauthorizationManageInfofkSectionName=$(this).parent().parent().find(".authorizationManageInfofkSectionName").text();//科室姓名
			var lookauthorizationManageInfofkDeptName=$(this).parent().parent().find(".authorizationManageInfoDetail-name").text();//部门姓名
			var lookauthorizationManageInfofkHospitalId=$(this).parent().parent().find(".authorizationManageInfofkHospitalId").text();//医院id
			var lookauthorizationManageInfofkSectionId=$(this).parent().parent().find(".authorizationManageInfofkSectionId").text();//科室id
			var lookauthorizationManageInfofkDeptId=$(this).parent().parent().find(".authorizationManageInfofkDeptId").text();//部门id
			var lookauthorizationManageInfoUserName=$(this).parent().parent().find(".authorizationManageInfoDetail-id span").text();//用户名
			var lookauthorizationManageInfoTels=$(this).parent().parent().find(".authorizationManageInfoDetail-tel span").text();//用户电话
			var lookauthorizationManageInfoDetails=$(this).parent().parent().find(".authorizationManageDescript span").text();//医生描述
			if(lookauthorizationManageInfoUserTypeId=="1"){
				lookauthorizationManageInfoUserType="医生" //用户类型
				$(".lookHosInfos").css("display","block");
				$(".lookOfficeInfos").css("display","block");
				$(".lookDeptInfos").css("display","none");
				
			}else if(lookauthorizationManageInfoUserTypeId=="2"){
				lookauthorizationManageInfoUserType="非医生" //用户类型
				$(".lookHosInfos").css("display","none");
				$(".lookOfficeInfos").css("display","none");
				$(".lookDeptInfos").css("display","block");
			}
			$("#lookauthorizationManageInfoUserType").val(lookauthorizationManageInfoUserType);
			$("#lookauthorizationManageInfoHospName").val(lookauthorizationManageInfofkHospitalName);//医院
			$("#lookauthorizationManageInfoTechOffice").val(lookauthorizationManageInfofkSectionName);//科室
			$("#lookauthorizationManageInfoDept").val(lookauthorizationManageInfofkDeptName);//部门
			$("#lookauthorizationManageInfoUserName").val(lookauthorizationManageInfoUserName);//用户名
			$("#lookauthorizationManageInfoTel").val(lookauthorizationManageInfoTels);//电话
			$("#lookauthorizationManageInfoDetail").val(lookauthorizationManageInfoDetails);//描述
			$("#authorizationManagelight1").fadeIn();
			$("#fade").fadeIn();
			$("#authorizationManagelight1 input").attr("disabled",true);
			$("#authorizationManagelight1 textarea").attr("disabled",true);
		});

		//		点击删除按钮
		$(document).on("click", ".btn-del", function() {
			$(".delHiddenListId").text($(this).parent().parent().find(".authorizationManageInfoListId").text());
			$("#authorizationManagelight2").fadeIn();
			$("#fade").fadeIn();
		});
		//		点击新增按钮
		var selectHosId; //定义新增默认选择的医院的id;
		var deptPid = 0; //定义新增默认选择的部门第一层pid为0
		var deptChoseName;//新增里的默认选择的部门姓名
		$(".authorizationManageBtnAdd").click(function() {
			$("#authorizationManagelight4").fadeIn();
			$("#fade").fadeIn();
			var authorizationManageDivIds = $("#addauthorizationManageInfoHspName").attr("id"); //获取当前添加医生信息里医院选项的select的id
			//			读取医院信息
			//readHospital(authorizationManageDivIds);
			//			读取部门信息
			var authorizationManageSelectDeptIds = $("#addauthorizationManageInfoDeptLay").attr("id");
			readDept(authorizationManageSelectDeptIds, deptPid);
		});

		//点击修改按钮
		var changeInfoSelectHosId; //定义新增默认选择的医院的id;
		var changeInfodeptPid = 0; //定义新增默认选择的部门第一层pid为0
		var changeInfodeptChoseName;//新增里的默认选择的部门姓名
		var changeInfoCurrentId;
		$(document).on("click", ".btn-change", function() {
			var changePermUserName=$(this).parent().parent().find(".authorizationManageInfoDetail-id span").text();//用户名
			var changePermCode=$(this).parent().parent().find(".authorizationManageInfoDetail-sex span").text();//用户编号
			var changePermIds=$(this).parent().parent().find(".authorizationManageInfoListId").text();//用户id
//			parent.$(window.parent.document).find("#changePermissionGoto").click();
			RefreshIframe("page/changePermissions/changePermissions.html","changePermissionGoto");
			localStorage.setItem("changePermissionUserId",changePermIds);
			localStorage.setItem("changePermissionUserNames",changePermUserName);
			localStorage.setItem("changePermissionUserCode",changePermCode);
		})
		// 	新增内容里医院和部门联动
		$(".authorizationManageSelectUserIdentity select").change(function() {
			if($(this).val() == "1") {
				$(".AddauthorizationManageInfohospitalName").css("display", "block");
				$(".AddauthorizationManageInfoTechOffice").css("display", "block");
				$(".AddauthorizationManageInfoChoseDept").css("display", "none");
			} else {
				$(".AddauthorizationManageInfohospitalName").css("display", "none");
				$(".AddauthorizationManageInfoTechOffice").css("display", "none");
				$(".AddauthorizationManageInfoChoseDept").css("display", "block");
			}
		});
		//修改信息弹框里的医院和部门联动
		$(".changeauthorizationManageSelectUserIdentity select").change(function() {
			if($(this).val() == "1") {
				$(".changeauthorizationManageInfohospitalName").css("display", "block");
				$(".changeauthorizationManageInfoTechOffice").css("display", "block");
				$(".changeauthorizationManageInfoChoseDept").css("display", "none");
			} else {
				$(".changeauthorizationManageInfohospitalName").css("display", "none");
				$(".changeauthorizationManageInfoTechOffice").css("display", "none");
				$(".changeauthorizationManageInfoChoseDept").css("display", "block");
			}
		});
		//点击新增里的医院选择框	
		$("#addauthorizationManageInfoHspName").change(function() {
			//	console.log($(this).val());
			var currentTechOfficeSlcId = $("#addauthorizationManageInfoTechOffice").attr("id");
			selectHosId = $(this).val();
			techOffice(selectHosId, currentTechOfficeSlcId);
		});
		//点击修改框里的医院选择框
		$("#changeauthorizationManageInfoHspName").change(function() {
			//	console.log($(this).val());
			var changecurrentTechOfficeSlcId = $("#changeauthorizationManageInfoTechOffice").attr("id");
			changeInfoSelectHosId = $(this).val();
			techOffice(changeInfoSelectHosId, changecurrentTechOfficeSlcId);
		});
		//点击增加的部门弹框里的内容时
		var kIndex = 1; //初始化有几个ul
		$("#authorizationManagelight4").on("click", "#addauthorizationManageInfoDeptLay li", function() {
			//	console.log($(this).val());
			var addauthorizationManageInfoDeptLayId = $("#addauthorizationManageInfoDeptLay").attr("id");
			deptPid = parseInt($(this).find(".currentDeptId").text());
			deptChoseName = $(this).find(".currentDeptName").text();
			$("#addauthorizationManageInfoDeptHiddenId").val(deptPid);
			$("#addauthorizationManageInfoDept").val(deptChoseName);
			//	获取当前点击的是第几层
			var index = $("#addauthorizationManageInfoDeptLay ul").index($(this).parent()); //判断是第几个ul
			kIndex = index + 2;
			if($(this).parent().next().length == 0) { //如果当前点击的ul后面没有ul添加一个，如果有就不添加
				//		k++;
				sessionStorage.setItem("currentUlNum", kIndex); //当前有几个ul了，重新加载页面的时候记住并添加
				$(this).parent().after('<ul class="addauthorizationManageInfoDept' + kIndex + ' lf"></ul>');
			}
			readDept(addauthorizationManageInfoDeptLayId, deptPid, index);
		});
		//点击修改弹框里的部门弹框里的内容时
		var changekIndex = 1; //初始化有几个ul
		$("#authorizationManagelight5").on("click", "#changeauthorizationManageInfoDeptLay li", function() {
			//	console.log($(this).val());
			var changeauthorizationManageInfoDeptLay = $("#changeauthorizationManageInfoDeptLay").attr("id");
			changeInfodeptPid = parseInt($(this).find(".currentDeptId").text());
			cahngeDeptChoseName = $(this).find(".currentDeptName").text();
			$("#changeauthorizationManageInfoDeptHiddenId").val(changeInfodeptPid);
			$("#changeauthorizationManageInfoDept").val(cahngeDeptChoseName);
			//	获取当前点击的是第几层
			var index = $("#changeauthorizationManageInfoDeptLay ul").index($(this).parent()); //判断是第几个ul
			changekIndex = index + 2;
			if($(this).parent().next().length == 0) { //如果当前点击的ul后面没有ul添加一个，如果有就不添加
				//		k++;
				sessionStorage.setItem("currentUlNum", changekIndex); //当前有几个ul了，重新加载页面的时候记住并添加
				$(this).parent().after('<ul class="changeauthorizationManageInfoDept' + changekIndex + ' lf"></ul>');
			}
			readDept(changeauthorizationManageInfoDeptLay, changeInfodeptPid, index);
		});
		//新增里的点击除按钮和弹框以外的地方弹框消失
		//点击新增里的选择部门
//		$(function(){
//		　　$(document).bind("click",function(e){
//				$(".AddauthorizationManageInfoChoseDept").click(function(e) {
//					e.stopPropagation();
//					$("#addauthorizationManageInfoDeptLay").toggle();
//				});
//		　　　　//id为menu的是菜单 
//		　　　　if($(e.target).closest("#addauthorizationManageInfoDeptLay").length == 0 && $(e.target).closest("#addauthorizationManageInfoDeptLay li").length == 0){
//		　　　　//点击id为menu之外且id，则触发
//		　　　	$("#changeauthorizationManageInfoDeptLay").css("display", "none");
//		　　　　}
//		　　})
//		})
		$(".AddauthorizationManageInfoChoseDept").click(function(e) {
				$("#addauthorizationManageInfoDeptLay").toggle();
		});
		//点击修改里的选择部门
		$(document).ready(function() {
			$(".changeauthorizationManageInfoChoseDept").click(function(e) {
				$("#changeauthorizationManageInfoDeptLay").toggle();
			});
		});
		//		读取医院的接口
		function readHospital(currentSelectIds,currentName,currentTid) { //参数为外层的selcect的id
			console.log(currentSelectIds);
			$("#" + currentSelectIds).html('<option value="0"selected="selected">请选择</option>');
			
			$.ajax({
				type: "get",
				url: config + "/sys/hospital/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var hospitalList = data.resultMap.hospitalList;
						for(var s = 0; s < hospitalList.length; s++) {
							var hospitalHtml = '';
							hospitalHtml += '<option value="' + hospitalList[s].id + '">' + hospitalList[s].name + '</option>';
							$("#" + currentSelectIds).append(hospitalHtml);
						}
					}
					selectHosId = $("#addauthorizationManageInfoHspName").val(); //定义默认选择的医院的id;
					console.log(selectHosId);
					selectHosId=currentName;
					var currentTechOfficeSlcId = $("#" + currentSelectIds).parent().parent().next().find("select").attr("id");
					if(currentTid!=""&&currentTid!=null&&currentTid!=undefined){
						$("#" + currentSelectIds).val(currentTid);
					}else{
						$("#" + currentSelectIds).val(0);
					}
					techOffice(selectHosId,currentTechOfficeSlcId,currentTid);
				},
			});
		}
		//读取科室
		function techOffice(currentSelectHosIds, currentTechSelect,currentTid) { //参数为当前选择上的医院的id和科室的select的id
			$("#" + currentTechSelect).html('<option value="0"selected="selected">请选择</option>');
			$.ajax({
				type: "get",
				url: config + "/sys/section/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					fkHospitalId: currentSelectHosIds
				},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var sectionList = data.resultMap.sectionList;
						for(var t = 0; t < sectionList.length; t++) {
							var techOfficeHtml = '';
							techOfficeHtml += '<option value="' + sectionList[t].id + '">' + sectionList[t].name + '</option>';
							$("#" + currentTechSelect).append(techOfficeHtml);
						}
						if(currentTid!=""&&currentTid!=null&&currentTid!=undefined){
							$("#" + currentTechSelect).val(currentTid);
						}else{
							$("#" + currentTechSelect).val(0);
						}
					}
				},
			});
		}

		//读取部门
		function readDept(currentSelectDeptIds, deptPid, index) { //参数为当前选择上的医院的id和科室的select的id
			if(deptPid == 0) {
				$("#" + currentSelectDeptIds).find(".addauthorizationManageInfoDept1").html('');
			} else {
				var currentIndex = index + 2;
				console.log(currentIndex);
				$("#" + currentSelectDeptIds).find(".addauthorizationManageInfoDept" + currentIndex).html(''); //添加之前先清空
				$("#" + currentSelectDeptIds).find(".addauthorizationManageInfoDept" + currentIndex).nextAll().remove();
			}
			$.ajax({
				type: "get",
				url: config + "/sys/dept/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					pid: deptPid
				},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var deptList = data.resultMap.deptList;
						if(deptPid == 0) {
							console.log(currentSelectDeptIds);
							for(var a = 0; a < deptList.length; a++) {
								var deptListHtml = '';
								deptListHtml += '<li><span class="currentDeptName">' + deptList[a].name + '</span><span class="currentDeptId"style="display:none;">' + deptList[a].id + '</span></li>';
								$("#" + currentSelectDeptIds).find(".addauthorizationManageInfoDept1").append(deptListHtml);
							}
						} else {
							for(var a = 0; a < deptList.length; a++) {
								var deptListHtml = '';
								deptListHtml += '<li><span class="currentDeptName">' + deptList[a].name + '</span><span class="currentDeptId"style="display:none;">' + deptList[a].id + '</span></li>';
								$("#" + currentSelectDeptIds).find(".addauthorizationManageInfoDept" + currentIndex).append(deptListHtml);
							}
						}

					}
				},
			});
		}
		//      以下是调取接口
		//		加载列表
		var userId=sessionStorage.getItem('userId');
		var sessionId=sessionStorage.getItem('sessionId');
		//		分页
		var currentPage = 1;
		var offsetPage = 0; //传输的页起始条数
		var showNum = 10; //页面需要显示的条数
		var doctoNum_pages;
		//点击分页页数
		$(document).delegate(".flipOver", 'click', function() {
			$(this).addClass('active').siblings().removeClass('active');
			currentPage = parseInt($(this).attr("pageId"));
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			authorizationManageList();
			window.scrollTo(0, 0);
		});
		//点击上一页
		$(document).delegate("#prev", 'click', function() {
			if($(".flipOver.active").prev().attr("id") == "prev") {
				return true
			} else {
				var page = parseInt($(".flipOver.active").attr("pageid")) - 1;
				$(".flipOver.active").prev().addClass("active").siblings().removeClass("active")
			}
			currentPage = page;
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			authorizationManageList();
			window.scrollTo(0, 0);
		});

		//点击下一页
		$(document).delegate("#Next", 'click', function() {
			if($(".flipOver.active").next().attr("id") == "Next") {
				return true
			} else {
				var page = parseInt($(".flipOver.active").attr("pageid")) + 1;
				$(".flipOver.active").next().addClass("active").siblings().removeClass("active")
			}
			currentPage = page;
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			authorizationManageList();
			window.scrollTo(0, 0);
		});
		//点击分页跳转页按钮
	    $(document).delegate(".srueToJumpPageBtn",'click',function(){
	        currentPage = parseInt($(".toPageNum").val().trim());
	        offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
	        authorizationManageList();
	        window.scrollTo(0,0);
	    });
		//			读取用户列表
		var searchHospitalId="";  
		var searchSectionId="";  
		var searchUserName="";
		authorizationManageList();
		//	获取订单列表
		function authorizationManageList() {
			$("#authorizationManageContentList").html('');
			$.ajax({
				type: "get",
				url: config + "/sys/user/listPer",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					//所属科室id
					fkSectionId:searchSectionId,
					//所属医院id
					fkHospitalId:searchHospitalId,
					//员工姓名
					userNameLike:searchUserName,
					offset: offsetPage, //（页码-1）*每页显示条数
					limit: showNum //每页赢显示的条数	
				},
				success: function(data) {
					console.log("此处为医生管理列表信息");
					console.log(data);
					var authorizationManageinfoList = data.resultMap.userList;
					var doclistTotal = data.resultMap.total; //总条数
					//							var index = data.viewIndex;
//					alert(doclistTotal);
					doctoNum_pages = Math.ceil(parseInt(doclistTotal) / 10); //总条数除以每页十条数据为总页码
//					alert(doctoNum_pages);
					for(var i = 0, k = 0; i < authorizationManageinfoList.length; i++) {
						console.log(authorizationManageinfoList[i].name);
						var authorizationManagehtml = '';
						k++;
						authorizationManagehtml += '<ul class="authorizationManageInfoDetail-ul">';
						authorizationManagehtml += '<li class="authorizationManageInfoListId"style="display:none">' + authorizationManageinfoList[i].id + '</li>' ;//隐藏的用户身份
						authorizationManagehtml += '<li class="authorizationManageInfoType"style="display:none">' + authorizationManageinfoList[i].type + '</li>' ;//隐藏的用户身份
						authorizationManagehtml += '<li class="authorizationManageInfofkHospitalId"style="display:none">' + authorizationManageinfoList[i].fkHospitalId + '</li>';//隐藏的医院id
						authorizationManagehtml += '<li class="authorizationManageInfofkHospitalName"style="display:none">' + authorizationManageinfoList[i].hospitalName + '</li>';//隐藏的医院姓名
						authorizationManagehtml += '<li class="authorizationManageInfofkSectionId"style="display:none">' + authorizationManageinfoList[i].fkSectionId + '</li>'; //隐藏的科室id
						authorizationManagehtml += '<li class="authorizationManageInfofkSectionName"style="display:none">' + authorizationManageinfoList[i].sectionName + '</li>';//隐藏的科室姓名
						authorizationManagehtml += '<li class="authorizationManageInfofkDeptId"style="display:none">' + authorizationManageinfoList[i].fkDeptId + '</li>';//隐藏的部门id
//						authorizationManagehtml += '<li class="authorizationManageInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>';
						authorizationManagehtml += '<li class="authorizationManageInfoDetail-code LiTextAlign"><span>' + k + '</span></li>';
						authorizationManagehtml += '<li class="authorizationManageInfoDetail-id LiTextAlign"><span>' + authorizationManageinfoList[i].userName + '</span></li>'; //医生姓名
						authorizationManagehtml+='<li class="authorizationManageInfoDetail-sex LiTextAlign"><span>'+authorizationManageinfoList[i].userCode+'</span></li>';//编号
						if(authorizationManageinfoList[i].type == 1) {
							if(authorizationManageinfoList[i].hospitalName == "" || authorizationManageinfoList[i].hospitalName == null) {
								if(authorizationManageinfoList[i].sectionName == "" || authorizationManageinfoList[i].sectionName == null) {
									authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span></span></li>'; //组织机构为医院和科室组织的
								} else {
									authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span>' + authorizationManageinfoList[i].sectionName + '</span></li>'; //组织机构为医院和科室组织的
								}
							} else {
								if(authorizationManageinfoList[i].sectionName == "" || authorizationManageinfoList[i].sectionName == null) {
									authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span>' + authorizationManageinfoList[i].hospitalName + '</span></li>'; //组织机构为医院和科室组织的
								} else {
									authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span>' + authorizationManageinfoList[i].hospitalName + '（' + authorizationManageinfoList[i].sectionName + '）' + '</span></li>'; //组织机构为医院和科室组织的
								}
							}
						} else {
							if(authorizationManageinfoList[i].deptName == "" || authorizationManageinfoList[i].deptName == null) {
								authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span></span></li>'; //部门
							} else {
								authorizationManagehtml += '<li class="authorizationManageInfoDetail-name LiTextAlign"><span>' + authorizationManageinfoList[i].deptName + '</span></li>'; //部门
							}
						}
						if(authorizationManageinfoList[i].fkRoleName != "" && authorizationManageinfoList[i].fkRoleName != null) {
							authorizationManagehtml += '<li class="authorizationManageInfoDetail-tel LiTextAlign"><span>' + authorizationManageinfoList[i].fkRoleName + '</span></li>'; //岗位
						} else {
							authorizationManagehtml += '<li class="authorizationManageInfoDetail-tel LiTextAlign"><span></span></li>'; //岗位
						}
//						if(authorizationManageinfoList[i].status != "" && authorizationManageinfoList[i].status != null) {
//							authorizationManagehtml += '<li class="authorizationManageDescript"><span>' + authorizationManageinfoList[i].status + '</span></li>'; //状态
//						} else {
//							authorizationManagehtml += '<li class="authorizationManageDescript"><span></span></li>'; //状态
//						}
//						authorizationManagehtml += '<li class="authorizationManageInfoDetail-check"><a href = "javascript:void(0)" class="btn-check"><img src="../../img/common/untitledSearBtn.png"/></a></li>';
						authorizationManagehtml += '<li class="authorizationManageInfoDetail-change LiTextAlign"><a href = "javascript:void(0)" class="btn-change btnTextColor"><span class="changeImg">修改岗位</span></a></li>';
//						authorizationManagehtml += '<li class="authorizationManageInfoDetail-del"><a href = "javascript:void(0)" class="btn-del"><img src="../../img/common/untitledDelBtn.png"/></a></li>';
						authorizationManagehtml += '</ul>';
						$("#authorizationManageContentList").append(authorizationManagehtml);
						var pageHtml = page(parseInt(currentPage), doctoNum_pages);
						$(".authorizationManagepageN").html(pageHtml);
					}
					if(data.status == 1) {}
				},
			});
		}
		//		点击确认新增
		$("#authorizationManagelight4 #add-ok").click(function() {
			var userIdentity = $("#addauthorizationManageInfoUserInfo").val() //用户身份
			var addauthorizationManageInfoHspName = $("#addauthorizationManageInfoHspName").val(); //医院名
			var addauthorizationManageInfoTechOffice = $("#addauthorizationManageInfoTechOffice").val(); //科室
			var addauthorizationManageInfoDocName = $("#addauthorizationManageInfoDocName").val(); //医生姓名
			var addauthorizationManageInfoDocTel = $("#addauthorizationManageInfoDocTel").val(); //医生电话
			var addauthorizationManageInfoDetail = $("#addauthorizationManageInfoDetail").val(); //医生描述
			var addauthorizationManageInfoChoseDept = $("#addauthorizationManageInfoDept").val(); //获取所选部门
			var addauthorizationManageInfoChoseDeptId = $("#addauthorizationManageInfoDeptHiddenId").val(); //获取选择部门id
			var AddauthorizationManageInfo = {}; //定义一个对象存放参数
			if(userIdentity == "1") {
				AddauthorizationManageInfo = {
					type: userIdentity,
					fkHospitalId: addauthorizationManageInfoHspName,
					fkSectionId: addauthorizationManageInfoTechOffice,
					userName: addauthorizationManageInfoDocName,
					mobile: addauthorizationManageInfoDocTel,
					memo: addauthorizationManageInfoDetail
				}
			} else {
				AddauthorizationManageInfo = {
					type: userIdentity,
					fkDeptId: addauthorizationManageInfoChoseDeptId,
					userName: addauthorizationManageInfoDocName,
					mobile: addauthorizationManageInfoDocTel,
					memo: addauthorizationManageInfoDetail
				}
			}
			$.ajax({
				method: 'get',
				url: config + '/sys/user/save',
				contentType: "application/json; charset=utf-8", //传到后台的数据格式
				async: true,
				data: AddauthorizationManageInfo,
				dataType: 'jsonp', //接收值的格式
				jsonp: 'jsoncallback',
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						document.getElementById('authorizationManagelight4').style.display = 'none';
						document.getElementById('fade').style.display = 'none';
						alert(data.message)
						authorizationManageList();
					} else {
						alert(data.message);
						//		window.location.reload();
					}
				},
				error: function(result) {
					console.log(result);
				}
			});
		})
		
		//		点击确认修改
		$("#authorizationManagelight5 #change-ok").click(function() {
			var changeListIds=parseInt($(".changeHiddenListId").text()); //用户id
			var userIdentity = $("#changeauthorizationManageInfoUserInfo").val(); //用户身份
			var changeauthorizationManageInfoHspName = $("#changeauthorizationManageInfoHspName").val(); //医院名
			var changeauthorizationManageInfoTechOffice = $("#changeauthorizationManageInfoTechOffice").val(); //科室
			var changeauthorizationManageInfoDocName = $("#changeauthorizationManageInfoDocName").val(); //医生姓名
			var changeauthorizationManageInfoDocTel = $("#changeauthorizationManageInfoDocTel").val(); //医生电话
			var changeauthorizationManageInfoDetail = $("#changeauthorizationManageInfoDetail").val(); //医生描述
			var changeauthorizationManageInfoChoseDept = $("#changeauthorizationManageInfoDept").val(); //获取所选部门
			var changeauthorizationManageInfoChoseDeptId = $("#changeauthorizationManageInfoDeptHiddenId").val(); //获取选择部门id
			var changeauthorizationManageInfo = {}; //定义一个对象存放参数
			if(userIdentity == "1") {
				changeauthorizationManageInfo = {
					id:changeListIds,
					type: userIdentity,
					fkHospitalId: changeauthorizationManageInfoHspName,
					fkSectionId: changeauthorizationManageInfoTechOffice,
					userName: changeauthorizationManageInfoDocName,
					mobile: changeauthorizationManageInfoDocTel,
					memo: changeauthorizationManageInfoDetail
				}
			} else {
				changeauthorizationManageInfo = {
					id:changeListIds,
					type: userIdentity,
					fkDeptId: changeauthorizationManageInfoChoseDeptId,
					userName: changeauthorizationManageInfoDocName,
					mobile: changeauthorizationManageInfoDocTel,
					memo: changeauthorizationManageInfoDetail
				}
			}
			$.ajax({
				method: 'get',
				url: config + '/sys/user/update',
				contentType: "application/json; charset=utf-8", //传到后台的数据格式
				async: true,
				data: changeauthorizationManageInfo,
				dataType: 'jsonp', //接收值的格式
				jsonp: 'jsoncallback',
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						document.getElementById('authorizationManagelight5').style.display = 'none';
						document.getElementById('fade').style.display = 'none';
						alert(data.message)
						authorizationManageList();
					} else {
						alert(data.message);
						//		window.location.reload();
					}
				},
				error: function(result) {
					console.log(result);
				}
			});
		})
//		删除单行数据
		$("#authorizationManagelight2 #del-yes").click(function(){
			var changeListIds=parseInt($(".delHiddenListId").text()); //用户id
			$.ajax({
				method: 'get',
				url: config + '/sys/user/remove',
				contentType: "application/json; charset=utf-8", //传到后台的数据格式
				async: true,
				data: {id:changeListIds},
				dataType: 'jsonp', //接收值的格式
				jsonp: 'jsoncallback',
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						document.getElementById('authorizationManagelight2').style.display = 'none';
						document.getElementById('fade').style.display = 'none';
						alert(data.message)
						authorizationManageList();
					} else {
						alert(data.message);
						//		window.location.reload();
					}
				},
				error: function(result) {
					console.log(result);
				}
			});
		});
//	加载页面时默认加载查询条件---医院 科室 医生
	
//	readHospital("authorizationManageInfoSearchHos");
	//	点击医院的时候联动科室
	$("#authorizationManageInfoSearchHos").change(function(){
		var currentauthorizationManageInfoSearchHos=$(this).val();
		searchHospitalId=currentauthorizationManageInfoSearchHos;
		authorizationManageList();
		techOffice(currentauthorizationManageInfoSearchHos,"authorizationManageInfoSearchTechOffice");
	});
//	点击页面查询
	$("#authorizationManageSearchBtns").click(function(){
		currentPage = 1;
		offsetPage = 0; //传输的页起始条数
		searchHospitalId=$("#authorizationManageInfoSearchHos").val();
		searchSectionId=$("#authorizationManageInfoSearchTechOffice").val();
		searchUserName=$("#authorizationManageInfoSearchName").val();
		authorizationManageList();
	});
//点击清除按钮
	$("#authorizationManageSearchClearData").click(function(){
		searchHospitalId="";
		searchSectionId="";
		searchUserName="";
		$("#authorizationManageInfoSearchHos").val("");
		$("#authorizationManageInfoSearchTechOffice").val("");
		$("#authorizationManageInfoSearchName").val("");
		authorizationManageList();
	});
//	点击医生身份选择时部门弹框消失
$("#addauthorizationManageInfoUserInfo").click(function(){
	$("#addauthorizationManageInfoDeptLay").fadeOut();
});
$("#changeauthorizationManageInfoUserInfo").click(function(){
	$("#changeauthorizationManageInfoDeptLay").fadeOut();
});
	</script>
</html>