<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="HandheldFriendly" content="true">
		<title>套餐</title>
		<link rel="shortcut icon" type="image/x-icon" href="img/header/logoico3.png" />
		<!-- Bootstrap -->
		<link href="../../css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome.min.css" rel="stylesheet">
		<link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
		<link href="../../css/plugins/steps/jquery.steps.css" rel="stylesheet">
		<link href="../../css/animate.min.css" rel="stylesheet">
		<link href="../../css/style.min.css" rel="stylesheet">
		<link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../css/plugins/webuploader/webuploader.css">
		<link rel="stylesheet" href="../../css/public.css" />
		<link rel="stylesheet" type="text/css" href="../../css/demo/webuploader-demo.min.css">
		<!--自定义样式-->
		<link rel="stylesheet" href="../../css/setMealForm.css" />
		<style type="text/css">
			.text-middle {
				display: -moz-box;
				/* Firefox */
				display: -ms-flexbox;
				/* IE10 */
				display: -webkit-box;
				/* Safari */
				display: -webkit-flex;
				/* Chrome, WebKit */
				display: box;
				display: flexbox;
				display: flex;
			}
			
			.smallBtn {
				color: #fff;
				cursor: pointer;
				padding: 5px;
				font-size: 10px;
				border-radius: 5px;
			}
			
			.listTitle {
				font-weight: bold;
				font-size: 15px;
				margin-top: 10px;
			}
			
			#dynamicBox .dataBox .selectCommodity {
				width: 250px;
			}
			
			.subscribeListSex {
				display: inline-block;
				margin: 7px 0 0 0px;
				white-space: nowrap;
			}
			
			.subscribeListSex input {
				width: 39%;
			}
			
			#dynamicBox .boxTpl {
				display: none;
			}
			
			#dynamicBox .dataBox input {
				width: 40px;
				margin-right: 5px;
			}
			
			#shuoming {
				margin-top: 17px;
			}
		</style>
	</head>

	<body>
		<!--内容区右边区-->
		<article>
			<form id="form_div">
				<!--产品图-->
				<input type="text" class="img1" name="img1" />
				<input type="text" class="img2" name="img2" />
				<input type="text" class="img3" name="img3" />
				<input type="text" class="img4" name="img4" />
				<!--产品详情图-->

				<div id="basic_info" style="overflow: hidden;">
					<div class="big_title ">活动信息:</div>
					<div id="basic_info_left">
						<div class="rows">
							<span class="info_name listTitle">套餐名称:</span>
							<!--<span class="goodsName"></span>-->
							<input type="text" placeholder="限制10个字内" id="setMealName" />
							<!--<span class="star">*</span>-->
						</div>
						<div class="rows text-middle">
							<span class="info_name listTitle">套餐介绍:</span>
							<textarea id="spec" rows="4" cols="33" maxlength="50" placeholder="限制50个字内" style="margin-left: 4px;">
							</textarea>
						</div>
						<div id="dynamicBox">
							<div class="boxTpl dataBox">
								<div class="rows">
									<span class="info_name listTitle">套餐商品:</span>
									<!--聚合物改性沥青卷材", "沥青卷材", "金属卷材", "合成高分子卷材", "抗根卷材");-->
									<input type="button" class="selectCommodity package_commodity" value="选择商品" />
									<span id="delCommodity" class="smallBtn" style="background: #da5a5a;">删除商品</span>
									<!--<span class="star">*</span>-->
								</div>
								<div class="rows" style="display: none;">
									<span class="info_name">id:</span>
									<span class="package_id">
								</span>
								</div>
								<div class="rows">
									<span class="info_name ">数量:</span>
									<input type="number" class="package_Number" />
								</div>
								<div class="rows">
									<span class="info_name">原价:</span>
									<span class="package_original">0
								</span>元
								</div>
								
								<div class="rows">
									<span class="info_name">现价:</span>
									<input type="number" class="package_current" />元
								</div>
								<div class="rows">
									<span class="info_name">库存:</span>
									<span class="package_inventory" />0<span>
									<!--<span class="star">*</span>-->
								</div>
							</div>
							<div class="dataBox" data-val="0">
								<div class="rows">
									<span class="info_name listTitle">套餐商品:</span>
									<input type="button" class="selectCommodity package_commodity" value="选择商品" />
									<span id="addCommodity" class="smallBtn" style="background: #1C79B6;">增加商品</span>
								</div>
								<div class="rows" style="display: none;">
									<span class="info_name">id:</span>
									<span class="package_id">
								</span>
								</div>
								<div class="rows">
									<span class="info_name ">数量:</span>
									<input type="number" class="package_Number" />
								</div>
								<div class="rows">
									<span class="info_name">原价:</span>
									<span class="package_original">
									0
								</span>元
								</div>
								<div class="rows">
									<span class="info_name ">现价:</span>
									<input type="number" class="package_current" />元
								</div>
								<div class="rows">
									<span class="info_name">库存:</span>
									<span class="package_inventory" />0<span>
								</div>
							</div>
						</div>
						<div class="rows text-middle" style="width:800px">
							<span class="info_name listTitle" style="width: 100px;">活动时间:</span>
									<div class="subscribeListSex">
										<input type="text" class="newin layer-date form-control required queryContent" id="beginTime" autocomplete="off" name="beginTime" placeholder="活动起始日期">
										<input type="text" class="newin layer-date form-control required queryContent" style="margin-left: 5px;" id="endTime" autocomplete="off" name="endTime" placeholder="活动结束日期">
										<span>活动持续:<span id="oday">--</span></span>
									</div>
								</div>
								<div class="rows">
									<span class="info_name listTitle">包邮:</span>
									<span>
								<input type="checkbox" id="freight" value="" style="width: auto;height: auto;"> 卖家承担运费
							</span>
								</div>
							</div>

							<div id="basic_info_right">
								<h2>APP/WEB商城展示主图</h2>
								<div id="big_img">
									<img src="../../img/big_picture.png" />
								</div>
								<div id="small_img">
									<div id="small_pic1" class="sl_pic">
										<img class="acc_imgin" src="../../img/small_picture.png" id="img0" accept="image/png,image/jpg">
										<div id="acc_sc1" class="acc_small_img">
											<input type="file" name="img1" id="image0" multiple class="ph08" />
											<div class="deleteImgs">×</div>
										</div>
										<!--<div style="text-align: center;position: absolute;width: 52px;left: 276px;">删除</div>-->
									</div>

									<div id="small_pic2" class="sl_pic">
										<img class="acc_imgin" src="../../img/small_picture.png" id="img1" accept="image/png,image/jpg">
										<div id="acc_sc2" class="acc_small_img">
											<input type="file" name="img2" id="image1" multiple class="ph08" />
											<div class="deleteImgs">×</div>
										</div>
									</div>
									<div id="small_pic3" class="sl_pic">
										<img class="acc_imgin" src="../../img/small_picture.png" id="img2" accept="image/png,image/jpg">
										<div id="acc_sc3" class="acc_small_img">
											<input type="file" name="img3" id="image2" multiple class="ph08" />
											<div class="deleteImgs">×</div>
										</div>
									</div>
									<div id="small_pic4" class="sl_pic">
										<img class="acc_imgin" src="../../img/small_picture.png" id="img3" accept="image/png,image/jpg">
										<div id="acc_sc4" class="acc_small_img">
											<input type="file" name="img4" id="image3" multiple class="ph08" />
											<div class="deleteImgs">×</div>
										</div>
									</div>
								</div>
								<div id="shuoming">产品图片展示在产品详情中，尺寸235*235，不超过500kb的jpg或png，最多可传4张，默认第一张为商品列表展示图</div>
							</div>
						</div>

						<!--商品详情信息-->
						<div>
							<div class="big_title">APP/WEB商城展示详情图:</div>

							<div id="add_img_div">
								<div id="select_img_div1" class="img_box" style="position: relative;">
									<img id="addimg1" class="detail_img" src="../../img/big_picture.png" />
									<div class="acc_sc5 acc_sc">
										<input type="file" name="showpic1" id="showpic1" class="showpics" multiple/>
									</div>
									<div class="delete">×</div>
									<input type="text" class="showpic1 showPics" name="showpic1" />
								</div>
							</div>
							<div style="clear: both;"></div>
							<div style="margin-left: 2%;color: red;margin-top: 30px;">产品详情图片展示在产品详情中，尺寸800*680 不超过500kb的jpg或png,按顺序依次展示。</div>
						</div>
						<input type="hidden" name="uploadImgs" />
			</form>
			<div id="submit_div">
				<button>提交</button>
			</div>
		</article>
		</section>
		<script src="../../js/jquery-3.0.0.min.js"></script>
		<script src="../../js/jquery.min.js?v=2.1.4"></script>
		<script src="../../js/bootstrap.min.js?v=3.3.5"></script>
		<script src="../../js/foundation-datepicker.js"></script>
		<script src="../../js/foundation-datepicker.min.js"></script>
		<script src="../../js/plugins/layer/laydate/laydate.js"></script>
		<script src="../../js/plugins/staps/jquery.steps.min.js"></script>
		<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
		<script src="../../js/plugins/validate/messages_zh.min.js"></script>
		<script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
		<script src="../../js/content.min.js?v=1.0.0"></script>
		<script type="text/javascript">
			var BASE_URL = '../../js/plugins/webuploader';
		</script>
		<script src="../../js/plugins/webuploader/webuploader.min.js"></script>
		<!--<script src="../../js/webuploaderDrugDetail.js"></script>-->
		<script src="../../js/plugins/suggest/bootstrap-suggest.min.js"></script>
		<script src="../../js/plugins/jquery.jqprint-0.3.js"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/plugins/layer/laydate/laydate5.0.js"></script>
		<script src="../../js/jquery.form.js"></script>
		<!--<script src="../../js/changeProductDetail.js"></script>-->
		<script type="text/javascript">
			$(function() {
				$("#spec").val("");
				var createDateBegin = {
					elem: '#beginTime',
					max: '2080-10-14 12:30:00',
					type: 'datetime',
					btns: ['now', 'confirm'],
					istime: true,
					istoday: false,
					done: function(value, date) {
						if(value !== '') {
							endDate.config.min.year = date.year;
							endDate.config.min.month = date.month - 1;
							endDate.config.min.date = date.date;
							endDate.config.min.hours = date.hours;
							endDate.config.min.minutes = date.minutes;

						} else {
							endDate.config.min.year = '';
							endDate.config.min.month = '';
							endDate.config.min.date = '';
							endDate.config.min.hours = '';
							endDate.config.min.minutes = '';
						}
						//活动开始时间与活动结束时间的计算差
						var endTime = $("#endTime").val();
						if(endTime == "") {
							$("#oday").text("0")
						} else {
							var beginmsTime = new Date(value.replace(/\-/g, "/")).getTime();
							var endmsTime = new Date(endTime.replace(/\-/g, "/")).getTime();
							var countms = Number(endmsTime) - Number(beginmsTime);
							 var days = parseInt(countms / (1000 * 60 * 60 * 24));
							     var hours = parseInt((countms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
							     var minutes = parseInt((countms % (1000 * 60 * 60)) / (1000 * 60));
							     var seconds = (countms % (1000 * 60)) / 1000;
							var sumday = days + "天" + hours + "小时" + minutes + "分钟" + seconds + "秒";
							console.log(sumday)
							$("#oday").text(sumday)
						}
					}
				};
				var createDateEnd = {
					elem: '#endTime',
					max: '2080-10-14 12:30:00',
					type: 'datetime',
					btns: ['now', 'confirm'],
					istime: true,
					istoday: false,
					done: function(value, date) {
						if(value !== '') {
							startDate.config.max.year = date.year;
							startDate.config.max.month = date.month - 1;
							startDate.config.max.date = date.date;
							startDate.config.max.hours = date.date;
							startDate.config.max.minutes = date.date;
						} else {
							startDate.config.max.year = '';
							startDate.config.max.month = '';
							startDate.config.max.date = '';
							startDate.config.max.hours = '';
							startDate.config.max.minutes = '';
						}
						//活动开始时间与活动结束时间的计算差
						var beginTime = $("#beginTime").val();
						if(beginTime == "") {
							$("#oday").text("0")
						} else {
							var beginmsTime = new Date(beginTime.replace(/\-/g, "/")).getTime();
							var endmsTime = new Date(value.replace(/\-/g, "/")).getTime();
							var countms = Number(endmsTime) - Number(beginmsTime);
							  var days = parseInt(countms / (1000 * 60 * 60 * 24));
							     var hours = parseInt((countms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
							     var minutes = parseInt((countms % (1000 * 60 * 60)) / (1000 * 60));
							     var seconds = (countms % (1000 * 60)) / 1000;
							var sumday = days + "天" + hours + "小时" + minutes + "分钟" + seconds + "秒";
							console.log(sumday)
							$("#oday").text(sumday)
						}
					}
				};
				var startDate = laydate.render(createDateBegin);
				var endDate = laydate.render(createDateEnd);
			})
			//操作DOM：添加商品
			var count = 0;
			$(document).delegate("#addCommodity", 'click', function() {
				count++;
				console.log(count);
				var oWrapper = $("#dynamicBox");
				var oCloneDom = $(".boxTpl").clone().removeClass("boxTpl");
				oCloneDom.attr("data-val", count);
				oWrapper.append(oCloneDom);
			})
			//操作DOM：删除商品
			$(document).delegate("#delCommodity", 'click', function() {
				$(this).parent().parent().remove();
			})
			//提示现价不能高于原价 
			$(document).delegate(".package_current", 'blur', function() {
				let original = $.trim($(this).parent().parent().find(".package_original").text());
				let present  = $(this).val();
				console.log(Number(present)>Number(original))
				if(Number(present)>Number(original)){
					swal("提示:您输入的现价已经大于原价");
				}
			})
			//点击选择商品
			$(document).delegate(".selectCommodity", 'click', function() {
				sessionStorage.removeItem("commodityObj") //点击清除上一个的商品详情
				console.log("选择商品")
				var dataVal = $(this).parent().parent().attr("data-val"); //获取当前点击商品属性值

				parent.layer.open({
					type: 2,
					title: '新增',
					shadeClose: true,
					shade: [0.5],
					maxmin: true, //开启最大化最小化按钮
					area: ['1150px', '650px'],
					content: 'page/setMeal/addSetMeal.html',
					end: function() {
						// 当前的 end 函数就正在 C 页面中，直接操作 C 页面 DOM 就可以
						if(sessionStorage.getItem("commodityObj") != null) {
							let commodityObj = JSON.parse(sessionStorage.getItem("commodityObj"));
							$("[data-val=" + dataVal + "]").find(".package_commodity").val(commodityObj.fullName);
							$("[data-val=" + dataVal + "]").find(".package_id").text(commodityObj.id);
							$("[data-val=" + dataVal + "]").find(".package_original ").text(commodityObj.retailPrice);
							$("[data-val=" + dataVal + "]").find(".package_inventory").text(commodityObj.inventory);
						}
					}
				});
			})
			//			点击提交按钮
			$(document).delegate("#submit_div button", 'click', function() {
				if($("#setMealName").val() == null || $("#setMealName").val() == "") {
					swal("请输入套餐名称");
					return false;
				}
				if($("#spec").val() == null || $("#spec").val() == "") {
					swal("请输入套餐介绍");
					return false;
				}
				var dynamicArr = $("#dynamicBox").children();
				var obj;
				var commodityArr = []; //套餐商品数组（传给后台的）
				for(let i = 1; i < dynamicArr.length; i++) {
					console.log($(dynamicArr[i]).find(".package_commodity").val())
					var package_commodity = $(dynamicArr[i]).find(".package_commodity").val();
					if(package_commodity == null || package_commodity == "" || package_commodity == "选择商品") {
						swal("请选择套餐商品");
						return false;
					}
					if($(dynamicArr[i]).find(".package_current").val() == null || $(dynamicArr[i]).find(".package_current").val() == "") {
						swal("请输入现价");
						return false;
					}
					if(package_commodity != "选择商品") { //过滤增加后空的商品
						obj = {
							drugName: package_commodity,
							drugId: $(dynamicArr[i]).find(".package_id").text(),
							drugNum: $(dynamicArr[i]).find(".package_Number").val(),
							presentPrice: $(dynamicArr[i]).find(".package_current").val(),
							//							package_inventory: $(dynamicArr[i]).find(".package_inventory").text(),
						}
						console.log(obj)
						commodityArr.push(obj)
					}
				}
				console.log(commodityArr)
				var mealName = $("#setMealName").val(); //套餐名称
				var mealIntroduce = $("#spec").val(); //套餐介绍
				var startTime = $("#beginTime").val(); //套餐起始时间
				var endTime = $("#endTime").val(); //套餐结束时间
				var mealJson = JSON.stringify(commodityArr); //套餐商品
				var continuedDay = $("#oday").text(); //持续时间
				if($("#freight").is(':checked')) { //是否包邮	　　
					var isMail = "1"; //包邮
				} else {　　
					var isMail = "0"; //不包邮
				}
				var img1 = $(".img1").val();
				var img2 = $(".img2").val();
				var img3 = $(".img3").val();
				var img4 = $(".img4").val();
				var productImg = [img1, img2, img3, img4];
				var fileJson = JSON.stringify(productImg); //主图		
				var detailImg = $("#add_img_div").find(".detail_img");
				var detailImgArr = [];
				for(var i = 0; i < detailImg.length; i++) {
					var detailSrc = $(detailImg[i]).attr('src');
					detailImgArr.push(detailSrc);
				}
				detailImgArr.pop() //删除最后一个数组
				var imgJson = JSON.stringify(detailImgArr); //主图		
				console.log(imgJson)

				if($("#beginTime").val() == null || $("#beginTime").val() == "") {
					swal("请选择活动起始时间");
					return false;
				}
				if($("#endTime").val() == null || $("#endTime").val() == "") {
					swal("请选择活动结束时间");
					return false;
				}
				console.log(detailImgArr.length)
				if(detailImgArr.length == 0) {
					swal("请添加APP/WEB商城展示详情图");
					return false;
				}
				$.ajax({ //提交接口
					url: config + '/drug/meal/save',
					type: 'GEt',
					data: {
						mealName: mealName, //套餐名称
						mealIntroduce: mealIntroduce, //套餐介绍
						startTime: startTime, //套餐起始时间
						endTime: endTime, //套餐结束时间
						mealJson: mealJson, //套餐商品
						isMail: isMail, //是否包邮	
						continuedDay: continuedDay, //持续时间
						fileJson: fileJson, //主图	
						imgJson: imgJson //详情图
					},
					async: false,
					cache: false,
					dataType: 'JSON', //接收值的格式
					//					enctype: 'multipart/form-data',
					//					contentType: false,
					//					processData: false,
					success: function(data) {
						console.log(data);
						if(data.status=="1"){
							swal("提交成功");
							setTimeout(function(){
								closeNavTabAndRefreshIframe("page/setMeal/setMealForm.html", "page/setMeal/setMealList.html")
							},1000)
						}
						else{
							swal(data.message);
						}					
					},
					error: function() {
						swal("提交失败！");
					}
				});
			})
			/*商品基本信息上传图片*/
			$('#acc_sc1').click(function() {
				addPic($('#image0'), $("#img0"));
			});
			$('#acc_sc2').click(function() {
				addPic($('#image1'), $("#img1"));
			});
			$('#acc_sc3').click(function() {
				addPic($('#image2'), $("#img2"));
			});
			$('#acc_sc4').click(function() {
				addPic($('#image3'), $("#img3"));
			});
			var image0 = "";
			var image1 = "";
			var image2 = "";
			var image3 = "";
			var imgArr;
			var firstCategrayId; //定义的一级分类id
			function addPic(fileId, imgId) {
				fileId.change(function() {
					var file = this.files[0];
					var fsize = parseInt((file.size) / 1024); //计算图片大小，默认是B，转换成KB  
					if(!/image\/\w+/.test(file.type)) {

						swal("请确保文件为图像类型");
						return false;
					}
					if(fsize >= 500) {
						swal("图片过大，请重新选择图片");
						return false;
					}
					if(!/\.(jpg|png|JPG|PNG)$/.test(fileId.val())) {
						swal("图片类型必须是.jpg,png中的一种");
						return false;
					}
					var reader = new FileReader();
					reader.readAsDataURL(file);
					reader.onload = function(e) {
						imgId.attr('src', this.result);
						if(imgId.attr('id') == 'img0') {
							$('#big_img img').attr('src', this.result);
						}
						var fileElementId = $(fileId).attr("id");
						var formData = new FormData();
						formData.append("file", document.getElementById(fileElementId).files[0]);
						//			formData.append("type", 1);
						//			console.info(formData.get("myfile"));

						$.ajax({
							url: window.config + "/common/uploadImage",
							type: 'POST',
							data: formData,
							dataType: 'JSON',
							enctype: 'multipart/form-data',
							contentType: false,
							processData: false,
							success: function(data) {
								//把图片替换  
								//					console.log(data.resultMap.imageUrl); 
								if(fileElementId == "image0") {
									image0 = data.resultMap.imageUrl;
									$(".img1").val(image0);
									$("#img0").attr("src", image0);
									$("#big_img img").attr("src", image0);
									$("#img0").parent().find(".deleteImgs").addClass("deleteImgs_pic");
								} else if(fileElementId == "image1") {
									image1 = data.resultMap.imageUrl;
									$(".img2").val(image1);
									//						console.log(image1)
									$("#img1").attr("src", image1);
									$("#img1").parent().find(".deleteImgs").addClass("deleteImgs_pic");
								} else if(fileElementId == "image2") {
									image2 = data.resultMap.imageUrl;
									$(".img3").val(image2);
									$("#img2").attr("src", image2);
									$("#img2").parent().find(".deleteImgs").addClass("deleteImgs_pic");
								} else if(fileElementId == "image3") {
									image3 = data.resultMap.imageUrl;
									console.log(image3);
									$(".img4").val(image3);
									$("#img3").attr("src", image3);
									$("#img3").parent().find(".deleteImgs").addClass("deleteImgs_pic");
								}
							},
							error: function() {
								swal("上传失败！");
							}
						});
					}
				});
			}
			var rec = localStorage.getItem("editingDrugsInfoIds");
			var showpic1 = "";
			var showpic2 = "";
			var showpic3 = "";
			var showpic4 = "";
			var showpic5 = "";
			var detailCount = 0;
			var imgListLength = null;
			$("#add_img_div").on("click", ".acc_sc", function() {
				detailAddPic($(this).find('input[type="file"]'), $(this).parent().find('img'));
			});

			var kkk = 1;

			function detailAddPic(fileId, imgId) {
				fileId.change(function() {
					var file = this.files[0];
					var self = $(this);
					var fsize = parseInt((file.size) / 1024); //计算图片大小，默认是B，转换成KB  
					if(!/image\/\w+/.test(file.type)) {

						swal("请确保文件为图像类型");
						return false;
					}
					if(fsize >= 500) {
						swal("图片过大，请重新选择图片");
						return false;
					}
					if(!/\.(jpg|png|JPG|PNG)$/.test(fileId.val())) {
						swal("图片类型必须是.jpg,png中的一种");
						return false;
					}
					var reader = new FileReader();
					reader.readAsDataURL(file);
					reader.onload = function(e) {

						//			self.parent().parent().next().css("display","block");
						//			self.parent().parent().next().nextAll().css("display","none");

						//向后台传值
						var fileElementId = $(fileId).attr("id");
						//			console.log(fileElementId=="showpic1");
						//上传商品详情图片调取后台接口
						var formData = new FormData();
						formData.append("file", document.getElementById(fileElementId).files[0]);
						console.log(document.getElementById(fileElementId));
						console.log(formData)
						$.ajax({
							url: window.config + "/common/uploadImage",
							//				url:"http://192.168.18.189:8080/gcafu_commerce/rest/upload/product",
							type: 'POST',
							data: formData,
							dataType: 'JSON',
							enctype: 'multipart/form-data',
							contentType: false,
							processData: false,
							success: function(data) {
								//把图片替换  
								console.log(data.resultMap.imageUrl);
								var nextSibling = self.parent().parent().next();
								self.parent().parent().find(".delete").addClass("dele_pic");
								self.css("display", "none");
								imgId.attr('src', data.resultMap.imageUrl);
								var ImgLen = 0;
								var imgBox = $(".img_box").find("img");

								for(var g = 0; g < imgBox.length; g++) {
									if($(imgBox[g]).attr("src") == "../../img/big_picture.png") {
										ImgLen++;
									}
								}
								if(ImgLen < 1) {
									var filesNewBox = '';
									kkk++;
									filesNewBox += '<div id="select_img_div' + kkk + '"class="img_box" style="position: relative;">';
									filesNewBox += '<img id="addimg' + kkk + '" class="detail_img" src="../../img/big_picture.png" />';
									filesNewBox += '<div class="acc_sc">';
									filesNewBox += '<input type="file" name="showpic' + kkk + '" id="showpic' + kkk + '"class="showpicsFile"multiple/>';
									filesNewBox += '</div>';
									filesNewBox += '<div class="delete">×</div>';
									filesNewBox += '<input type="text" class="showpics showpic' + kkk + '"name="showpic' + kkk + '"/>';
									filesNewBox += '</div>';
									$("#add_img_div").append(filesNewBox);
								}
							},
							error: function(data, status, e) {
								console.log(status);
								//alert("服务器错误！");  
							}
						});

					}
				});
			}
			$(document).on("click", ".dele_pic", function() {
				$(this).parent().remove();
			});
			$(document).on("click", ".deleteImgs_pic", function() {
				if(imgListLength == 0) {
					$("#big_img").find("img").attr("src", "../../img/big_picture.png");
				}
				$(this).parent().find("input").val('');
				$("." + $(this).parent().find("input").attr('name')).val('');;
				$(this).parent().parent().find("img").attr("src", "../../img/small_picture.png");
				$(this).removeClass("deleteImgs_pic");
			});

			function firstToSecond(firstSelectId) {
				$.ajax({
					method: 'get',
					url: config + "/drug/info/twoMeno",
					contentType: "application/json; charset=utf-8", //传到后台的数据格式
					async: true,
					data: {
						typeId: firstSelectId
					},
					dataType: 'JSON', //接收值的格式
					success: function(data) {
						console.log('ajaxGet二级分类:', data);
						$("#secondType_select").html('');
						if(data.resultMap.commodityCategoryTypeList != null && data.resultMap.commodityCategoryTypeList != "") {
							for(var i = 0; i < data.resultMap.commodityCategoryTypeList.length; i++) {
								var typeHtml = '';
								typeHtml += '<span class="selectTypeRow">';
								typeHtml += '<span class="selectTypeId"style="display:none;">' + data.resultMap.commodityCategoryTypeList[i].categoryId + '</span>';
								if(data.resultMap.commodityCategoryTypeList[i].flg == 'checked') {
									typeHtml += '<input type="checkbox" id="selectType' + i + '" checked/>';
								} else {
									typeHtml += '<input type="checkbox" id="selectType' + i + '"/>';
								}

								typeHtml += '<label for="selectType' + i + '">' + data.resultMap.commodityCategoryTypeList[i].name + '</label>';
								typeHtml += '</span>';
								$("#secondType_select").append(typeHtml);
							}
						}
					},
					error: function(result) {
						//233
						console.log('ajaxGet-error:', result);
					}
				});
			}
		</script>
	</body>

</html>