<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>发送</title>

		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
	</head>
	<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../css/common.css" />
	<link rel="stylesheet" type="text/css" href="../../css/doctorInfo.css" />
	<!--<link rel="stylesheet" type="text/css" href="../../css/commonStyle.css" />-->
	<!--<link rel="stylesheet" type="text/css" href="../../css/jcDate.css"/>-->
    <style>
        .doctorBtnAdd{
            width: 145px;
            height: 24px;
            border-radius: 5px;
            background-color: #ff7510;
            font-family: "microsoft yahei";
            font-size: 14px;
            color: #FFFFFF;
            line-height: 24px;
            letter-spacing: 5px;
            cursor: pointer;
            float: right;
            
        }
        .infoDetails-ul li{
            width:40%;
        }
        .infoDetails-ul{
            margin: 20px auto 0px 200px;
        }
        .infoDetails-title{
            padding-top:0px;
        }
        .progress-bar-success{
            background-color: #1c84c6;
        }
		.liinput{
			border: 1px solid #d2d2d2;
			border-radius: 3px;
			color: #5b5b5b;
			height: 30px;
			width: 200px;
			padding: 5px 10px;
			box-sizing: border-box;
		}
    </style>
	<body>
		<div class="doctorInfoBox">
			<!--第一行信息-->
			<div class="doctorInfoHead">
				<div class="doctorSex">
					<span class="doctorSexLeft">医院</span>
					<select name="" class="doctorSexRight"id="doctorInfoSearchHos">
						<!--<option value=""></option>
						<option value="医院1">医院1</option>
						<option value="医院2">医院2</option>
						<option value="医院3">医院3</option>-->
					</select>
				</div>

				<div class="doctorSex">
					<span class="doctorSexLeft">科室</span>
					<select name="" class="doctorSexRight"id="doctorInfoSearchTechOffice">
						<!--<option value=""></option>
						<option value="科室1">科室1</option>
						<option value="科室2">科室2</option>
						<option value="科室3">科室3</option>-->
					</select>
				</div>
				<div class="doctorNanme">
					<span class="doctorNanmeLeft">姓名</span>
					<input class="doctorNanmeRight" type="text" id="doctorInfoSearchName" value="" />
				</div>

				<button class="doctorBtnCheck"id="doctorSearchBtns">查询</button>
				<button class="doctorBtnClear"id="doctorSearchClearData">清空</button>
				<button class="doctorBtnAdd">已选发送消息</button>
			</div>
			<!--信息列表-->
			<div class="doctorInfoList">
				<ul class="doctorInfoList-ul">
					<li class="doctorInfoList-all LiTextAlign"><input type="checkbox" onclick="selectall()" style="height:15px;width:15px;vertical-align: sub;" value="" name="check" id="check">全选</li>
					<li class="doctorInfoList-code LiTextAlign">序号</li>
					<li class="doctorInfoList-name LiTextAlign">组织名称</li>
					<!--<li class="doctorInfoList-sex">医院科室</li>-->
					<li class="doctorInfoList-id LiTextAlign">用户姓名</li>
					<li class="doctorInfoList-tel LiTextAlign">联系电话</li>
					<li class="doctorInfoList-des LiTextAlign">用户描述</li>
					<li class="doctorInfoList-check LiTextAlign">操作</li>
					<!--<li class="doctorInfoList-change LiTextAlign">修改</li>-->
					<!--<li class="doctorInfoList-del LiTextAlign">删除</li>-->
				</ul>
				<!--医生信息列表内容区-->
				<div id="doctorContentList">
					<!--<ul class="doctorInfoDetail-ul">
					<li class="doctorInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>
					<li class="doctorInfoDetail-code"><span>1</span></li>
					<li class="doctorInfoDetail-name"><span>天津医科大学总医院</span></li>
					<li class="doctorInfoDetail-sex"><span>心内科</span></li>
					<li class="doctorInfoDetail-id"><span>王医生</span></li>
					<li class="doctorInfoDetail-tel"><span>13612345678</span></li>
					<li class="doctorDescript"><span>副主任医师，擅长治疗心内疾病，30年临床经验</span></li>
					<li class="doctorInfoDetail-check"><a href = "javascript:void(0)" class="btn-check"><img src="../../img/common/untitledSearBtn.png"/></a></li>
					<li class="doctorInfoDetail-change"><a href = "javascript:void(0)" class="btn-change"><img src="../../img/common/untitledChangeBtn.png"/></a></li>
					<li class="doctorInfoDetail-del"><a href = "javascript:void(0)" class="btn-del"><img src="../../img/common/untitledDelBtn.png"/></a></li>
				</ul>-->
				</div>

			</div>
			<div class="clearfix"></div>
			<!--分页-->
			<div class="doctorpageN"></div>

			<!--患者信息查询-->

			<div id="doctorlight1" class="white_content">
				<div class="white_contentHead">
					<span class="infoTitle">用户信息查询</span>
					<a id="close"class="close" href="javascript:void(0)" onclick="closeF()">&times;</a>
				</div>
				<div class="infoDetails"style="overflow: hidden;">
					<div class="infoDetailsHead">用户信息查询</div>
					<ul class="infoDetails-ul">
						<li><span class="infoDetails-title">用户类型：</span><input type="text" name="" id="lookDoctorInfoUserType" value="" /></li>
						<li class="lookHosInfos"><span class="infoDetails-title">医院名称：</span><input type="text" name="" id="lookDoctorInfoHospName" value="医科大学总医院" /><input type="texts"class="hiddenLookDoctorInfoHospId" style="display: none;"/></li>
						<li class="lookOfficeInfos"><span class="infoDetails-title">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室：</span><input type="text" name="" id="lookDoctorInfoTechOffice" value="心内科" /><input type="texts"class="hiddenLookDoctorInfoTechOId" style="display: none;"/></li>
						<li class="lookDeptInfos"><span class="infoDetails-title">部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门：</span><input type="text" name="" id="lookDoctorInfoDept" value="" /><input type="texts"class="hiddenLookDoctorInfoDeptId" style="display: none;"/></li>
						<li><span class="infoDetails-title">用户姓名：</span><input type="text" name="" id="lookDoctorInfoUserName" value="王医生" /></li>
						<li><span class="infoDetails-title">联系电话：</span><input type="text" name="" id="lookDoctorInfoTel" value="00000000000000" /></li>
						<li class="liBig"><span class="infoDetails-title lf">用户描述：</span><textarea type="text" name="" id="lookDoctorInfoDetail"class="lf" value="副主任医师等等" /></textarea></li>
						<!--<li class="liBig"><span class="infoDetails-title">过敏史：</span><input type="text" name="" id="" value="冠心病，高血压，心脏病，三高，前列腺炎，胸闷气短，憋气压抑等" /></li>-->
					</ul>

				</div>
				<!--<button id="infoDetails-close">关闭</button>-->
				<a id="close2" href="javascript:void(0)" onclick="closeF()">关闭</a>
			</div>

			<!--删除-->

			<div id="doctorlight2" class="white_content1">
				<div class="white_contentHead1">
					<img src="../../img/common/untitledquestionImg.png" />
				</div>
				<p>删除医生信息后不可恢复，您确定要删除该信息吗？</p>
				<a id="close3" href="javascript:void(0)" onclick="document.getElementById('doctorlight2').style.display='none';document.getElementById('fade').style.display='none'">取消</a>
				<div class="delHiddenListId"style="display: none;"></div>
				<button id="del-yes">确定删除</button>
			</div>

			<!--医生新增-->
			<div id="doctorlight4" class="white_content">
					<form id="equipmentForm" onsubmit="return false;">
				<div class="white_contentHead">
					<span class="infoTitle">发送消息</span>
					<a id="close" class="close"href="javascript:void(0)" onclick="closeF()">&times;</a>
				</div>
				<div class="infoDetails">
					<div class="infoDetailsHead">发送消息</div>
					<ul class="infoDetails-ul">
                        
                            <li style="width:100%">
                                    <span class="infoDetails-title" style="display: inline-block;height:20px;width: 98px;text-align: right;"><span style="color:#FF423F">*</span>消息标题：</span><input type="text" name="" id="title" value=""/>
                            </li>
                        <li><span class="infoDetails-title">发送消息类型：</span>
                            <select name=""  class="liinput" style="width: 70%;height: 30px;"id="changeMessageType">
                                </select>
                        </li>
                        <li style="padding-top:4px;"><div class="infoDetails-title" style="float:left;">发送端：</div>
                            <div>
                                    <label style="margin-right: 10px;">
                                        <input type="checkbox" style="height:15px;width:15px;vertical-align: sub;" value="1" name="ck" id="inlineCheckbox1">PC</label>
                                    <label>
                                        <input type="checkbox" style="height:15px;width:15px;vertical-align: sub;" value="1" id="inlineCheckbox2">手机端</label>
                                </div></li>
						<li class="liBig">
							<span class="infoDetails-title lf"style="display: inline-block;height:100px;width: 98px;text-align: right;"><span style="color:#FF423F">*</span>消息内容：</span>
							<textarea class="liinput" id="addDoctorInfoDetail"style="height:100px;width:538px !important;"></textarea>
						</li>
					</ul>
                </div>
                <div class="progress" style="display: none;">
                        <div id="progress" style="width: 0%;" aria-valuemax="100" aria-valuemin="0" aria-valuenow="0" role="progressbar" class="progress-bar progress-bar-success">
                            <span class="sr-only">35% Complete (success)</span>
                        </div>
                    </div>
				<button id="add-ok">发送</button>

				<a id="close4" href="javascript:void(0)" onclick="closeF()">取消</a>
				</form>
			</div>

			<!--点击按钮修改-->

			<div id="doctorlight5" class="white_content">
				<div class="white_contentHead">
					<span class="infoTitle">用户信息修改</span>
					<a id="close"class="close" href="javascript:void(0)" onclick="document.getElementById('changeDoctorInfoDeptLay').style.display='none';document.getElementById('doctorlight5').style.display='none';document.getElementById('fade').style.display='none'">&times;</a>
				</div>
				<div class="infoDetails">
					<div class="infoDetailsHead">用户信息修改</div>
					<ul class="infoDetails-ul">
						<li class="changeDoctorSelectUserIdentity">
							<span class="infoDetails-title">用户身份：
                			<select name="" style="width: 70%;height: 30px;"id="changeDoctorInfoUserInfo">
                				<option value="1"selected="selected">医生</option>
                				<option value="2">非医生</option>
                			</select>
                		</li>
                		<li class="changeDoctorInfohospitalName"><span class="infoDetails-title">医院名称：
                			<select name="" style="width: 70%;height: 30px;"id="changeDoctorInfoHspName">
                				<!--<option value=""></option>
                				<option value="医院1">医院1</option>
                				<option value="医院2">医院2</option>
                				<option value="医院3">医院3</option>-->
                			</select>
                		</li>
                		<li class="changeDoctorInfoTechOffice"><span class="infoDetails-title">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室：
                			<select name="" style="width: 70%;height: 30px;"id="changeDoctorInfoTechOffice">
                				<!--<option value=""></option>
                				<option value="科室1">科室1</option>
                				<option value="科室2">科室2</option>
                				<option value="科室3">科室3</option>-->
                			</select>
                		</li>
                		<li class="changeDoctorInfoChoseDept">
                			<span class="infoDetails-title">部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门：</span><input type="text" name="" id="changeDoctorInfoDept" value="" placeholder="点击选择部门" disabled="disabled" /><input type="text" id="changeDoctorInfoDeptHiddenId" style="display: none;" />
						</li>
						<li><span class="infoDetails-title">用户姓名：</span><input type="text" name="" id="changeDoctorInfoDocName" value="" /></li>
						<li><span class="infoDetails-title">联系电话：</span><input type="text" name="" id="changeDoctorInfoDocTel" value="" /></li>
						<li class="liBig"><span class="infoDetails-title lf">用户描述：</span><textarea type="text" name="" id="changeDoctorInfoDetail" value="" /></textarea></li>
					</ul>
					<!--部门弹出层-->
					<div id="changeDoctorInfoDeptLay">
						<ul class="addDoctorInfoDept1 lf">
							<!--<li class="activeChoseDept">
                				部门1
                			</li>-->
						</ul>
						<!--<ul class="addDoctorInfoDept2 lf">
                			<li>
                				部门11
                			</li>
                		</ul>-->
					</div>
					<div class="changeHiddenListId"style="display: none;"></div>
				</div>
				<button id="change-ok">确定修改</button>

				<!--<button id="change-cancle">确定修改</button>-->

				<a id="change-cancle" href="javascript:void(0)" onclick="document.getElementById('doctorlight5').style.display='none';document.getElementById('fade').style.display='none'">取消修改</a>
			</div>

			<!--灰背景-->
			<div id="fade" class="black_overlay"></div>

		</div>

	</body>
	<!--<script src="../../js/jQuery-jcDate.js" type="text/javascript" charset="utf-8"></script>-->

	<script src="../../js/jquery-3.0.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
	<script src="../../js/plugins/validate/messages_zh.min.js"></script>

	<script type="text/javascript">
		$("#equipmentForm").validate();

        var sendAcceptIds = "";
		//			点击搜索按钮
		$(document).on("click", ".searching", function() {
			var search = $("#searchBox").val().trim();
		});

        //关闭调用
        function closeF(){
            //console.log("关闭")
            $(".progress").css("display","none");
            $("#progress").css("width","0%");
            next = 0;
            document.getElementById('doctorlight4').style.display='none';
            document.getElementById('fade').style.display='none';
            ids = [];
            sendAcceptIds = "";
            $("#changeMessageType").html(' ');
            $('#addDoctorInfoDetail').val("");
            $("#title").val("");
            $('#inlineCheckbox1').prop("checked",false);
            $('#inlineCheckbox2').prop("checked",false);
        }

		//		点击查询按钮
		$(document).on("click", ".btn-check", function() {
            $('#inlineCheckbox1').prop("checked",false);
            $('#inlineCheckbox2').prop("checked",false);

            sendAcceptIds += $(this).attr('data-id');
			$("#doctorlight4").fadeIn();
			$("#fade").fadeIn();

            messageTypeList();
			
			$("#addDoctorInfoDocName").val(" ");
			$("#addDoctorInfoDocTel").val(" ");
		});

        function selectall(){
            if($('#check').is(":checked")){
                $("input[type='checkbox']").prop("checked", true);
            }else{
                $("input[type='checkbox']").prop("checked", false);
            }
            
        }
        function selectCheck(){
            $('#check').prop("checked",false);

        }

		//		点击删除按钮
		$(document).on("click", ".btn-del", function() {
			$(".delHiddenListId").text($(this).parent().parent().find(".doctorInfoListId").text());
			$("#doctorlight2").fadeIn();
			$("#fade").fadeIn();
		});
		//		点击新增按钮
		var selectHosId; //定义新增默认选择的医院的id;
		var deptPid = 0; //定义新增默认选择的部门第一层pid为0
		var deptChoseName;//新增里的默认选择的部门名称
		$(".doctorBtnAdd").click(function() {
            $('#inlineCheckbox1').prop("checked",false);
            $('#inlineCheckbox2').prop("checked",false);

			$("#doctorlight4").fadeIn();
			$("#fade").fadeIn();
            
            //获得选择ID
            $('input:checkbox:checked').each(function (index, item) {
                sendAcceptIds += ($(this).val())+",";
            });
            
            //console.log(ids);

            messageTypeList();
			
			$("#addDoctorInfoDocName").val(" ");
			$("#addDoctorInfoDocTel").val(" ");
		});

		//点击修改按钮
		var changeInfoSelectHosId; //定义新增默认选择的医院的id;
		var changeInfodeptPid = 0; //定义新增默认选择的部门第一层pid为0
		var changeInfodeptChoseName;//新增里的默认选择的部门名称
		var changeInfoCurrentId;
$(document).on("click", ".btn-change", function() {
			var changeDoctorInfoUserTypeId=$(this).parent().parent().find('.doctorInfoType').text();
			var changeDoctorInfoUserType;
			var changedoctorInfofkHospitalName=$(this).parent().parent().find(".doctorInfofkHospitalName").text();//医院名称
			var changedoctorInfofkSectionName=$(this).parent().parent().find(".doctorInfofkSectionName").text();//科室名称
			var changedoctorInfofkDeptName=$(this).parent().parent().find(".doctorInfoDetail-name").text();//部门名称
			var changedoctorInfofkHospitalId=$(this).parent().parent().find(".doctorInfofkHospitalId").text();//医院id
			var changedoctorInfofkSectionId=$(this).parent().parent().find(".doctorInfofkSectionId").text();//科室id
			var changedoctorInfofkDeptId=$(this).parent().parent().find(".doctorInfofkDeptId").text();//部门id
			var changedoctorInfoUserName=$(this).parent().parent().find(".doctorInfoDetail-id span").text();//用户名
			var changedoctorInfoTels=$(this).parent().parent().find(".doctorInfoDetail-tel span").text();//用户电话
			var changedoctorInfoDetails=$(this).parent().parent().find(".doctorDescript span").text();//医生描述
			$(".changeHiddenListId").text($(this).parent().parent().find(".doctorInfoListId").text());
			if(changeDoctorInfoUserTypeId=="1"){
				changeDoctorInfoUserType="医生" //用户类型
				$(".changeDoctorInfohospitalName").css("display","block");
				$(".changeDoctorInfoTechOffice").css("display","block");
				$(".changeDoctorInfoChoseDept").css("display","none");
			}else if(changeDoctorInfoUserTypeId=="2"){
				changeDoctorInfoUserType="非医生" //用户类型
				$(".changeDoctorInfohospitalName").css("display","none");
				$(".changeDoctorInfoTechOffice").css("display","none");
				$(".changeDoctorInfoChoseDept").css("display","block");
			}
//			初始化医院信息
			var changedoctorDivIds = $("#changeDoctorInfoHspName").attr("id"); //获取当前修改弹框医生信息里医院选项的select的id
//			读取医院信息
			if(changedoctorInfofkHospitalId==""||changedoctorInfofkHospitalId=="null"||changedoctorInfofkHospitalId=="undefined"){
				changedoctorInfofkHospitalId=1;
			}
			changeInfoSelectHosId = changedoctorInfofkHospitalId;
			changeInfoCurrentId=changedoctorInfofkSectionId;
			readHospital(changedoctorDivIds,changeInfoSelectHosId,changeInfoCurrentId);
			$("#changeDoctorInfoHspName").val(changedoctorInfofkHospitalId);
			
			if(changeInfoSelectHosId!=""&&changeInfoSelectHosId!=null&&changeInfoSelectHosId!=undefined){
				//			初始化科室信息
				var changecurrentTechOfficeSlcId = $("#changeDoctorInfoTechOffice").attr("id");
				techOffice(changeInfoSelectHosId,changecurrentTechOfficeSlcId,changeInfoCurrentId);
			}

//			初始化部门信息
//			读取部门信息
			if(changedoctorInfofkDeptId!=""&&changedoctorInfofkDeptId!=null){
				changeInfodeptPid=parseInt(changedoctorInfofkDeptId);
			}else{
				changeInfodeptPid=0;
			}
			var changedoctorSelectDeptIds = $("#changeDoctorInfoDeptLay").attr("id");//修改弹框里的部门弹框
			readDept(changedoctorSelectDeptIds,0);
			$("#changeDoctorInfoUserInfo").val(changeDoctorInfoUserTypeId);
			$("#changeDoctorInfoHspName").val(changedoctorInfofkHospitalName);//医院
			$("#changeDoctorInfoTechOffice").val(changedoctorInfofkSectionName);//科室
			$("#changeDoctorInfoDept").val(changedoctorInfofkDeptName);//部门
			$("#changeDoctorInfoDocName").val(changedoctorInfoUserName);//用户名
			$("#changeDoctorInfoDocTel").val(changedoctorInfoTels);//电话
			$("#changeDoctorInfoDetail").val(changedoctorInfoDetails);//描述
			$("#doctorlight5").fadeIn();
			$("#fade").fadeIn();
//			console.log(changedoctorInfoDetails);
			
		})
		// 	新增内容里医院和部门联动
		$(".doctorSelectUserIdentity select").change(function() {
			if($(this).val() == "1") {
				$(".AddDoctorInfohospitalName").css("display", "block");
				$(".AddDoctorInfoTechOffice").css("display", "block");
				$(".AddDoctorInfoChoseDept").css("display", "none");
			} else {
				$(".AddDoctorInfohospitalName").css("display", "none");
				$(".AddDoctorInfoTechOffice").css("display", "none");
				$(".AddDoctorInfoChoseDept").css("display", "block");
			}
		});
		//修改信息弹框里的医院和部门联动
		$(".changeDoctorSelectUserIdentity select").change(function() {
			if($(this).val() == "1") {
				$(".changeDoctorInfohospitalName").css("display", "block");
				$(".changeDoctorInfoTechOffice").css("display", "block");
				$(".changeDoctorInfoChoseDept").css("display", "none");
			} else {
				$(".changeDoctorInfohospitalName").css("display", "none");
				$(".changeDoctorInfoTechOffice").css("display", "none");
				$(".changeDoctorInfoChoseDept").css("display", "block");
			}
		});
		//点击新增里的医院选择框	
		$("#addDoctorInfoHspName").change(function() {
			//	console.log($(this).val());
			var currentTechOfficeSlcId = $("#addDoctorInfoTechOffice").attr("id");
			selectHosId = $(this).val();
			techOffice(selectHosId, currentTechOfficeSlcId);
		});
		//点击修改框里的医院选择框
		$("#changeDoctorInfoHspName").change(function() {
			//	console.log($(this).val());
			var changecurrentTechOfficeSlcId = $("#changeDoctorInfoTechOffice").attr("id");
			changeInfoSelectHosId = $(this).val();
			techOffice(changeInfoSelectHosId, changecurrentTechOfficeSlcId);
		});
		//点击增加的部门弹框里的内容时
		var kIndex = 1; //初始化有几个ul
		$("#doctorlight4").on("click", "#addDoctorInfoDeptLay li", function() {
			//	console.log($(this).val());
			var addDoctorInfoDeptLayId = $("#addDoctorInfoDeptLay").attr("id");
			deptPid = parseInt($(this).find(".currentDeptId").text());
			deptChoseName = $(this).find(".currentDeptName").text();
			$("#addDoctorInfoDeptHiddenId").val(deptPid);
			$("#addDoctorInfoDept").val(deptChoseName);
			//	获取当前点击的是第几层
			var index = $("#addDoctorInfoDeptLay ul").index($(this).parent()); //判断是第几个ul
			kIndex = index + 2;
			if($(this).parent().next().length == 0) { //如果当前点击的ul后面没有ul添加一个，如果有就不添加
				//		k++;
				sessionStorage.setItem("currentUlNum", kIndex); //当前有几个ul了，重新加载页面的时候记住并添加
				$(this).parent().after('<ul class="addDoctorInfoDept' + kIndex + ' lf"></ul>');
			}
			readDept(addDoctorInfoDeptLayId, deptPid, index);
		});
		//点击修改弹框里的部门弹框里的内容时
		var changekIndex = 1; //初始化有几个ul
		$("#doctorlight5").on("click", "#changeDoctorInfoDeptLay li", function() {
			//	console.log($(this).val());
			var changeDoctorInfoDeptLay = $("#changeDoctorInfoDeptLay").attr("id");
			changeInfodeptPid = parseInt($(this).find(".currentDeptId").text());
			cahngeDeptChoseName = $(this).find(".currentDeptName").text();
			$("#changeDoctorInfoDeptHiddenId").val(changeInfodeptPid);
			$("#changeDoctorInfoDept").val(cahngeDeptChoseName);
			//	获取当前点击的是第几层
			var index = $("#changeDoctorInfoDeptLay ul").index($(this).parent()); //判断是第几个ul
			changekIndex = index + 2;
			if($(this).parent().next().length == 0) { //如果当前点击的ul后面没有ul添加一个，如果有就不添加
				//		k++;
				sessionStorage.setItem("currentUlNum", changekIndex); //当前有几个ul了，重新加载页面的时候记住并添加
				$(this).parent().after('<ul class="changeDoctorInfoDept' + changekIndex + ' lf"></ul>');
			}
			readDept(changeDoctorInfoDeptLay, changeInfodeptPid, index);
		});
		$("body").click(function (e) {
		    if (!$(e.target).closest(".AddDoctorInfoChoseDept,#addDoctorInfoDeptLay").length) {
		        $("#addDoctorInfoDeptLay").hide();
		    }
		});
		$(".AddDoctorInfoChoseDept").click(function(e) {
				$("#addDoctorInfoDeptLay").toggle();
		});
		//点击修改里的选择部门
		$("body").click(function (e) {
		    if (!$(e.target).closest(".changeDoctorInfoChoseDept,#changeDoctorInfoDeptLay").length) {
		        $("#changeDoctorInfoDeptLay").hide();
		    }
		});
		$(document).ready(function() {
			$(".changeDoctorInfoChoseDept").click(function(e) {
				$("#changeDoctorInfoDeptLay").toggle();
			});
		});
		//消息类型
        function messageTypeList(){
            ajaxGet(
        	'/oa/wsmessageType/list', 
        	{},
        	function (resData) {
            var data = resData.resultMap.types;
            appointHlistTotal=resData.resultMap.total;//总条数

            //console.log("-------此处是预约的分割线-------");
            //console.log(data);
            
            for (var t = 0; t < data.length; t++) {
                var changeMessageType = '';
                
                if(t == 0){
                    changeMessageType += '<option selected value="' + data[t].wname + '">' + data[t].wname + '</option>';
                }else{
                    changeMessageType += '<option value="' + data[t].wname + '">' + data[t].wname + '</option>';
                }
                $("#changeMessageType").append(changeMessageType);
            }

        });
        }
		//		读取医院的接口
		function readHospital(currentSelectIds,currentName,currentTid) { //参数为外层的selcect的id
			console.log(currentSelectIds);
			$("#" + currentSelectIds).html('<option value="0"selected="selected">请选择</option>');
			
			$.ajax({
				type: "get",
				url: config + "/sys/hospital/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var hospitalList = data.resultMap.hospitalList;
						for(var s = 0; s < hospitalList.length; s++) {
							var hospitalHtml = '';
							hospitalHtml += '<option value="' + hospitalList[s].id + '">' + hospitalList[s].name + '</option>';
							$("#" + currentSelectIds).append(hospitalHtml);
						}
					}
					selectHosId = $("#addDoctorInfoHspName").val(); //定义默认选择的医院的id;
					console.log(selectHosId);
					selectHosId=currentName;
					var currentTechOfficeSlcId = $("#" + currentSelectIds).parent().parent().next().find("select").attr("id");
					if(currentTid!=""&&currentTid!=null&&currentTid!=undefined){
						$("#" + currentSelectIds).val(selectHosId);
					}else{
						$("#" + currentSelectIds).val(0);
					}
					techOffice(selectHosId,currentTechOfficeSlcId,currentTid);
				},
			});
		}
        //读取科室
		function techOffice(currentSelectHosIds, currentTechSelect,currentTid) { //参数为当前选择上的医院的id和科室的select的id
			$("#" + currentTechSelect).html('<option value="0"selected="selected">请选择</option>');
			$.ajax({
				type: "get",
				url: config + "/sys/section/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					fkHospitalId: currentSelectHosIds
				},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var sectionList = data.resultMap.sectionList;
						for(var t = 0; t < sectionList.length; t++) {
							var techOfficeHtml = '';
							techOfficeHtml += '<option value="' + sectionList[t].id + '">' + sectionList[t].name + '</option>';
							$("#" + currentTechSelect).append(techOfficeHtml);
						}
						if(currentTid!=""&&currentTid!=null&&currentTid!=undefined){
							$("#" + currentTechSelect).val(currentTid);
						}else{
							$("#" + currentTechSelect).val(0);
						}
					}
				},
			});
		}

		//读取部门
		function readDept(currentSelectDeptIds, deptPid, index) { //参数为当前选择上的医院的id和科室的select的id
			if(deptPid == 0) {
				$("#" + currentSelectDeptIds).find(".addDoctorInfoDept1").html('');
			} else {
				var currentIndex = index + 2;
				console.log(currentIndex);
				$("#" + currentSelectDeptIds).find(".addDoctorInfoDept" + currentIndex).html(''); //添加之前先清空
				$("#" + currentSelectDeptIds).find(".addDoctorInfoDept" + currentIndex).nextAll().remove();
			}
			$.ajax({
				type: "get",
				url: config + "/sys/dept/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					pid: deptPid
				},
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						var deptList = data.resultMap.deptList;
						if(deptPid == 0) {
							console.log(currentSelectDeptIds);
							for(var a = 0; a < deptList.length; a++) {
								var deptListHtml = '';
								deptListHtml += '<li><span class="currentDeptName">' + deptList[a].name + '</span><span class="currentDeptId"style="display:none;">' + deptList[a].id + '</span></li>';
								$("#" + currentSelectDeptIds).find(".addDoctorInfoDept1").append(deptListHtml);
							}
						} else {
							for(var a = 0; a < deptList.length; a++) {
								var deptListHtml = '';
								deptListHtml += '<li><span class="currentDeptName">' + deptList[a].name + '</span><span class="currentDeptId"style="display:none;">' + deptList[a].id + '</span></li>';
								$("#" + currentSelectDeptIds).find(".addDoctorInfoDept" + currentIndex).append(deptListHtml);
							}
						}

					}
				},
			});
		}
		//      以下是调取接口
		//		加载列表
		var userId = sessionStorage.getItem('userId');
		//		分页
		var currentPage = 1;
		var offsetPage = 0; //传输的页起始条数
		var showNum = 10; //页面需要显示的条数
		var doctoNum_pages;
		//点击分页页数
		$(document).delegate(".flipOver", 'click', function() {
			$(this).addClass('active').siblings().removeClass('active');
			currentPage = parseInt($(this).attr("pageId"));
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			doctorList();
			window.scrollTo(0, 0);
		});
		//点击上一页
		$(document).delegate("#prev", 'click', function() {
			if($(".flipOver.active").prev().attr("id") == "prev") {
				return true
			} else {
				var page = parseInt($(".flipOver.active").attr("pageid")) - 1;
				$(".flipOver.active").prev().addClass("active").siblings().removeClass("active")
			}
			currentPage = page;
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			doctorList();
			window.scrollTo(0, 0);
		});

		//点击下一页
		$(document).delegate("#Next", 'click', function() {
			if($(".flipOver.active").next().attr("id") == "Next") {
				return true
			} else {
				var page = parseInt($(".flipOver.active").attr("pageid")) + 1;
				$(".flipOver.active").next().addClass("active").siblings().removeClass("active")
			}
			currentPage = page;
			offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
			doctorList();
			window.scrollTo(0, 0);
		});
			//点击分页跳转页按钮
	    $(document).delegate(".srueToJumpPageBtn",'click',function(){
	        currentPage = parseInt($(".toPageNum").val().trim());
	        offsetPage = (currentPage-1)*10;//（页码-1）*每页显示条数
	        doctorList();
	        window.scrollTo(0,0);
	    });
		//			读取用户列表
		var searchHospitalId="";  
		var searchSectionId="";  
		var searchUserName="";
		doctorList();
		//	获取订单列表
		function doctorList() {
			$("#doctorContentList").html('');
			$.ajax({
				type: "get",
				url: config + "/sys/user/list",
				async: false,
				dataType: "jsonp",
				jsonp: "jsoncallback",
				data: {
					//所属科室id
					fkSectionId:searchSectionId,
					//所属医院id
					fkHospitalId:searchHospitalId,
					//员工姓名
					userName:searchUserName,
					offset: offsetPage, //（页码-1）*每页显示条数
					limit: showNum //每页赢显示的条数	
				},
				success: function(data) {
					console.log("此处为医生管理列表信息");
					console.log(data);
					var doctorinfoList = data.resultMap.userList;
					var doclistTotal = data.resultMap.total; //总条数
					//							var index = data.viewIndex;
//					alert(doclistTotal);
					doctoNum_pages = Math.ceil(parseInt(doclistTotal) / 10); //总条数除以每页十条数据为总页码
//					alert(doctoNum_pages);
					for(var i = 0, k = 0; i < doctorinfoList.length; i++) {
						console.log(doctorinfoList[i].name);
						var doctorhtml = '';
						k++;
						doctorhtml += '<ul class="doctorInfoDetail-ul">';
						doctorhtml += '<li class="doctorInfoListId"style="display:none">' + doctorinfoList[i].id + '</li>' ;//隐藏的用户身份
						doctorhtml += '<li class="doctorInfoType"style="display:none">' + doctorinfoList[i].type + '</li>' ;//隐藏的用户身份
						doctorhtml += '<li class="doctorInfofkHospitalId"style="display:none">' + doctorinfoList[i].fkHospitalId + '</li>';//隐藏的医院id
						doctorhtml += '<li class="doctorInfofkHospitalName"style="display:none">' + doctorinfoList[i].hospitalName + '</li>';//隐藏的医院名称
						doctorhtml += '<li class="doctorInfofkSectionId"style="display:none">' + doctorinfoList[i].fkSectionId + '</li>'; //隐藏的科室id
						doctorhtml += '<li class="doctorInfofkSectionName"style="display:none">' + doctorinfoList[i].sectionName + '</li>';//隐藏的科室名称
						doctorhtml += '<li class="doctorInfofkDeptId"style="display:none">' + doctorinfoList[i].fkDeptId + '</li>';//隐藏的部门id
//						doctorhtml += '<li class="doctorInfoDetail-radio"><label class="radio"><input type="radio" name="radio" id="" value="" class="radioclass"/><i></i></label></li>';
                        doctorhtml += '<li class="doctorInfoList-all LiTextAlign"><input onclick="selectCheck()" type="checkbox" style="height:15px;width:15px;vertical-align: sub;" value="' + doctorinfoList[i].id + '" name="check' + doctorinfoList[i].id + '" id="check' + doctorinfoList[i].id + '"></li>';
                        doctorhtml += '<li class="doctorInfoDetail-code LiTextAlign"><span>' + k + '</span></li>';
						if(doctorinfoList[i].type == 1) {
							if(doctorinfoList[i].hospitalName == "" || doctorinfoList[i].hospitalName == null) {
								if(doctorinfoList[i].sectionName == "" || doctorinfoList[i].sectionName == null) {
									doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span></span></li>'; //组织名称为医院和科室组织的
								} else {
									doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span>' + doctorinfoList[i].sectionName + '</span></li>'; //组织名称为医院和科室组织的
								}
							} else {
								if(doctorinfoList[i].sectionName == "" || doctorinfoList[i].sectionName == null) {
									doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span>' + doctorinfoList[i].hospitalName + '</span></li>'; //组织名称为医院和科室组织的
								} else {
									doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span>' + doctorinfoList[i].hospitalName + '（' + doctorinfoList[i].sectionName + '）' + '</span></li>'; //组织名称为医院和科室组织的
								}
							}
						} else {
							if(doctorinfoList[i].deptName == "" || doctorinfoList[i].deptName == null) {
								doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span></span></li>'; //部门
							} else {
								doctorhtml += '<li class="doctorInfoDetail-name LiTextAlign"><span>' + doctorinfoList[i].deptName + '</span></li>'; //部门
							}
						}

						//								doctorhtml+='<li class="doctorInfoDetail-sex"><span>'+doctorinfoList[i].fkDeptId+'</span></li>';//科室
						doctorhtml += '<li class="doctorInfoDetail-id LiTextAlign"><span>' + doctorinfoList[i].userName + '</span></li>'; //医生姓名
						if(doctorinfoList[i].mobile != "" && doctorinfoList[i].mobile != null) {
							doctorhtml += '<li class="doctorInfoDetail-tel LiTextAlign"><span>' + doctorinfoList[i].mobile + '</span></li>'; //医生电话
						} else {
							doctorhtml += '<li class="doctorInfoDetail-tel LiTextAlign"><span></span></li>'; //医生电话
						}

						if(doctorinfoList[i].memo != "" && doctorinfoList[i].memo != null) {
							doctorhtml += '<li class="doctorDescript LiTextAlign"><span>' + doctorinfoList[i].memo + '</span></li>'; //医生描述
						} else {
							doctorhtml += '<li class="doctorDescript LiTextAlign"><span></span></li>'; //医生描述
						}
						doctorhtml += '<li class="doctorInfoDetail-check LiTextAlign"><a href = "javascript:void(0)" data-id="'+doctorinfoList[i].id+'" class="btn-check btnTextColor"><span>发送消息</span></a></li>';
						doctorhtml += '</ul>';
						$("#doctorContentList").append(doctorhtml);
						var pageHtml = page(parseInt(currentPage), doctoNum_pages);
						$(".doctorpageN").html(pageHtml);
					}
					if(data.status == 1) {}
				},
			});
		}
		//		点击发送消息
        var ids = "";
        var next=0;
		$("#doctorlight4 #add-ok").click(function() {
			if($("#equipmentForm").valid()){

			};
            ids = sendAcceptIds.split(",");console.log(ids);
            sendTypeMessage(ids[next]);
			
		});
        
        function sendTypeMessage(id){
            $(".progress").css("display","block");
            $("#progress").css("width",(next/ids.length*100)+"%");
            var userId=sessionStorage.getItem('userId');console.log(sendAcceptIds)
            if(sendAcceptIds==""){
                alert("请选择要发送的用户");
				closeF();
                return;
            }
            if(next >= ids.length){
                $("#progress").css("width","100%");
                closeF();
                //终止
                return ;
            }
            if(!id == ""){
                $.ajax({
                method: 'get',
                url: config + '/oa/wsmessage/save',
                contentType: "application/json; charset=utf-8", //传到后台的数据格式
                async: true,
                data: {
                    actionType: $("#changeMessageType").val(),
                    pc:$('#inlineCheckbox1').is(':checked')?$("#inlineCheckbox1").val():0,
                    mobile:$('#inlineCheckbox2').is(':checked')?$("#inlineCheckbox2").val():0,
                    creatUserId: userId,
                    acceptUserId: id,
                    content: $('#addDoctorInfoDetail').val(),
                    title: $("#title").val()
                },
                dataType: 'jsonp', //接收值的格式
                jsonp: 'jsoncallback',
                success: function(data) {
                    //console.log(data);
                    next++;
                    sendTypeMessage(ids[next]);
                },
                error: function(result) {
                    //console.log(result);
                    //错误继续执行
                    next++;
                    sendTypeMessage(ids[next]);
                }
            });
            }else{
                next++;
                sendTypeMessage(ids[next]);
            }
            
        }
		
		//		点击确认修改
		$("#doctorlight5 #change-ok").click(function() {
			var changeListIds=parseInt($(".changeHiddenListId").text()); //用户id
			var userIdentity = $("#changeDoctorInfoUserInfo").val(); //用户身份
			var changeDoctorInfoHspName = $("#changeDoctorInfoHspName").val(); //医院名
			var changeDoctorInfoTechOffice = $("#changeDoctorInfoTechOffice").val(); //科室
			var changeDoctorInfoDocName = $("#changeDoctorInfoDocName").val(); //医生姓名
			var changeDoctorInfoDocTel = $("#changeDoctorInfoDocTel").val(); //医生电话
			var changeDoctorInfoDetail = $("#changeDoctorInfoDetail").val(); //医生描述
			var changeDoctorInfoChoseDept = $("#changeDoctorInfoDept").val(); //获取所选部门
			var changeDoctorInfoChoseDeptId = $("#changeDoctorInfoDeptHiddenId").val(); //获取选择部门id
			var changeDoctorInfo = {}; //定义一个对象存放参数
			console.log(changeDoctorInfoHspName);
			if(userIdentity == "1") {
				if(changeDoctorInfoHspName==0||changeDoctorInfoHspName==null||changeDoctorInfoHspName==""){
					alert("请选择医院");
				}else if(changeDoctorInfoTechOffice==0||changeDoctorInfoTechOffice==null||changeDoctorInfoTechOffice==""){
					alert("请选择科室");
				}else if(changeDoctorInfoDocName==""||changeDoctorInfoDocName==null){
					alert("请输入用户名");
				}else if(changeDoctorInfoDocTel==""||changeDoctorInfoDocTel==null){
					alert("请输入联系方式");
				}else{
					changeDoctorInfo = {
						id:changeListIds,
						type: userIdentity,
						fkHospitalId: changeDoctorInfoHspName,
						fkSectionId: changeDoctorInfoTechOffice,
						userName: changeDoctorInfoDocName,
						mobile: changeDoctorInfoDocTel,
						memo: changeDoctorInfoDetail
					}
					$.ajax({/*
						method: 'get',
						url: config + '/sys/user/update',
						contentType: "application/json; charset=utf-8", //传到后台的数据格式
						async: true,
						data: changeDoctorInfo,
						dataType: 'jsonp', //接收值的格式
						jsonp: 'jsoncallback',
						success: function(data) {
							console.log(data);
							if(data.status == 1) {
								document.getElementById('doctorlight5').style.display = 'none';
								document.getElementById('fade').style.display = 'none';
								alert(data.message)
								doctorList();
							} else {
								alert(data.message);
								//		window.location.reload();
							}
						},
						error: function(result) {
							console.log(result);
						}
					*/});
				}
				
			} else {
				if(changeDoctorInfoChoseDept==""||changeDoctorInfoChoseDept==null){
					alert("请选择部门");
				}else if(changeDoctorInfoDocName==""||changeDoctorInfoDocName==null){
					alert("请输入用户名");
				}else if(changeDoctorInfoDocTel==""||changeDoctorInfoDocTel==null){
					alert("请输入联系方式");
				}else{
					changeDoctorInfo = {
						id:changeListIds,
						type: userIdentity,
						fkDeptId: changeDoctorInfoChoseDeptId,
						userName: changeDoctorInfoDocName,
						mobile: changeDoctorInfoDocTel,
						memo: changeDoctorInfoDetail
					}
					$.ajax({
						method: 'get',
						url: config + '/sys/user/update',
						contentType: "application/json; charset=utf-8", //传到后台的数据格式
						async: true,
						data: changeDoctorInfo,
						dataType: 'jsonp', //接收值的格式
						jsonp: 'jsoncallback',
						success: function(data) {
							console.log(data);
							if(data.status == 1) {
								document.getElementById('doctorlight5').style.display = 'none';
								document.getElementById('fade').style.display = 'none';
								alert(data.message)
								doctorList();
							} else {
								alert(data.message);
								//		window.location.reload();
							}
						},
						error: function(result) {
							console.log(result);
						}
					});
				}
				
			}
			
			
		})
//		删除单行数据
		$("#doctorlight2 #del-yes").click(function(){
			var changeListIds=parseInt($(".delHiddenListId").text()); //用户id
			$.ajax({
				method: 'get',
				url: config + '/sys/user/remove',
				contentType: "application/json; charset=utf-8", //传到后台的数据格式
				async: true,
				data: {id:changeListIds},
				dataType: 'jsonp', //接收值的格式
				jsonp: 'jsoncallback',
				success: function(data) {
					console.log(data);
					if(data.status == 1) {
						document.getElementById('doctorlight2').style.display = 'none';
						document.getElementById('fade').style.display = 'none';
						alert(data.message)
						doctorList();
					} else {
						alert(data.message);
						//		window.location.reload();
					}
				},
				error: function(result) {
					console.log(result);
				}
			});
		});
//	加载页面时默认加载查询条件---医院 科室 医生
	
readHospital("doctorInfoSearchHos");
	
	//	点击医院的时候联动科室
	$("#doctorInfoSearchHos").change(function(){
		var currentDoctorInfoSearchHos=$(this).val();
		searchHospitalId=currentDoctorInfoSearchHos;
		doctorList();
		techOffice(currentDoctorInfoSearchHos,"doctorInfoSearchTechOffice");
	});
//	点击页面查询
	$("#doctorSearchBtns").click(function(){
		searchHospitalId=$("#doctorInfoSearchHos").val();
		searchSectionId=$("#doctorInfoSearchTechOffice").val();
		searchUserName=$("#doctorInfoSearchName").val();
		doctorList();
	});
//点击清除按钮
	$("#doctorSearchClearData").click(function(){
		searchHospitalId="";
		searchSectionId="";
		searchUserName="";
		$("#doctorInfoSearchHos").val("");
		$("#doctorInfoSearchTechOffice").val("");
		$("#doctorInfoSearchName").val("");
		doctorList();
	});
//	点击医生身份选择时部门弹框消失
$("#addDoctorInfoUserInfo").click(function(){
	$("#addDoctorInfoDeptLay").fadeOut();
});
$("#changeDoctorInfoUserInfo").click(function(){
	$("#changeDoctorInfoDeptLay").fadeOut();
});
	</script>
</html>