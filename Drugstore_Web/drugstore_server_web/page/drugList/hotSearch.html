<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>药店连锁-热卖商品维护</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" />
		<link href="../../css/style.min.css?v=4.0.0" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
		<link rel="stylesheet" href="../../css/raw_table.css">

		<script type="text/javascript" src="../../js/jquery-3.0.0.min.js"></script>
		<script src="../../js/bootstrap.min.js?v=3.3.5"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/config.js"></script>
		<!--<script src="../../js/raw_fenye.js"></script>-->
		<script src="../../js/template.js"></script>
		<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
		<script src="../../js/plugins/suggest/bootstrap-suggest.min.js"></script>
		<script src="../../js/hotSearch.js"></script>
	</head>

	<body>
		<div class="contain">
			<div class="rightLoadContent">
				<!--页面数据呈现区-->
				<div class="disContents">
					<!--搜素区域-->
					<div class="searchInfos">
						<div class="rt addData" data-toggle="modal" data-target="#myModal1">
							新增
						</div>
					</div>
					<!--列表区域-->
					<div class="resultLists">
						<!--列表表头-->
						<div class="resultListsTitle">
							<div class="resultListsItem2 lf LiTextAlign">
								序号
							</div>
							<div class="resultListsItem2 lf LiTextAlign">
								热搜关键词
							</div>
							<!--<div class="resultListsItem2 lf LiTextAlign">
                        价格(元)
                    </div>
                    <div class="resultListsItem2 lf LiTextAlign">
                        图片
                    </div>
                    <div class="resultListsItem2 lf LiTextAlign">
                        标签
                    </div>-->
							<div class="resultListsItem3 lf LiTextAlign">
								操作
							</div>
						</div>
						<div class="resultListsContents" id="table_tpl_div">

						</div>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
		<!--新增模态框-->
		<div class="modal inmodal fade" id="myModal1" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog ">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
						<h4 class="modal-title" id="allot_title">热卖商品保存</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal m-t" id="sgForm">

							<div class="form-group">
								<label class="col-sm-4 control-label">药品名称：</label>
								<div class="col-sm-6">
									<div class=" input-group">
										<input type="text" class="form-control" id="ryaoName" name="content">
									</div>
								</div>
							</div>
							<input id="up_id" name="id" type="hidden">
							<input type="hidden" name="accessPath" id="rec" value="293">
							<input type="hidden" name="bannerUrl" id="bannerUrl" value="">
							<input type="hidden" name="tagUrl" id="tagUrl" value="">

							<!--固定type-->
							<input type="hidden" name="type" value="1">
							<!--无用必传值-->
							<input type="hidden" name="bjUrl" id="bjUrl" value="bjUrl">
							<input type="hidden" name="memo" id="memo" value="memo">

						</form>
					</div>
					<div class="modal-footer">
						<button type="button" onclick="dosubmit()" class="btn btn-primary">保存</button>
						<button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		<!--table模板-->
		<script id="table_tpl" type="text/html">
			<%for(var i=0;i< data.length;i++){%>
			<div class="resultListInfo">
				<div class="listId" style="display:none">
					<%=data[i].id%>
				</div>
				<div class="resultListsItem2 lf items LiTextAlign">
					<%=i+1%>
				</div>
				<div class="resultListsItem2 lf items LiTextAlign">
					<%=data[i].content%>
				</div>
				<!--<div class="resultListsItem2 lf items LiTextAlign"><%=data[i].price%></div>
        <div class="resultListsItem2 lf items LiTextAlign"><img src="<%=data[i].bannerUrl%>" height="100%"></div>
        <div class="resultListsItem2 lf items LiTextAlign"><img src="<%=data[i].tagUrl%>" height="100%"></div>-->

				<div class="resultListsItem1 lf items LiTextAlign btnTextColor">
					<span class="changeImg" data-index="<%=i%>" onclick="updateclick(this)" data-toggle="modal" data-target="#myModal1">修改</span>
				</div>
				<div class="resultListsItem1 lf items LiTextAlign btnTextColor">
					<span class="delImg" data-id="<%=data[i].id%>" onclick="form_del(this)">删除</span>
				</div>
				<div class="resultListsItem1 lf items LiTextAlign ">
					<span data-index="<%=i%>" data-id="<%=data[i].caSort%>"  onclick="r_shang(this)" class="btnTextColor  glyphicon glyphicon-arrow-up"></span>
					<span data-index="<%=i%>" data-id="<%=data[i].caSort%>" onclick="r_xia(this)" class="btnTextColor  glyphicon glyphicon-arrow-down"></span>
				</div>
				<div>
					<div class="clearfix"></div>
					<!--分页-->
					<!--<div class="reportQuerypageN"></div>-->
					<!--灰背景-->
					<div id="reportQueryFade" class="black_overlay"></div>
					<div id="reportQueryFadeUpload" class="black_overlay"></div>
					<div id="uploadingImg" style="display: none;text-align: center;"><img src="../../css/plugins/blueimp/img/loading.gif" alt="" style="width:40px;height:40px;" />上传中......</div>
				</div>
			</div>
			<%}%>
			<div>
			<div class="clearfix"></div>
			<!--分页-->
			<div class="reportQuerypageN"></div>
			<!--灰背景-->
			<div id="reportQueryFade" class="black_overlay"></div>
			<div id="reportQueryFadeUpload" class="black_overlay"></div>
			<div id="uploadingImg" style="display: none;text-align: center;"><img src="../../css/plugins/blueimp/img/loading.gif" alt="" style="width:40px;height:40px;" />上传中......</div>
		</div>
		</script>

		<!--初始化-->
		<script>
			//      以下为调取接口的部分
			var currentPage = 1;
			var offsetPage = 0; //传输的页起始条数
			var showNum = 10; //页面需要显示的条数
			var num_pages;
			//点击分页页数
			$(document).delegate(".flipOver", 'click', function() {
				$(this).addClass('active').siblings().removeClass('active');
				currentPage = parseInt($(this).attr("pageId"));
				offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
				getDateList();
				window.scrollTo(0, 0);
			});
			//点击上一页
			$(document).delegate("#prev", 'click', function() {
				if($(".flipOver.active").prev().attr("id") == "prev") {
					return true
				} else {
					var page = parseInt($(".flipOver.active").attr("pageid")) - 1;
					$(".flipOver.active").prev().addClass("active").siblings().removeClass("active")
				}
				currentPage = page;
				offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
				getDateList();
				window.scrollTo(0, 0);
			});

			//点击下一页
			$(document).delegate("#Next", 'click', function() {
				if($(".flipOver.active").next().attr("id") == "Next") {
					return true
				} else {
					var page = parseInt($(".flipOver.active").attr("pageid")) + 1;
					$(".flipOver.active").next().addClass("active").siblings().removeClass("active")
				}
				currentPage = page;
				offsetPage = (currentPage - 1) * 10; //（页码-1）*每页显示条数
				getDateList();
				window.scrollTo(0, 0);
			});
			//点击分页跳转页按钮
			$(document).delegate(".srueToJumpPageBtn", 'click', function() {
				currentPage = parseInt($(".toPageNum").val().trim());
				offsetPage = (currentPage-1)*10; //（页码-1）*每页显示条数
				getDateList();
				window.scrollTo(0, 0);
			});

			getDateList();
//			suggestInit();
			var listData = [];
			//获取数据1列表
			function getDateList() {
				$(".resultListsContents form").html('');
				$.ajax({
					type: "get",
					url: config + "/drug/hotSearch/list",
					async: false,
					data: {
						offset: offsetPage, //（页码-1）*每页显示条数
						limit: showNum //每页赢显示的条数
					},
					dataType: "jsonp",
					jsonp: "jsoncallback",
					success: function(data) {
						console.log(data);
						//模板渲染
						listData = data.resultMap.list;
						var listTotal=data.resultMap.total;//总条数
						var tpl_data = {
							data: listData
						}
						var tpl_html = template.render('table_tpl', tpl_data);
						$('.resultListsContents').html(tpl_html);
						num_pages = Math.ceil(parseInt(listTotal)/10);//总条数除以每页十条数据为总页码
						if(listData.length > 0) {
							var pageHtml = page(parseInt(currentPage), num_pages);
							$(".reportQuerypageN").html(pageHtml);
						} else {
							var pageHtml = page(2, 1);
							$(".reportQuerypageN").html(pageHtml);
						}
					},
				});

			}
		</script>
		<!--增删改等等操作-->
		<script>
			getDateList();
			function dosubmit() {
				$("#sgForm").submit();
			}
			$(function() {				
				//保存验证
				var e = "<i class='fa fa-times-circle'></i> ";
				var vaForm = $("#sgForm").validate({
					submitHandler: function(form) {
						if($('#up_id').val() != "") {							
							if ($("#ryaoName").val() != "") {
								form_update();
							}else{
								alert("请输入药品名称");
								return;
							}
						} else {
							if ($("#ryaoName").val() != "") {
								form_save();
							}else{
								alert("请输入药品名称");
								return;
							}
						}
					}
					/*,
					            rules: {
					                title: {
					                    required: !0
					                },
					                bannerUrl:{
					                    required: !0
					                },
					                tagUrl:{
					                    required: !0
					                }
					            },
					            messages: {
					                title: {
					                    required: e + "名称不能为空"
					                },
					                bannerUrl: {
					                    required: e + "请上传图片"
					                },
					                tagUrl: {
					                    required: e + "请上传图片"
					                }
					            }*/
				});
				//隐藏模态框时清空模态框
				$('#myModal1').on('hide.bs.modal', function() {
					vaForm.resetForm();
					document.getElementById("sgForm").reset();
					$('#up_id').val("");
					$('.simg').hide();

				});
			});

			function updateclick(that) {
				var index = $(that).attr('data-index');
				var data = listData[index];
				$('#up_id').val(data.id);

				//赋值模态框
				$('#ryaoName').val(data.content);
				$('#rec').val(data.accessPath);
				$('#price').val(data.price);
				$('#bannerUrl').val(data.bannerUrl);
				$('#tagUrl').val(data.tagUrl);

				$('#bannerUrl_img').attr('src', data.bannerUrl);
				$('#bannerUrl_img').show();
				$('#tagUrl_img').attr('src', data.tagUrl);
				$('#tagUrl_img').show();
			}

			function form_update() {
				$.ajax({
					type: "get",
					url: config + "/drug/hotSearch/update",
					async: false,
					dataType: "jsonp",
					jsonp: "jsoncallback",
					data: formAjaxData('#sgForm'),
					success: function(data) {
						alert(data.message);
						if(data.status != 2) {
							$('#myModal1').modal('hide');
							getDateList();
						}
					},
				});
			}

			function form_save() {
				$.ajax({
					type: "get",
					url: config + "/drug/hotSearch/save",
					async: false,
					dataType: "jsonp",
					jsonp: "jsoncallback",
					data: formAjaxData('#sgForm'),
					success: function(data) {
						alert(data.message);
						if(data.status != 2) {
							$('#myModal1').modal('hide');
							getDateList();
						}
					},
				});
			}

			function form_del(that) {
				var r = confirm("确定删除吗？")
    if(r == true) {
				var del_id = $(that).attr('data-id');
				$.ajax({
					type: "get",
					url: config + "/drug/hotSearch/remove",
					dataType: "jsonp",
					jsonp: "jsoncallback",
					data: {
						id: del_id
					},
					success: function(data) {
						alert(data.message);
						if(data.status != 2) {
							$('#myModal1').modal('hide');
							getDateList();
						}
					},
				});
			}
			}
			function r_shang(that) {
				var index = $(that).attr('data-index');
//				if(index == 0) {
//					alert('调整方向成功');
//					return;
//				}
				var i2 = parseInt(index) - 1;
				
				var s_data = listData[i2];
				var data = listData[index];
				console.log(data);
				sx_up5(data.id, data.caSort,"0",function() {
					if(data.status != 2) {
						$('#myModal1').modal('hide');
						getDateList();
					}
				});
			}

			function r_xia(that) {
				var index = $(that).attr('data-index');
//				if(index == listData.length - 1) {
//					alert('调整方向成功');
//					return;
//				}
				var i2 = parseInt(index) + 1;

				var x_data = listData[i2];
				var data = listData[index];
				console.log(data)
				sx_up5(data.id, data.caSort,"1",function() {
					if(data.status != 2) {
						$('#myModal1').modal('hide');
						getDateList();
					}
				});
			}
		</script>
		<!--图片上传-->
		<script>
			function img1Upload(that) {
				uploadImg(that, function(url) {
					$('#bannerUrl').val(url);
					$(that).parent().find('.simg').attr('src', url);
					$(that).parent().find('.simg').show();
				});
			}

			function img2Upload(that) {
				uploadImg(that, function(url) {
					$('#tagUrl').val(url);
					$(that).parent().find('.simg').attr('src', url);
					$(that).parent().find('.simg').show();
				});
			}
		</script>
	</body>

</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   