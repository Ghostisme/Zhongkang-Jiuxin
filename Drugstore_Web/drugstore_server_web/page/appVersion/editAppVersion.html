<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<title>中康九悦远程医疗管理系统 - 远程会诊申请单</title>

		<meta name="keywords" content="中康九悦远程医疗管理系统">
		<meta name="description" content="中康九悦远程医疗管理系统">

		<!--[if lt IE 8]>
    <meta http-equiv="refresh" content="0;ie.html"/>
    <![endif]-->

		<link rel="shortcut icon" href="favicon.ico">
		<link href="../../css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/font-awesome.min.css" rel="stylesheet">
		<link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
		<link href="../../css/plugins/steps/jquery.steps.css" rel="stylesheet">
		<link href="../../css/animate.min.css" rel="stylesheet">
		<link href="../../css/plugins/summernote/summernote.css" rel="stylesheet">
    	<link href="../../css/plugins/summernote/summernote-bs3.css" rel="stylesheet">
		
		<link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../css/plugins/webuploader/webuploader.css">
		<link rel="stylesheet" type="text/css" href="../../css/demo/webuploader-demo.min.css">
		<link href="../../css/style.min.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/common.css" />
		<link rel="stylesheet" href="../../css/editNews.css" />
		<style>
			#secondTitle3Box,#secondTitle4Box{
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="wrapper wrapper-content animated fadeInRight">
			<div class="row">
				<div class="ibox-content">
					<form id="form"  class="wizard-big">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">类型：</label>
                                <div class="col-sm-8">
                                    <!--<input id="cname" name="name" minlength="2" maxlength="50"type="text" class="form-control required" required=""aria-required="true">-->
                                	<select name="" id="cname"class="form-control required" required=""aria-required="true">
                                		<option value="0">
                                			IOS
                                		</option>
                                		<option value="1">
                                			Android
                                		</option>
                                	</select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">对比版本号：</label>
                                <div class="col-sm-8">
                                    <input id="secondTitle" name="secondTitle" maxlength="250"type="number" class="form-control required" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">详细版本号：</label>
                                <div class="col-sm-8">
                                    <input id="secondTitle1" name="secondTitle1" maxlength="250"type="text" class="form-control required">
                                </div>
                            </div>
                            <div class="form-group"id="secondTitle4Box">
                                <label class="col-sm-3 control-label">上传apk：</label>
                                <div class="col-sm-8">
                                	<div style="border: 1px solid #eee;height: 36px;padding-top: 8px;padding-left: 15px;" id="secondTitle3">
                                		请选择apk文件
                                	</div>
                                    <input id="secondTitle4" name="secondTitle4" onchange="change()" type="file" class="form-control" style="position: absolute;z-index: 8;top: 0px;opacity: 0;width: 96%;">
                                </div>
                            </div>
                            <!--<div class="form-group"id="secondTitle3Box">
                                <label class="col-sm-3 control-label">apk所在地址：</label>
                                <div class="col-sm-8">
                                    <input id="secondTitle3" name="secondTitle3" maxlength="250"type="text" class="form-control" >
                                </div>
                            </div>-->
                            <div class="form-group">
                                <label class="col-sm-3 control-label">描述：</label>
                                <div class="col-sm-8">
                                    <textarea id="ccomment" name="comment" maxlength="500"class="form-control required" style="height: 200px;"></textarea>
                                </div>
                            </div>
                            <!--<div class="row">
                            	<label class="col-sm-3 control-label">内容：</label>
					            <div class="col-sm-8"style="padding-left: 23px;padding-right: 23px;">
					                <div class="ibox float-e-margins">
					                    <div class="ibox-content no-padding">
					
					                        <div class="summernote">
					                           
					
					                        </div>
					
					                    </div>
					                </div>
					            </div>
					        </div>-->
					        <div class="form-group">
                                <label class="col-sm-3 control-label">是否强制更新：</label>
                                <div class="switch col-sm-1">
			                        <div class="onoffswitch">
			                            <input type="checkbox" class="onoffswitch-checkbox" id="example2">
			                            <label class="onoffswitch-label" for="example2">
			                                <span class="onoffswitch-inner"></span>
			                                <span class="onoffswitch-switch"></span>
			                            </label>
			                        </div>
			                    </div>
                            </div>
                            <!--<div class="form-group">
                            	<label class="col-sm-3 control-label">附件：</label>
	                            <div class="col-sm-8">
				                    <div id="file-pretty">
				                        <div class="form-group"style="border: 1px solid #eee;height: 40px;">
				                            <div style="position: absolute;height: 40px;line-height: 40px;"class="col-sm-11">
				                            	<span style="float:left;padding:0 20px;border-right: 1px solid #eee;"class="col-sm-2">选择文件</span>
				                            	<input class="input-large col-sm-10" type="text"style="height: 39px;border: 0px;border-bottom: 1px solid #eee;">
				                            </div>
				                            <input type="file" id="files"name="file"class="form-control required" required=""aria-required="true"style="opacity:0;position: absolute; z-index: 1;height: 40px;"accept=".gif,.jpg,.jpeg,.png">
				                        </div>
				                    </div>
				                    
				                    <div class="imgShow"id="showImage">
				                    	
				                    </div>
			                    </div>
                            </div>-->
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-3">
                                    <button type="submit" class="btn btn-w-m btn-success SureBtn">确认</button>
                                </div>
                            </div>
                        </form>
				</div>
			</div>
		</div>
		<div id="myModal" class="modal fade" name="tip-modal" data-backdrop="static" data-keyboard="false"style="text-align: center;">
			<img src="../../img/5-121204193R5-50.gif" alt="" style="width:40px;height:40px;margin:0 auto; margin-top:200px;"/>
		            	提交中......
		</div>
		<script src="../../js/jquery.min.js?v=2.1.4"></script>
		<script src="../../js/bootstrap.min.js?v=3.3.5"></script>
		<script src="../../js/plugins/staps/jquery.steps.min.js"></script>
		<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
		<script src="../../js/plugins/validate/messages_zh.min.js"></script>
		<!--<script src="../../js/demo/form-validate-demo.min.js"></script>-->
		<script src="../../js/plugins/summernote/summernote.min.js"></script>
    	<script src="../../js/plugins/summernote/summernote-zh-CN.js"></script>
		<script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
		<script src="../../js/content.min.js?v=1.0.0"></script>
		<script type="text/javascript">
			var BASE_URL = '../../js/plugins/webuploader';
		</script>
		<!--<script src="../../js/plugins/webuploader/webuploader.min.js"></script>-->
		<!--<script src="../../js/demo/webuploader-demo.min.js"></script>-->
		<script src="../../js/plugins/jquery.jqprint-0.3.js"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/config.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="../../js/demo/form-advanced-demo.min.js"></script>-->
		<script>
			var apkUrl='';
			$(function() {
			    $('#myModal').modal('hide');
			    
			    $("#cname").change(function(){
			    	if($("#cname").val()=="0"){//ios
			    		$("#secondTitle3Box").css("display","none");
			    		$("#secondTitle4Box").css("display","none");
			    		apkUrl='';
				    }else{
				    	$("#secondTitle3Box").css("display","block");
				    	$("#secondTitle4Box").css("display","block");
				    	apkUrl=$("#secondTitle3").val();
				    }
			    });
			});
			var versionEditId=localStorage.getItem("versionEditId");
			var versionCurrentType=localStorage.getItem("currentType");
			var versionCurrentTypeId;
				if(versionCurrentType=="ios"){//ios
			    	$("#secondTitle3Box").css("display","none");
			    	$("#secondTitle4Box").css("display","none");
			    	versionCurrentTypeId="0"
			    }else{
			    	$("#secondTitle3Box").css("display","block");
			    	$("#secondTitle4Box").css("display","block");
			    	versionCurrentTypeId="1"
			    }
			$("#form").validate();
			$(document).ready(function(){$(".summernote").summernote({lang:"zh-CN"})});var edit=function(){$("#eg").addClass("no-padding");$(".click2edit").summernote({lang:"zh-CN",focus:true})};var save=function(){$("#eg").removeClass("no-padding");var aHTML=$(".click2edit").code();$(".click2edit").destroy()};
			$(document).ready(function(){
//				获取页面数据
				
				$.ajax({
		            method: 'get',
		            url: config+'/app/version/getVersion',
		            contentType: "application/json; charset=utf-8",//传到后台的数据格式
		            async: true,
		            data: {'id':versionEditId},
		            dataType:'JSON',//接收值的格式
		            success: function(data) {
		                console.log(data);
		                if(data.status==0){
		                    $("#cname").val(versionCurrentTypeId);//类型
		                    $("#secondTitle").val(data.resultMap.version.version);//对比版本号
		                    $("#ccomment").val(data.resultMap.version.memo);//描述
		                    $("#secondTitle1").val(data.resultMap.version.versionDetail);//详细版本号
							$("#secondTitle3").text(data.resultMap.version.url);//apkurl
							apkUrl=data.resultMap.version.url;
//		                    switchBtn=data.resultMap.news.isShow//switch按钮状态
							if(data.resultMap.version.isForcedUpdate==0){
								$(".onoffswitch-label").click();
							}
//		                    if(data.resultMap.news.fileUrl!=null&&data.resultMap.news.fileUrl!=""){
//		                    	$("#showImage").html('<img src="'+data.resultMap.news.fileUrl+'"style="width:200px;height:120px;">');
//		                    }
		                }
		            },
		            error: function(result) {
		                console.log(result);
		            }
		        });
			});
			function change() {
				var obj = document.getElementById("secondTitle4");
				var len = obj.files.length;
				for (var i = 0; i < len; i++) {
				var temp = obj.files[i].name;
				console.log(temp);
				$("#secondTitle3").text(temp)
				}
			}
			$(".SureBtn").click(function(event){
				if($("#form").valid()){
					event.preventDefault();
					var formData = new FormData();
					if($('#secondTitle4')[0].files[0]){
						formData.append("file", $('#secondTitle4')[0].files[0]); //附件apk
					}
//					formData.append("file", $('#files')[0].files[0]); //附件
					formData.append("id",versionEditId);//id
					formData.append("type",$("#cname").find("option:selected").text().trim());//类型
					formData.append("version",$("#secondTitle").val().trim());//对比版本
					formData.append("versionDetail",$("#secondTitle1").val().trim());//详细版本
					formData.append("memo",$("#ccomment").val().trim());//描述
					formData.append("isForced",switchBtn);//是否强制更新
					formData.append("url",$("#secondTitle3").text().trim());//apkUrl
					$('#myModal').modal('show');
					$.ajax({
					   	url:config+'/app/version/update',
						method: 'post',
				      	cache: false,
				        async: true,
				        processData: false,
				        enctype: 'multipart/form-data',
				        contentType: false,
				        data: formData,
				        dataType: 'JSON', //接收值的格式
						success:function(data){
							console.log(data);
							if(data.status==0){
								$('#myModal').modal('hide');
								swal({title:"",text:"提交成功！"});
								setTimeout(function(){ 
	                            	parent.$(window.parent.document).find(".layui-layer-close").click();
	                            }, 2000);
								RefreshIframe("page/appVersion/appVersionListPage.html","XTWH_BBWH");
							}else{
								$('#myModal').modal('hide');
								swal({title:"",text:data.message});
							}
						},  
					    error: function () {
//					    	$('#myModal').modal('hide');
					        alert("提交失败！");  
					    } 
					})
				}
			})
			var switchBtn=1;//定义开关默认值
//			点击开关
			$(".onoffswitch-label").click(function(){
				if(switchBtn==0){
					switchBtn=1;
				}else{
					switchBtn=0;
				}
			})
			$("#files").change(function(e){
				console.info(e.target.files[0]);//图片文件
			    var dom =$(this)[0];
//			    console.info(dom.value);//这个是文件的路径 C:\fakepath\icon (5).png
//			    console.log(e.target.value);//这个也是文件的路径和上面的dom.value是一样的
			    var reader = new FileReader();
			    reader.onload = (function (file) {
			        return function (e) {
//			           console.info(this.result); //这个就是base64的数据了
			            var sss=$("#showImage");
			            $("#showImage").html('<img src="'+this.result+'"style="width:200px;height:120px;">');
			        };
			    })(e.target.files[0]);
			    reader.readAsDataURL(e.target.files[0]);
			});
		</script>
		<script type="text/javascript" src="../../js/stats.js"charset="utf-8"></script>
	</body>

</html>